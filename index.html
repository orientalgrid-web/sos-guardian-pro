<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Calculator</title>
    <!-- LEAFLET with high-res satellite (ESRI World Imagery) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- Leaflet Routing Machine -->
    <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ========== CALCULATOR DISGUISE ========== */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .calculator {
            background: #2c3e50;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 400px;
            overflow: hidden;
        }
        
        .calculator-display {
            background: #1a252f;
            color: white;
            padding: 30px 20px;
            text-align: right;
            font-size: 2.5em;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .calculator-display .result {
            font-size: 2em;
            font-weight: 300;
        }
        .calculator-display .equation {
            font-size: 0.8em;
            opacity: 0.7;
            margin-bottom: 5px;
        }
        .calculator-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1px;
            background: #34495e;
        }
        .calculator-btn {
            background: #2c3e50;
            border: none;
            color: white;
            font-size: 1.2em;
            padding: 25px 0;
            cursor: pointer;
            transition: all 0.2s;
        }
        .calculator-btn:hover { background: #1a252f; }
        .calculator-btn:active { background: #16a085; }
        .calculator-btn.operator { background: #3498db; }
        .calculator-btn.operator:hover { background: #2980b9; }
        .calculator-btn.equals {
            background: #e74c3c;
            grid-column: span 2;
        }
        .calculator-btn.equals:hover { background: #c0392b; }
        .calculator-btn.clear { background: #e67e22; }
        .calculator-btn.clear:hover { background: #d35400; }
        
        /* ========== SOS INTERFACE ‚Äì LIVE SATELLITE IMAGERY ========== */
        .sos-interface {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #030711;
            z-index: 1000;
            overflow-y: auto;
            color: white;
        }
        .sos-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .sos-header {
            background: linear-gradient(90deg, #002244 0%, #004488 100%);
            padding: 25px 30px;
            border-radius: 20px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 15px 35px rgba(0, 50, 100, 0.5);
            border-bottom: 2px solid #00aaff;
        }
        
        /* EMERGENCY BUTTON ‚Äì ONLY FOR ACTIVATION */
        .emergency-section {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background: rgba(0, 40, 80, 0.5);
            border-radius: 25px;
        }
        .emergency-btn {
            background: radial-gradient(circle at 30% 30%, #ff3b30, #aa0000);
            color: white;
            border: none;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            margin: 0 auto 20px;
            cursor: pointer;
            font-size: 22px;
            font-weight: bold;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 40px rgba(255, 0, 0, 0.6);
            border: 2px solid #ffcc00;
        }
        
        /* SURVEILLANCE CARD ‚Äì ROUTE INPUT */
        .surveillance-section {
            background: rgba(0, 30, 60, 0.8);
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            border: 1px solid #00aaff;
            backdrop-filter: blur(5px);
        }
        .surveillance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .surveillance-card {
            background: rgba(0, 20, 40, 0.9);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid #3388ff;
            text-align: center;
        }
        .surveillance-icon {
            width: 60px;
            height: 60px;
            background: rgba(0, 150, 255, 0.2);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 24px;
            color: #88ddff;
        }
        
        /* ========== SATELLITE MAP ‚Äì ESRI WORLD IMAGERY (LIVE) ========== */
        .map-container {
            height: 550px;
            border-radius: 20px;
            overflow: hidden;
            margin: 30px 0;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.8);
            position: relative;
            border: 3px solid #0066cc;
            transition: all 0.3s ease;
        }
        #map {
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 1;
        }
        /* Overlay controls ‚Äì only satellite layer switch */
        .map-overlay {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            z-index: 10;
            display: flex;
            justify-content: space-between;
            pointer-events: none;
        }
        .satellite-btn {
            background: #004488;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 40px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 8px 20px black;
            border: 1px solid #88ddff;
            backdrop-filter: blur(10px);
            background: rgba(0, 80, 120, 0.95);
            pointer-events: auto;
        }
        .satellite-btn:hover { background: #0066aa; }
        
        /* ===== ONLY ONE BUTTON: ENLARGE SATELLITE VIEW ===== */
        .enlarge-btn-container {
            position: absolute;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 20;
            display: flex;
            justify-content: center;
            pointer-events: none;
        }
        .enlarge-btn {
            background: #004c99;
            color: white;
            border: none;
            padding: 16px 40px;
            border-radius: 60px;
            font-size: 1.2rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: 0.2s;
            border: 2px solid #88ddff;
            box-shadow: 0 0 30px #00aaff;
            pointer-events: auto;
            background: linear-gradient(145deg, #0055aa, #003366);
        }
        .enlarge-btn:hover {
            background: #0066cc;
            transform: scale(1.05);
            box-shadow: 0 0 40px #00aaff;
        }
        .enlarge-btn i {
            font-size: 1.5rem;
        }
        .map-container.enlarged {
            height: 90vh;
            margin: 0;
            border-radius: 0;
            position: relative;
            z-index: 1001;
        }
        
        /* ROUTE info */
        .route-info {
            background: rgba(0, 100, 200, 0.3);
            padding: 15px;
            border-radius: 15px;
            margin-top: 20px;
            border-left: 6px solid #00aaff;
        }
        
        .form-group input {
            width: 100%;
            padding: 14px;
            border-radius: 12px;
            border: 1px solid #0088ff;
            background: rgba(0, 30, 50, 0.9);
            color: white;
            font-size: 16px;
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 15px 0;
        }
        .notification {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 40, 80, 0.95);
            color: white;
            padding: 15px 25px;
            border-radius: 15px;
            z-index: 1002;
            border-left: 5px solid #00aaff;
            backdrop-filter: blur(10px);
        }
        .hidden { display: none; }
        
        /* SETTINGS PANEL - COMPLETELY REMOVED FROM CALCULATOR FACE */
        /* No settings panel visible on calculator */
        
        @media (max-width: 768px) {
            .emergency-btn { width: 160px; height: 160px; }
            .map-container { height: 450px; }
            .map-container.enlarged { height: 85vh; }
            .enlarge-btn { padding: 14px 30px; font-size: 1.1rem; }
        }
        /* Shake indicator */
        .shake-indicator {
            background: #003366;
            padding: 12px 20px;
            border-radius: 40px;
            display: inline-block;
            margin: 10px 0;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- ========== CALCULATOR ========== -->
    <div class="calculator" id="calculator">
        <div class="calculator-display">
            <div class="equation" id="equation">0</div>
            <div class="result" id="result">0</div>
        </div>
        <div class="calculator-buttons">
            <button class="calculator-btn clear" onclick="clearDisplay()">C</button>
            <button class="calculator-btn operator" onclick="appendOperator('+')">+</button>
            <button class="calculator-btn operator" onclick="appendOperator('-')">-</button>
            <button class="calculator-btn operator" onclick="appendOperator('*')">√ó</button>
            <button class="calculator-btn" onclick="appendNumber('7')">7</button>
            <button class="calculator-btn" onclick="appendNumber('8')">8</button>
            <button class="calculator-btn" onclick="appendNumber('9')">9</button>
            <button class="calculator-btn operator" onclick="appendOperator('/')">√∑</button>
            <button class="calculator-btn" onclick="appendNumber('4')">4</button>
            <button class="calculator-btn" onclick="appendNumber('5')">5</button>
            <button class="calculator-btn" onclick="appendNumber('6')">6</button>
            <button class="calculator-btn" onclick="appendOperator('.')">.</button>
            <button class="calculator-btn" onclick="appendNumber('1')">1</button>
            <button class="calculator-btn" onclick="appendNumber('2')">2</button>
            <button class="calculator-btn" onclick="appendNumber('3')">3</button>
            <button class="calculator-btn equals" onclick="calculate()" onmousedown="holdForEmergency()" onmouseup="releaseHold()" ontouchstart="holdForEmergency()" ontouchend="releaseHold()">=</button>
            <button class="calculator-btn" onclick="appendNumber('0')">0</button>
            <button class="calculator-btn" onclick="toggleSign()">¬±</button>
        </div>
    </div>
    
    <!-- ========== SATELLITE SURVEILLANCE INTERFACE ========== -->
    <div class="sos-interface" id="sosInterface">
        <div class="sos-container">
            <!-- HEADER: LIVE SATELLITE -->
            <div class="sos-header">
                <h1><i class="fas fa-satellite"></i> LIVE SATELLITE EYES</h1>
                <p style="color:#aaddff;">üá≥üá¨ NIGERIA COVERAGE ‚Ä¢ HIGH-RES IMAGERY ‚Ä¢ ROUTE VIEW</p>
                <div class="shake-indicator" id="shakeDisplay">
                    <i class="fas fa-mobile-alt"></i> SHAKE 6x FOR SOS
                </div>
            </div>
            
            <!-- EMERGENCY BUTTON ‚Äì only for activation, no threat scan -->
            <div class="emergency-section">
                <button class="emergency-btn" id="sosButton" onmousedown="startHoldTimer()" onmouseup="cancelHoldTimer()" ontouchstart="startHoldTimer()" ontouchend="cancelHoldTimer()">
                    <i class="fas fa-exclamation-triangle" style="font-size:40px;"></i>
                    <span id="buttonText">SATELLITE SOS<br>HOLD 3S</span>
                    <span id="countdown" class="hidden" style="font-size:40px;">3</span>
                </button>
                <p style="color:#ffcc00;"><i class="fas fa-eye"></i> YOU ARE THE ANALYST ‚Äì OBSERVE SATELLITE TO DETECT THREATS</p>
            </div>
            
            <!-- ===== ROUTE INPUT ‚Äì TRIGGERS SATELLITE SWITCH ===== -->
            <div class="surveillance-section">
                <h2 style="color:#88ddff;"><i class="fas fa-route"></i> PROGRAM SATELLITE ON YOUR ROUTE</h2>
                <div class="surveillance-grid">
                    <div class="surveillance-card">
                        <div class="surveillance-icon"><i class="fas fa-map-pin"></i></div>
                        <h4 style="color:#88ddff;">START POSITION</h4>
                        <div class="form-group">
                            <input type="text" id="startLocation" placeholder="City or GPS" value="Lagos, Nigeria">
                            <button onclick="setStartAndFly()" style="background:#0066aa; color:white; border:none; padding:12px; border-radius:10px; margin-top:12px; width:100%;">
                                <i class="fas fa-satellite-dish"></i> POINT SATELLITE HERE
                            </button>
                        </div>
                    </div>
                    <div class="surveillance-card">
                        <div class="surveillance-icon"><i class="fas fa-flag-checkered"></i></div>
                        <h4 style="color:#88ddff;">DESTINATION</h4>
                        <div class="form-group">
                            <input type="text" id="destination" placeholder="Destination" value="Abuja, Nigeria">
                            <button onclick="setDestAndFly()" style="background:#6a0dad; color:white; border:none; padding:12px; border-radius:10px; margin-top:12px; width:100%;">
                                <i class="fas fa-satellite"></i> VIEW DESTINATION
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- ROUTE OVERVIEW ‚Äì SATELLITE IMAGERY -->
                <div class="route-info">
                    <i class="fas fa-globe-africa"></i> <strong>SATELLITE TASKED:</strong> 
                    <span id="routeDisplay">Lagos ‚Üí Abuja (route loaded)</span>
                    <p style="font-size:0.9rem; margin-top:8px; color:#ccc;">üõ∞Ô∏è High-resolution satellite ‚Äì Zoom to inspect vehicles, buildings, activity</p>
                </div>
                
                <!-- Emergency contacts (optional) -->
                <div style="margin-top:30px;">
                    <h4 style="color:#88ddff;"><i class="fas fa-phone-alt"></i> Alert Contacts</h4>
                    <div class="form-row">
                        <input type="text" id="contact1" placeholder="+234..." value="+2348103365359">
                        <input type="text" id="contact2" placeholder="+234...">
                    </div>
                    <button onclick="saveContacts()" style="background:#008844; color:white; padding:12px; border-radius:10px; width:100%;">üíæ SAVE</button>
                </div>
            </div>
            
            <!-- ========== LIVE SATELLITE MAP ‚Äì ESRI WORLD IMAGERY ========== -->
            <div class="map-container" id="mapContainer">
                <div class="map-overlay">
                    <button class="satellite-btn" onclick="toggleSatelliteSource()">
                        <i class="fas fa-layer-group"></i> SATELLITE / HYBRID
                    </button>
                    <button class="satellite-btn" onclick="zoomToRoute()" style="background:#006688;">
                        <i class="fas fa-route"></i> ROUTE VIEW
                    </button>
                </div>
                <div id="map"></div>
                <!-- ===== ONLY ONE BUTTON: ENLARGE SATELLITE VIEW ===== -->
                <div class="enlarge-btn-container">
                    <button class="enlarge-btn" id="enlargeMapBtn" onclick="toggleMapEnlarge()">
                        <i class="fas fa-expand-alt" id="enlargeIcon"></i> <span id="enlargeText">ENLARGE SATELLITE</span>
                    </button>
                </div>
            </div>
            
            <!-- USER INSTRUCTIONS ‚Äì PURE OBSERVATION -->
            <div style="background:rgba(0,50,80,0.7); padding:25px; border-radius:20px; margin:20px 0; text-align:center;">
                <h3 style="color:#aaddff;"><i class="fas fa-user-secret"></i> SATELLITE RECONNAISSANCE</h3>
                <p style="color:white; font-size:1.1rem;">You are the analyst. Scan the satellite imagery ahead (2000m) and sides (50m). Identify threats visually.</p>
                <p style="color:#ffcc88;"><i class="fas fa-shield"></i> FRONT 2000m ‚Ä¢ LEFT 50m ‚Ä¢ RIGHT 50m ‚Äì VISUAL INSPECTION</p>
                <p><i class="fas fa-arrows-up-down-left-right"></i> Pan, zoom, and analyze the route. Satellite follows your start/destination.</p>
            </div>
            
            <div style="text-align:center; padding:20px; background:rgba(0,0,0,0.5); border-radius:15px;">
                <p>üö® SHAKE 6 TIMES FOR EMERGENCY ALERT ‚Ä¢ LONG PRESS RED BUTTON</p>
                <p>¬© SATELLITE SURVEILLANCE ‚Äì NIGERIA ROUTES</p>
            </div>
        </div>
    </div>
    
    <!-- NO SETTINGS PANEL ‚Äì COMPLETELY REMOVED FROM CALCULATOR FACE -->

    <script>
        // ========== LEAFLET SATELLITE IMAGERY ‚Äì ESRI WORLD IMAGERY (LIVE) ==========
        let map = null;
        let routingControl = null;
        let userMarker = null;
        
        // NIGERIA default locations
        let startLoc = { lat: 6.5244, lng: 3.3792 }; // Lagos
        let destLoc = { lat: 9.0579, lng: 7.4951 };   // Abuja
        
        let isSatelliteHybrid = false; // false = pure imagery, true = hybrid
        
        // Emergency states
        let shakeCount = 0;
        let lastShakeTime = 0;
        let holdTimer = null;
        let calculatorHoldTimer = null;
        let emergencyActive = false;
        
        // ===== Map enlarge state =====
        let isMapEnlarged = false;
        
        // ========== CALCULATOR FUNCTIONS ==========
        let currentInput = '0', previousInput = '', operation = null, resetScreen = false;
        function appendNumber(n) { if (currentInput === '0' || resetScreen) { currentInput = n; resetScreen = false; } else currentInput += n; updateDisplay(); }
        function appendOperator(op) { if (op === '=') { calculate(); return; } if (previousInput !== '' && operation !== null) calculate(); operation = op; previousInput = currentInput; currentInput = '0'; updateDisplay(); }
        function calculate() { let prev = parseFloat(previousInput), curr = parseFloat(currentInput); if (isNaN(prev)||isNaN(curr)) return; switch(operation) { case '+': currentInput = prev+curr; break; case '-': currentInput = prev-curr; break; case '*': currentInput = prev*curr; break; case '/': currentInput = prev/curr; break; default: return; } operation=null; previousInput=''; resetScreen=true; updateDisplay(); }
        function clearDisplay() { currentInput='0'; previousInput=''; operation=null; updateDisplay(); }
        function toggleSign() { currentInput = (parseFloat(currentInput)*-1).toString(); updateDisplay(); }
        function updateDisplay() { document.getElementById('result').textContent = currentInput; document.getElementById('equation').textContent = previousInput + (operation ? ' ' + operation : ''); }
        
        // ========== DISGUISE TOGGLE ==========
        function toggleSOSInterface() {
            const sos = document.getElementById('sosInterface');
            const calc = document.getElementById('calculator');
            if (sos.style.display === 'block') { 
                sos.style.display = 'none'; calc.style.display = 'block';
            } else { 
                sos.style.display = 'block'; calc.style.display = 'none';
                initSatelliteMap(); 
            }
        }
        function resetCalculator() { 
            document.getElementById('sosInterface').style.display = 'none'; 
            document.getElementById('calculator').style.display = 'block';
        }
        function holdForEmergency() { 
            calculatorHoldTimer = setTimeout(() => { 
                toggleSOSInterface(); 
                showNotification('üõ∞Ô∏è SATELLITE ACTIVATED ‚Äì Nigeria coverage', 'success'); 
            }, 3000); 
        }
        function releaseHold() { clearTimeout(calculatorHoldTimer); }
        
        // ========== INIT SATELLITE MAP ==========
        function initSatelliteMap() {
            if (!map) {
                map = L.map('map').setView([startLoc.lat, startLoc.lng], 13);
                
                // DEFAULT: ESRI World Imagery (pure satellite, live)
                L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                    attribution: '¬© Esri, Maxar, Earthstar, Nigeria',
                    maxZoom: 20,
                    minZoom: 2
                }).addTo(map);
                
                // Add user marker (YOU) ‚Äì but user is the observer
                userMarker = L.marker([startLoc.lat, startLoc.lng], {
                    icon: L.divIcon({ html: '<i class="fas fa-circle-user" style="color:#00ffff; font-size:32px; text-shadow:0 0 10px black;"></i>', iconSize: [32,32] })
                }).addTo(map).bindPopup('üìç YOUR START (OBSERVER)');
                
                // Draw initial route
                updateSatelliteRoute(startLoc, destLoc);
                
                // Add shake listener
                if (window.DeviceMotionEvent) window.addEventListener('devicemotion', handleShake);
                
                showNotification('üõ∞Ô∏è LIVE SATELLITE IMAGERY ‚Äì ESRI World Imagery', 'success');
            }
        }
        
        // ========== ROUTE ON SATELLITE ==========
        function updateSatelliteRoute(start, dest) {
            if (routingControl) map.removeControl(routingControl);
            routingControl = L.Routing.control({
                waypoints: [L.latLng(start.lat, start.lng), L.latLng(dest.lat, dest.lng)],
                routeWhileDragging: false,
                lineOptions: { styles: [{ color: '#ffaa00', opacity: 0.9, weight: 5 }] },
                showAlternatives: false,
                geocoder: L.Control.Geocoder.nominatim(),
                router: L.Routing.osrmv1({ profile: 'driving' })
            }).addTo(map);
            
            document.getElementById('routeDisplay').innerHTML = `${start.lat.toFixed(4)},${start.lng.toFixed(4)} ‚Üí ${dest.lat.toFixed(4)},${dest.lng.toFixed(4)} (satellite tasked)`;
        }
        
        // ========== SATELLITE SWITCH ON ROUTE INPUT ==========
        function setStartAndFly() {
            let input = document.getElementById('startLocation').value.toLowerCase();
            if (input.includes('lagos')) startLoc = { lat: 6.5244, lng: 3.3792 };
            else if (input.includes('abuja')) startLoc = { lat: 9.0579, lng: 7.4951 };
            else if (input.includes('kano')) startLoc = { lat: 12.0022, lng: 8.5920 };
            else if (input.includes('portharcourt')) startLoc = { lat: 4.8156, lng: 7.0498 };
            else startLoc = { lat: 6.5244, lng: 3.3792 };
            
            if (userMarker) userMarker.setLatLng([startLoc.lat, startLoc.lng]);
            map.flyTo([startLoc.lat, startLoc.lng], 17, { duration: 3 });
            updateSatelliteRoute(startLoc, destLoc);
            showNotification(`üõ∞Ô∏è Satellite repositioned to START: ${document.getElementById('startLocation').value}`, 'info');
        }
        
        function setDestAndFly() {
            let input = document.getElementById('destination').value.toLowerCase();
            if (input.includes('abuja')) destLoc = { lat: 9.0579, lng: 7.4951 };
            else if (input.includes('lagos')) destLoc = { lat: 6.5244, lng: 3.3792 };
            else if (input.includes('kano')) destLoc = { lat: 12.0022, lng: 8.5920 };
            else if (input.includes('ibadan')) destLoc = { lat: 7.3776, lng: 3.9470 };
            else destLoc = { lat: 9.0579, lng: 7.4951 };
            
            map.flyTo([destLoc.lat, destLoc.lng], 17, { duration: 3 });
            updateSatelliteRoute(startLoc, destLoc);
            showNotification(`üõ∞Ô∏è Satellite repositioned to DESTINATION: ${document.getElementById('destination').value}`, 'info');
        }
        
        // ========== TOGGLE SATELLITE / HYBRID ==========
        function toggleSatelliteSource() {
            if (!map) return;
            map.eachLayer((layer) => { if (layer instanceof L.TileLayer) map.removeLayer(layer); });
            
            if (!isSatelliteHybrid) {
                // Hybrid: satellite + labels
                L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                    attribution: 'Esri, Maxar',
                    maxZoom: 20
                }).addTo(map);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OSM',
                    maxZoom: 20,
                    opacity: 0.3
                }).addTo(map);
                isSatelliteHybrid = true;
                showNotification('üõ∞Ô∏èüåç HYBRID (labels over satellite)', 'success');
            } else {
                // Pure satellite
                L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                    attribution: 'Esri, Maxar, Nigeria',
                    maxZoom: 20
                }).addTo(map);
                isSatelliteHybrid = false;
                showNotification('üõ∞Ô∏è PURE SATELLITE IMAGERY', 'success');
            }
            // restore route and markers
            updateSatelliteRoute(startLoc, destLoc);
            if (userMarker) userMarker.addTo(map);
        }
        
        function zoomToRoute() {
            if (!map) return;
            let center = { lat: (startLoc.lat + destLoc.lat)/2, lng: (startLoc.lng + destLoc.lng)/2 };
            map.flyTo([center.lat, center.lng], 10, { duration: 2 });
        }
        
        // ========== TOGGLE MAP ENLARGE ==========
        function toggleMapEnlarge() {
            let mapContainer = document.getElementById('mapContainer');
            let btnIcon = document.getElementById('enlargeIcon');
            let btnText = document.getElementById('enlargeText');
            
            if (!isMapEnlarged) {
                mapContainer.classList.add('enlarged');
                btnIcon.className = 'fas fa-compress-alt';
                btnText.innerText = 'REDUCE SATELLITE';
                isMapEnlarged = true;
            } else {
                mapContainer.classList.remove('enlarged');
                btnIcon.className = 'fas fa-expand-alt';
                btnText.innerText = 'ENLARGE SATELLITE';
                isMapEnlarged = false;
            }
            setTimeout(() => { if (map) map.invalidateSize(); }, 200);
        }
        
        // ========== SHAKE DETECTION ‚Äì 6 SHAKES FOR SOS ==========
        function handleShake(e) {
            let acc = e.accelerationIncludingGravity;
            if (!acc) return;
            if (!window.lastAccel) { window.lastAccel = {x: acc.x, y: acc.y, z: acc.z}; return; }
            let delta = Math.abs(acc.x - window.lastAccel.x) + Math.abs(acc.y - window.lastAccel.y) + Math.abs(acc.z - window.lastAccel.z);
            if (delta > 18) {
                let now = Date.now();
                if (now - lastShakeTime > 800) shakeCount = 0;
                shakeCount++;
                lastShakeTime = now;
                document.getElementById('shakeDisplay').innerHTML = `<i class="fas fa-mobile-alt"></i> SHAKE ${shakeCount}/6 FOR SOS`;
                if (shakeCount >= 6) { triggerEmergency('shake'); shakeCount = 0; }
            }
            window.lastAccel = {x: acc.x, y: acc.y, z: acc.z};
        }
        
        // ========== EMERGENCY SOS ==========
        function startHoldTimer() {
            if (emergencyActive) return;
            let count = 3;
            document.getElementById('buttonText').classList.add('hidden');
            document.getElementById('countdown').classList.remove('hidden');
            document.getElementById('countdown').innerText = count;
            holdTimer = setInterval(() => { 
                count--; 
                document.getElementById('countdown').innerText = count;
                if (count <= 0) { clearInterval(holdTimer); triggerEmergency('button'); }
            }, 1000);
        }
        function cancelHoldTimer() { clearInterval(holdTimer); document.getElementById('buttonText').classList.remove('hidden'); document.getElementById('countdown').classList.add('hidden'); }
        
        function triggerEmergency(source) {
            if (emergencyActive) return;
            emergencyActive = true;
            let contact = document.getElementById('contact1').value || '+2348103365359';
            let pos = `Start: ${startLoc.lat.toFixed(4)},${startLoc.lng.toFixed(4)} | Dest: ${destLoc.lat.toFixed(4)},${destLoc.lng.toFixed(4)}`;
            let msg = `üö® SATELLITE SOS - Nigeria Route. ${pos}. I need assistance. Live satellite imagery active.`;
            showNotification(`üö® EMERGENCY ‚Äì SENT TO ${contact}`, 'emergency');
            window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
            setTimeout(() => { emergencyActive = false; }, 5000);
        }
        
        // ========== MISC ==========
        function saveContacts() { 
            localStorage.setItem('contact1', document.getElementById('contact1').value); 
            localStorage.setItem('contact2', document.getElementById('contact2').value); 
            showNotification('‚úÖ Contacts saved', 'success'); 
        }
        
        function showNotification(m, t) { 
            let n = document.createElement('div'); 
            n.className = 'notification'; 
            n.innerHTML = m; 
            document.body.appendChild(n); 
            setTimeout(() => n.remove(), 4000); 
        }
        
        // Preload
        window.onload = function() {
            updateDisplay();
        };
    </script>
</body>
</html>
