<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üõ°Ô∏è SOS Guardian Pro - Emergency Safety</title>
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css' rel='stylesheet' />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: #0c0e2a; color: #fff; min-height: 100vh; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        .header {
            background: linear-gradient(90deg, #008751 0%, #00A859 100%);
            padding: 25px 30px; border-radius: 20px; margin-bottom: 20px;
            text-align: center; box-shadow: 0 15px 35px rgba(0, 135, 81, 0.3);
        }
        
        .demo-warning {
            background: #ff3b30; color: white; padding: 15px; border-radius: 15px;
            margin: 20px 0; text-align: center; font-weight: bold;
            border: 2px solid #ff9500;
        }
        
        .emergency-section {
            text-align: center; margin: 30px 0; padding: 30px;
            background: rgba(255, 255, 255, 0.05); border-radius: 25px;
        }
        
        .emergency-btn {
            background: linear-gradient(45deg, #ff3b30, #ff2d55); color: white;
            border: none; width: 250px; height: 250px; border-radius: 50%;
            margin: 0 auto 20px; cursor: pointer; font-size: 24px; font-weight: bold;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            box-shadow: 0 20px 40px rgba(255, 59, 48, 0.4);
            animation: heartbeat 2s infinite;
        }
        
        @keyframes heartbeat { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        
        .shake-status {
            background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 15px;
            margin: 20px auto; max-width: 500px; display: flex; align-items: center;
            justify-content: center; gap: 15px;
        }
        
        .map-container {
            height: 400px; border-radius: 20px; overflow: hidden; margin: 30px 0;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
        }
        
        .quick-actions {
            position: fixed; bottom: 20px; right: 20px; background: rgba(0, 0, 0, 0.9);
            padding: 15px; border-radius: 15px; z-index: 1000; min-width: 200px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .action-btn {
            background: #2196F3; color: white; border: none; padding: 10px 15px;
            border-radius: 8px; margin: 5px 0; width: 100%; font-size: 14px; cursor: pointer;
        }
        
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85); z-index: 1000; align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: #1a1f3a; width: 90%; max-width: 500px; border-radius: 25px;
            padding: 40px; text-align: center; border: 2px solid rgba(255, 59, 48, 0.5);
        }
        
        .notification {
            position: fixed; bottom: 20px; left: 20px; background: rgba(0, 0, 0, 0.9);
            color: white; padding: 15px 25px; border-radius: 15px; z-index: 100;
            max-width: 350px; animation: slideIn 0.5s ease-out;
            border-left: 5px solid #008751;
        }
        
        @keyframes slideIn {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @media (max-width: 768px) {
            .emergency-btn { width: 200px; height: 200px; font-size: 20px; }
            .quick-actions { bottom: 10px; right: 10px; left: 10px; width: auto; }
        }
        
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <!-- DEMO WARNING -->
        <div class="demo-warning">
            <i class="fas fa-exclamation-triangle"></i> DEMO VERSION - Safe for testing
        </div>
        
        <!-- HEADER -->
        <div class="header">
            <h1><i class="fas fa-shield-alt"></i> SOS Guardian Pro</h1>
            <p>Emergency Safety System for Nigeria</p>
        </div>
        
        <!-- SHAKE DETECTION -->
        <div class="shake-status">
            <div class="shake-count" style="background:#007aff;color:white;width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;">
                0/6
            </div>
            <div class="shake-text">
                <span style="color:#ff9500;font-weight:600;">SHAKE TO ACTIVATE:</span> Shake phone 6 times
            </div>
        </div>
        
        <!-- EMERGENCY SECTION -->
        <div class="emergency-section">
            <h2>EMERGENCY SOS</h2>
            <p>Press and hold for 3 seconds or shake phone 6 times</p>
            
            <button class="emergency-btn" id="sosButton">
                <i class="fas fa-bell"></i>
                <span id="buttonText">EMERGENCY<br>SOS</span>
                <div id="countdown" class="hidden" style="font-size:50px;font-weight:800;"></div>
            </button>
            
            <p style="color:#ffcc00;">Hold button or shake phone</p>
        </div>
        
        <!-- MAP -->
        <div class="map-container">
            <div id="map"></div>
        </div>
        
        <!-- SIMPLE FEATURES -->
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin:30px 0;">
            <div style="background:rgba(255,255,255,0.05);padding:20px;border-radius:15px;text-align:center;">
                <div style="background:#008751;width:60px;height:60px;border-radius:15px;display:flex;align-items:center;justify-content:center;margin:0 auto 15px;font-size:25px;">
                    <i class="fas fa-location-dot"></i>
                </div>
                <h3>GPS Tracking</h3>
                <p>Real-time location sharing</p>
            </div>
            
            <div style="background:rgba(255,255,255,0.05);padding:20px;border-radius:15px;text-align:center;">
                <div style="background:#008751;width:60px;height:60px;border-radius:15px;display:flex;align-items:center;justify-content:center;margin:0 auto 15px;font-size:25px;">
                    <i class="fab fa-whatsapp"></i>
                </div>
                <h3>WhatsApp Alerts</h3>
                <p>Share emergency alerts</p>
            </div>
            
            <div style="background:rgba(255,255,255,0.05);padding:20px;border-radius:15px;text-align:center;">
                <div style="background:#008751;width:60px;height:60px;border-radius:15px;display:flex;align-items:center;justify-content:center;margin:0 auto 15px;font-size:25px;">
                    <i class="fas fa-camera"></i>
                </div>
                <h3>Photo Evidence</h3>
                <p>Capture emergency photos</p>
            </div>
        </div>
        
        <!-- FOOTER -->
        <div style="text-align:center;padding:30px;margin-top:30px;background:rgba(0,0,0,0.3);border-radius:15px;">
            <p>SOS Guardian Pro v2.0 - DEMO MODE</p>
            <p>Emergency: 112, 767 | Demo only</p>
        </div>
    </div>
    
    <!-- QUICK ACTIONS -->
    <div class="quick-actions">
        <h4 style="color:#FFD700;margin:0 0 10px 0;font-size:14px;">Quick Actions:</h4>
        <button class="action-btn" onclick="shareViaWhatsApp()" style="background:#25D366;">
            <i class="fab fa-whatsapp"></i> WhatsApp Alert
        </button>
        <button class="action-btn" onclick="capturePhoto()" style="background:#9C27B0;">
            <i class="fas fa-camera"></i> Photo Evidence
        </button>
        <button class="action-btn" onclick="shareLocation()" style="background:#4CAF50;">
            <i class="fas fa-map-marker-alt"></i> Share Location
        </button>
    </div>
    
    <!-- EMERGENCY MODAL -->
    <div class="modal" id="emergencyModal">
        <div class="modal-content">
            <div style="font-size:70px;color:#ff3b30;margin-bottom:20px;">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h2 style="color:#ffcc00;">EMERGENCY ACTIVATED!</h2>
            <p>Click buttons below to share alerts</p>
            <div style="margin:30px 0;">
                <button onclick="shareViaWhatsApp()" style="background:#25D366;color:white;border:none;padding:15px;border-radius:10px;margin:5px;width:100%;">
                    <i class="fab fa-whatsapp"></i> Share via WhatsApp
                </button>
                <button onclick="shareLocation()" style="background:#2196F3;color:white;border:none;padding:15px;border-radius:10px;margin:5px;width:100%;">
                    <i class="fas fa-map-marker-alt"></i> Share Location
                </button>
            </div>
            <button onclick="closeModal()" style="background:#666;color:white;border:none;padding:15px;border-radius:10px;width:100%;">
                Cancel (False Alarm)
            </button>
        </div>
    </div>
    
    <script>
        // ========== SIMPLE CONFIG ==========
        const CONFIG = {
            mapboxToken: 'pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4M29iazA2Z2gycXA4N2pmbDZmangifQ.-g_vE53SD2WrJ6tFX7QHmA',
            requiredShakes: 6
        };
        
        // ========== STATE ==========
        let emergencyActive = false;
        let shakeCount = 0;
        let userLocation = { lat: 6.5244, lng: 3.3792 }; // Lagos
        
        // ========== MAP ==========
        mapboxgl.accessToken = CONFIG.mapboxToken;
        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v11',
            center: [userLocation.lng, userLocation.lat],
            zoom: 14
        });
        
        const marker = new mapboxgl.Marker({ color: '#ff3b30' })
            .setLngLat([userLocation.lng, userLocation.lat])
            .addTo(map);
        
        // ========== GET LOCATION ==========
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (pos) => {
                        userLocation = { lat: pos.coords.latitude, lng: pos.coords.longitude };
                        marker.setLngLat([userLocation.lng, userLocation.lat]);
                        map.flyTo({ center: [userLocation.lng, userLocation.lat], zoom: 16 });
                        showNotification('üìç Location acquired', 'success');
                    },
                    () => showNotification('üìç Using default location', 'info')
                );
            }
        }
        
        // ========== SHAKE DETECTION ==========
        let lastAcceleration = { x: null, y: null, z: null };
        
        function handleShake(event) {
            const acc = event.accelerationIncludingGravity;
            if (!lastAcceleration.x) {
                lastAcceleration = { x: acc.x, y: acc.y, z: acc.z };
                return;
            }
            
            const delta = Math.abs(acc.x - lastAcceleration.x) + 
                         Math.abs(acc.y - lastAcceleration.y) + 
                         Math.abs(acc.z - lastAcceleration.z);
            
            if (delta > 15) {
                shakeCount++;
                updateShakeDisplay();
                if (shakeCount >= CONFIG.requiredShakes) {
                    triggerEmergency();
                }
            }
            
            lastAcceleration = { x: acc.x, y: acc.y, z: acc.z };
        }
        
        function updateShakeDisplay() {
            const shakeElement = document.querySelector('.shake-count');
            if (shakeElement) {
                shakeElement.textContent = `${shakeCount}/${CONFIG.requiredShakes}`;
                if (shakeCount >= CONFIG.requiredShakes) {
                    shakeElement.style.background = '#ff3b30';
                } else if (shakeCount >= 4) {
                    shakeElement.style.background = '#ff9500';
                }
            }
        }
        
        // ========== EMERGENCY BUTTON ==========
        const sosButton = document.getElementById('sosButton');
        let holdTimer = null;
        let countdownValue = 3;
        
        sosButton.addEventListener('mousedown', () => {
            if (emergencyActive) return;
            
            countdownValue = 3;
            document.getElementById('buttonText').classList.add('hidden');
            document.getElementById('countdown').classList.remove('hidden');
            document.getElementById('countdown').textContent = countdownValue;
            
            holdTimer = setInterval(() => {
                countdownValue--;
                document.getElementById('countdown').textContent = countdownValue;
                if (countdownValue <= 0) {
                    clearInterval(holdTimer);
                    triggerEmergency();
                }
            }, 1000);
        });
        
        sosButton.addEventListener('mouseup', cancelHold);
        sosButton.addEventListener('mouseleave', cancelHold);
        
        function cancelHold() {
            if (holdTimer && !emergencyActive) {
                clearInterval(holdTimer);
                document.getElementById('buttonText').classList.remove('hidden');
                document.getElementById('countdown').classList.add('hidden');
            }
        }
        
        // ========== TRIGGER EMERGENCY ==========
        function triggerEmergency() {
            if (emergencyActive) return;
            emergencyActive = true;
            document.getElementById('emergencyModal').style.display = 'flex';
            showNotification('üö® Emergency activated', 'emergency');
        }
        
        // ========== EMERGENCY FEATURES ==========
        function shareViaWhatsApp() {
            const message = `üö® EMERGENCY ALERT from SOS Guardian Pro!\n\nüìç Time: ${new Date().toLocaleString()}\nüë§ User needs emergency assistance!`;
            const url = `https://wa.me/?text=${encodeURIComponent(message)}`;
            window.open(url, '_blank');
            showNotification('üì± Opening WhatsApp', 'success');
        }
        
        function shareLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (pos) => {
                        const lat = pos.coords.latitude.toFixed(6);
                        const lng = pos.coords.longitude.toFixed(6);
                        const mapsUrl = `https://www.google.com/maps?q=${lat},${lng}`;
                        
                        if (navigator.clipboard) {
                            navigator.clipboard.writeText(`${lat}, ${lng}`);
                            showNotification('üìç Coordinates copied to clipboard', 'success');
                        }
                        
                        window.open(mapsUrl, '_blank');
                    },
                    () => showNotification('üìç GPS access denied', 'error')
                );
            }
        }
        
        function capturePhoto() {
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                showNotification('üì∏ Camera not available', 'error');
                return;
            }
            
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(stream => {
                    const video = document.createElement('video');
                    video.srcObject = stream;
                    video.play();
                    
                    const cameraUI = document.createElement('div');
                    cameraUI.innerHTML = `
                        <div style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#111;padding:20px;border-radius:15px;z-index:10001;">
                            <h3 style="color:white;margin:0 0 15px 0;">üì∏ Camera</h3>
                            <video id="cameraFeed" style="width:300px;border-radius:10px;"></video>
                            <div style="text-align:center;margin:20px 0;">
                                <button onclick="takeSnapshot()" style="background:#f44336;color:white;border:none;padding:12px;border-radius:8px;margin:5px;">
                                    Capture
                                </button>
                                <button onclick="closeCamera()" style="background:#666;color:white;border:none;padding:12px;border-radius:8px;margin:5px;">
                                    Close
                                </button>
                            </div>
                        </div>
                        <div style="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.9);z-index:10000;"></div>
                    `;
                    
                    document.body.appendChild(cameraUI);
                    document.getElementById('cameraFeed').srcObject = stream;
                    window.currentCameraStream = stream;
                })
                .catch(() => showNotification('üì∏ Camera permission denied', 'error'));
        }
        
        function takeSnapshot() {
            const video = document.getElementById('cameraFeed');
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            
            const photoData = canvas.toDataURL('image/jpeg');
            closeCamera();
            
            // Save photo
            const link = document.createElement('a');
            link.download = `sos-photo-${Date.now()}.jpg`;
            link.href = photoData;
            link.click();
            
            showNotification('üì∏ Photo saved to device', 'success');
        }
        
        function closeCamera() {
            if (window.currentCameraStream) {
                window.currentCameraStream.getTracks().forEach(track => track.stop());
            }
            
            // Remove camera UI
            document.querySelectorAll('div').forEach(div => {
                if (div.style.position === 'fixed' && div.style.zIndex >= 10000) {
                    div.remove();
                }
            });
        }
        
        function closeModal() {
            document.getElementById('emergencyModal').style.display = 'none';
            emergencyActive = false;
            shakeCount = 0;
            updateShakeDisplay();
            document.getElementById('buttonText').classList.remove('hidden');
            document.getElementById('countdown').classList.add('hidden');
            showNotification('Emergency cancelled', 'info');
        }
        
        // ========== NOTIFICATION ==========
        function showNotification(message, type = 'info') {
            const container = document.createElement('div');
            container.className = 'notification';
            container.textContent = message;
            
            if (type === 'error') container.style.borderLeftColor = '#ff3b30';
            if (type === 'success') container.style.borderLeftColor = '#4CAF50';
            if (type === 'emergency') container.style.borderLeftColor = '#ff9500';
            
            document.body.appendChild(container);
            
            setTimeout(() => {
                container.style.animation = 'slideIn 0.5s ease-out reverse';
                setTimeout(() => container.remove(), 500);
            }, 3000);
        }
        
        // ========== INITIALIZE ==========
        window.addEventListener('load', () => {
            getLocation();
            if (window.DeviceMotionEvent) {
                window.addEventListener('devicemotion', handleShake);
                showNotification('Shake detection active', 'success');
            }
            showNotification('SOS Guardian Pro DEMO loaded', 'success');
        });
        
        // Auto location update
        setInterval(getLocation, 30000);
    </script>
</body>
</html>
