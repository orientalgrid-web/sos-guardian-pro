<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    
    <title>SOS-Guardian-Pro</title>
    
    <!-- Mapbox for Satellite View & Routing -->
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.css' rel='stylesheet' />
    <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.0/mapbox-gl-directions.js'></script>
    <link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.0/mapbox-gl-directions.css' type='text/css' />
    
    <link rel="manifest" href="manifest.webmanifest">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root {
            --stealth-bg: #000000;
            --stealth-text: #00FF00;
            --stealth-accent: #008751;
            --stealth-alert: #FF3B30;
            --stealth-twilio: #F22F46;
            --stealth-gray: #333333;
            --stealth-satellite: #1a5fb4;
            --stealth-route: #FF6B35;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: var(--stealth-bg);
            color: var(--stealth-text);
            position: fixed;
            user-select: none;
        }

        #app {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        /* === STEALTH LOADING SCREEN === */
        .stealth-loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--stealth-bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .stealth-spinner {
            width: 60px;
            height: 60px;
            border: 3px solid var(--stealth-gray);
            border-top-color: var(--stealth-text);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* === PHONE INTERFACE === */
        .phone-interface {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a1a, #0a0a0a);
            display: flex;
            flex-direction: column;
            padding: 20px;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            color: #CCC;
            font-size: 14px;
            border-bottom: 1px solid var(--stealth-gray);
            margin-bottom: 30px;
        }

        .app-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            padding: 20px;
        }

        .app-icon {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .app-icon:hover {
            background: rgba(255,255,255,0.15);
            transform: scale(1.05);
        }

        .app-icon i { 
            font-size: 28px; 
            margin-bottom: 10px; 
            color: #CCC; 
        }
        
        .app-name { 
            font-size: 12px; 
            color: #AAA; 
        }

        .volume-trigger {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: rgba(0,0,0,0.8);
            border: 2px solid var(--stealth-text);
            border-radius: 50%;
            width: 70px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            cursor: pointer;
            z-index: 1000;
            animation: pulse 2s infinite;
            transition: all 0.3s;
        }

        .volume-trigger:hover {
            background: rgba(255,59,48,0.3);
            border-color: var(--stealth-alert);
            transform: scale(1.1);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* === CONFIG PANEL === */
        .hidden-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.98);
            z-index: 3000;
            display: none;
            overflow-y: auto;
            padding: 20px;
            color: var(--stealth-text);
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--stealth-gray);
        }

        .panel-content {
            max-width: 500px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #CCC;
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            background: #222;
            border: 1px solid var(--stealth-gray);
            border-radius: 8px;
            color: white;
            font-size: 16px;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--stealth-text);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            margin: 15px 0;
        }

        .checkbox-input {
            margin-right: 10px;
            width: 18px;
            height: 18px;
        }

        /* === TWILIO CONFIG SECTION === */
        .twilio-config {
            background: rgba(242, 47, 70, 0.1);
            border: 1px solid var(--stealth-twilio);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .twilio-header {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--stealth-twilio);
            margin-bottom: 15px;
        }

        /* === EMERGENCY MODAL === */
        .emergency-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 4000;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-content {
            background: var(--stealth-bg);
            border: 3px solid var(--stealth-alert);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .countdown {
            font-size: 48px;
            font-weight: bold;
            color: var(--stealth-alert);
            margin: 20px 0;
            text-shadow: 0 0 10px rgba(255,59,48,0.5);
        }

        /* === SATELLITE SCAN MODAL === */
        .satellite-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 5000;
            display: none;
            flex-direction: column;
            padding: 20px;
        }

        .satellite-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            color: white;
            padding: 15px;
            background: rgba(26, 95, 180, 0.2);
            border-radius: 10px;
            border: 1px solid var(--stealth-satellite);
        }

        #satelliteMap {
            flex: 1;
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid var(--stealth-satellite);
            background: #000;
            position: relative;
        }

        /* === ROUTE PLANNING MODAL === */
        .route-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 6000;
            display: none;
            flex-direction: column;
            padding: 20px;
        }

        .route-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            color: white;
            padding: 15px;
            background: rgba(255, 107, 53, 0.2);
            border-radius: 10px;
            border: 1px solid var(--stealth-route);
        }

        #routeMap {
            flex: 1;
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid var(--stealth-route);
            background: #000;
            position: relative;
        }

        .route-controls {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0,0,0,0.7);
            border-radius: 10px;
            border: 1px solid var(--stealth-gray);
        }

        .route-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .route-stat {
            background: #222;
            padding: 10px;
            border-radius: 8px;
            font-size: 12px;
        }

        /* === SCANNING OVERLAY === */
        .scanning-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(26, 95, 180, 0.1),
                transparent
            );
            animation: scanning 2s linear infinite;
            pointer-events: none;
            z-index: 2;
            display: none;
        }

        @keyframes scanning {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* === COORDINATES DISPLAY === */
        .coordinates-display {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: var(--stealth-text);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 12px;
            font-family: 'Courier New', monospace;
            z-index: 10;
            border: 1px solid var(--stealth-satellite);
        }

        /* === SYSTEM STATUS === */
        .system-status {
            position: fixed;
            bottom: 20px;
            left: 20px;
            display: flex;
            gap: 15px;
            background: rgba(0,0,0,0.7);
            padding: 10px 15px;
            border-radius: 10px;
        }

        .status-dot { 
            width: 10px; 
            height: 10px; 
            background: #666; 
            border-radius: 50%; 
        }
        
        .status-dot.active { 
            background: var(--stealth-text); 
            box-shadow: 0 0 10px var(--stealth-text); 
            animation: glow 2s infinite;
        }
        
        .status-dot.warning { 
            background: #FFA500; 
            box-shadow: 0 0 10px #FFA500;
            animation: blink 1s infinite;
        }
        
        .status-dot.satellite { 
            background: var(--stealth-satellite); 
            box-shadow: 0 0 10px var(--stealth-satellite);
            animation: satelliteGlow 3s infinite;
        }
        
        .status-dot.route { 
            background: var(--stealth-route); 
            box-shadow: 0 0 10px var(--stealth-route);
            animation: routeGlow 3s infinite;
        }
        
        .status-label { 
            font-size: 12px; 
            color: #666; 
        }

        @keyframes glow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        @keyframes satelliteGlow {
            0%, 100% { 
                opacity: 0.7; 
                box-shadow: 0 0 5px var(--stealth-satellite);
            }
            50% { 
                opacity: 1; 
                box-shadow: 0 0 15px var(--stealth-satellite);
            }
        }

        @keyframes routeGlow {
            0%, 100% { 
                opacity: 0.7; 
                box-shadow: 0 0 5px var(--stealth-route);
            }
            50% { 
                opacity: 1; 
                box-shadow: 0 0 15px var(--stealth-route);
            }
        }

        /* === BUTTONS === */
        .stealth-btn {
            width: 100%;
            padding: 15px;
            margin-top: 10px;
            border-radius: 10px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-alert { 
            background: var(--stealth-alert); 
            color: white; 
        }
        
        .btn-alert:hover {
            background: #FF1A1A;
            transform: translateY(-2px);
        }
        
        .btn-stealth { 
            background: var(--stealth-gray); 
            color: var(--stealth-text); 
        }
        
        .btn-stealth:hover {
            background: #444;
            transform: translateY(-2px);
        }
        
        .btn-green { 
            background: var(--stealth-accent); 
            color: white; 
        }
        
        .btn-green:hover {
            background: #00AA66;
            transform: translateY(-2px);
        }
        
        .btn-satellite { 
            background: var(--stealth-satellite); 
            color: white; 
        }
        
        .btn-satellite:hover {
            background: #0c77e0;
            transform: translateY(-2px);
        }
        
        .btn-route { 
            background: var(--stealth-route); 
            color: white; 
        }
        
        .btn-route:hover {
            background: #FF8535;
            transform: translateY(-2px);
        }
        
        .btn-twilio { 
            background: var(--stealth-twilio); 
            color: white; 
        }
        
        .btn-twilio:hover {
            background: #D42A3D;
            transform: translateY(-2px);
        }

        /* === TEST MODE INDICATOR === */
        .test-mode {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #FFA500;
            color: black;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: bold;
            display: none;
            z-index: 1001;
        }

        /* === TOAST NOTIFICATION === */
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            border: 1px solid var(--stealth-accent);
            z-index: 7000;
            display: none;
            max-width: 90%;
            text-align: center;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                transform: translateX(-50%) translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }

        /* === LOADING OVERLAY === */
        .map-loading {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            color: var(--stealth-text);
        }

        /* === TAB SYSTEM === */
        .tab-container {
            display: flex;
            background: #222;
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 20px;
        }

        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 14px;
        }

        .tab.active {
            background: var(--stealth-accent);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* === RESPONSIVE === */
        @media (max-width: 480px) {
            .app-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 15px;
                padding: 15px;
            }
            
            .volume-trigger {
                width: 60px;
                height: 60px;
                bottom: 20px;
                right: 20px;
                font-size: 24px;
            }
            
            .modal-content {
                padding: 25px;
            }
            
            .satellite-header, .route-header {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            
            .coordinates-display {
                bottom: 10px;
                left: 10px;
                right: 10px;
                font-size: 10px;
            }
            
            .route-info {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="stealth-loading" id="loadingScreen">
        <div class="stealth-spinner"></div>
        <div>SOS-Guardian-Pro</div>
        <div style="font-size: 12px; color: #666;">Initializing Security Systems...</div>
    </div>

    <!-- Test Mode Indicator -->
    <div class="test-mode" id="testModeIndicator">TEST MODE</div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- Main Phone Interface -->
    <div id="phoneInterface" style="display: none;">
        <div class="phone-interface">
            <div class="status-bar">
                <div id="currentTime">09:41</div>
                <div><i class="fas fa-signal" id="signalIcon"></i> <span id="networkStatus">4G</span></div>
            </div>

            <div class="app-grid">
                <div class="app-icon" onclick="showToast('Phone app would open')">
                    <i class="fas fa-phone"></i>
                    <div class="app-name">Phone</div>
                </div>
                <div class="app-icon" id="settingsApp">
                    <i class="fas fa-gear"></i>
                    <div class="app-name">Settings</div>
                </div>
                <div class="app-icon" id="satelliteScanApp">
                    <i class="fas fa-satellite"></i>
                    <div class="app-name">Sat Scan</div>
                </div>
                <div class="app-icon" id="routePlanApp">
                    <i class="fas fa-route"></i>
                    <div class="app-name">Route Plan</div>
                </div>
            </div>
        </div>

        <!-- SOS Trigger Button -->
        <div class="volume-trigger" id="sosTrigger">
            <i class="fas fa-shield-alt"></i>
        </div>

        <!-- System Status -->
        <div class="system-status">
            <div class="status-dot" id="gpsStatus"></div>
            <span class="status-label">GPS</span>
            <div class="status-dot" id="netStatus"></div>
            <span class="status-label">NET</span>
            <div class="status-dot" id="batteryStatus"></div>
            <span class="status-label">BAT</span>
            <div class="status-dot" id="satelliteStatus"></div>
            <span class="status-label">SAT</span>
            <div class="status-dot" id="routeStatus"></div>
            <span class="status-label">ROUTE</span>
        </div>
    </div>

    <!-- Configuration Panel -->
    <div class="hidden-panel" id="configPanel">
        <div class="panel-content">
            <div class="panel-header">
                <h2><i class="fas fa-user-secret"></i> SOS Configuration</h2>
                <button class="stealth-btn btn-stealth" onclick="closeConfig()" style="width: auto; padding: 10px 20px;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- Tab Navigation -->
            <div class="tab-container">
                <div class="tab active" onclick="switchTab('contacts')">Contacts</div>
                <div class="tab" onclick="switchTab('twilio')">Twilio</div>
                <div class="tab" onclick="switchTab('routes')">Routes</div>
                <div class="tab" onclick="switchTab('settings')">Settings</div>
            </div>
            
            <!-- Contacts Tab -->
            <div id="contactsTab" class="tab-content active">
                <div class="form-group">
                    <label class="form-label">Emergency Contact 1 (with country code)</label>
                    <input type="text" class="form-input" id="contact1" placeholder="+2348103365359">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Emergency Contact 2 (with country code)</label>
                    <input type="text" class="form-input" id="contact2" placeholder="+2349088757570">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Emergency Message</label>
                    <textarea class="form-input" id="emergencyMessage" rows="4">üö® SOS-GUARDIAN-PRO ALERT! 

User requires immediate assistance.

üìç Location: {{LOCATION}}
üïê Time: {{TIME}}
üîã Battery: {{BATTERY}}%
üì∂ Network: {{NETWORK}}
üõ∞Ô∏è Satellite Scan: {{SATELLITE_LINK}}
üó∫Ô∏è Route: {{ROUTE_INFO}}

Please respond urgently.</textarea>
                </div>
            </div>
            
            <!-- Twilio Configuration Tab -->
            <div id="twilioTab" class="tab-content">
                <div class="twilio-config">
                    <div class="twilio-header">
                        <i class="fas fa-comment-sms"></i>
                        <h3>Twilio SMS Configuration</h3>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Twilio Account SID</label>
                        <input type="text" class="form-input" id="twilioSid" placeholder="AC4fb1c1b8af2739e2e06c3fb593eb664f">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Twilio Auth Token</label>
                        <input type="password" class="form-input" id="twilioToken" placeholder="b0db4c5717d4f3db5edd7df987c979d2">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Twilio Phone Number</label>
                        <input type="text" class="form-input" id="twilioNumber" placeholder="+12608297880">
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" class="checkbox-input" id="enableTwilio">
                        <label class="form-label" style="margin: 0;">Enable Twilio SMS Delivery</label>
                    </div>
                    
                    <button class="stealth-btn btn-twilio" onclick="testTwilioConnection()">
                        <i class="fas fa-plug"></i> Test Twilio Connection
                    </button>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: rgba(0,0,0,0.5); border-radius: 10px;">
                    <p style="color: #666; font-size: 12px;">
                        <i class="fas fa-info-circle"></i> 
                        Twilio allows reliable SMS delivery. Get credentials from 
                        <a href="https://www.twilio.com" target="_blank" style="color: var(--stealth-twilio);">twilio.com</a>
                    </p>
                </div>
            </div>
            
            <!-- Routes Tab -->
            <div id="routesTab" class="tab-content">
                <div class="form-group">
                    <label class="form-label">Home Address</label>
                    <input type="text" class="form-input" id="homeAddress" placeholder="Enter your home address">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Work Address</label>
                    <input type="text" class="form-input" id="workAddress" placeholder="Enter your work address">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Frequent Route 1</label>
                    <input type="text" class="form-input" id="route1" placeholder="e.g., Gym, Market, School">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Frequent Route 2</label>
                    <input type="text" class="form-input" id="route2" placeholder="e.g., Hospital, Mall, Park">
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" class="checkbox-input" id="includeRouteInAlerts">
                    <label class="form-label" style="margin: 0;">Include Route Information in Alerts</label>
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" class="checkbox-input" id="monitorRouteDeviations">
                    <label class="form-label" style="margin: 0;">Monitor Route Deviations</label>
                </div>
                
                <button class="stealth-btn btn-route" onclick="saveRouteSettings()">
                    <i class="fas fa-save"></i> Save Route Settings
                </button>
            </div>
            
            <!-- Settings Tab -->
            <div id="settingsTab" class="tab-content">
                <div class="checkbox-group">
                    <input type="checkbox" class="checkbox-input" id="testMode">
                    <label class="form-label" style="margin: 0;">Test Mode (No real alerts sent)</label>
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" class="checkbox-input" id="silentMode">
                    <label class="form-label" style="margin: 0;">Silent Mode (No countdown)</label>
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" class="checkbox-input" id="enableGPS">
                    <label class="form-label" style="margin: 0;">Include GPS Location</label>
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" class="checkbox-input" id="enableSatellite">
                    <label class="form-label" style="margin: 0;">Enable Satellite Scan</label>
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" class="checkbox-input" id="enableRoutePlanning">
                    <label class="form-label" style="margin: 0;">Enable Route Planning</label>
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" class="checkbox-input" id="autoLocationUpdate">
                    <label class="form-label" style="margin: 0;">Auto Location Updates (Every 30s)</label>
                </div>
                
                <div class="form-group">
                    <label class="form-label">SOS Countdown (seconds)</label>
                    <input type="number" class="form-input" id="sosCountdown" value="3" min="1" max="10">
                </div>
            </div>
            
            <!-- Action Buttons -->
            <button class="stealth-btn btn-green" onclick="saveConfig()">
                <i class="fas fa-save"></i> Save All Configuration
            </button>
            
            <button class="stealth-btn btn-satellite" onclick="testAlert()">
                <i class="fas fa-bell"></i> Test Alert System
            </button>
            
            <button class="stealth-btn btn-stealth" onclick="showLogs()">
                <i class="fas fa-history"></i> View Alert Logs
            </button>
            
            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--stealth-gray);">
                <p style="color: #666; font-size: 12px; text-align: center;">
                    <i class="fas fa-shield-alt"></i> SOS Guardian Pro v5.0<br>
                    Complete Route & SMS Integration
                </p>
            </div>
        </div>
    </div>

    <!-- Emergency Modal -->
    <div class="emergency-modal" id="emergencyModal">
        <div class="modal-content">
            <h2 style="color: white; margin-bottom: 20px;">
                <i class="fas fa-exclamation-triangle"></i> SOS ACTIVATED
            </h2>
            <div class="countdown" id="countdownDisplay">3</div>
            <p id="modalMsg" style="color: #CCC; margin-bottom: 20px;">
                Emergency alert will trigger in 3 seconds...
            </p>
            <button class="stealth-btn btn-alert" id="confirmSOS">
                CONFIRM EMERGENCY
            </button>
            <button class="stealth-btn btn-stealth" id="cancelSOS">
                CANCEL
            </button>
        </div>
    </div>

    <!-- Satellite Scan Modal -->
    <div class="satellite-modal" id="satelliteModal">
        <div class="satellite-header">
            <div>
                <h2 style="color: white;">
                    <i class="fas fa-satellite"></i> LIVE SATELLITE SCAN
                </h2>
                <p style="color: #CCC; font-size: 12px;">
                    <i class="fas fa-map-marker-alt"></i> 
                    <span id="currentLocationText">Acquiring location...</span>
                </p>
            </div>
            <div>
                <button class="stealth-btn btn-satellite" onclick="startScan()" style="width: auto; padding: 10px 15px; margin-right: 10px;">
                    <i class="fas fa-sync-alt"></i> Scan
                </button>
                <button class="stealth-btn btn-stealth" onclick="closeSatelliteScan()" style="width: auto; padding: 10px 15px;">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
        </div>
        
        <div id="satelliteMap">
            <div class="map-loading" id="satelliteMapLoading">
                <div class="stealth-spinner" style="width: 40px; height: 40px;"></div>
                <div style="margin-top: 15px;">Loading satellite imagery...</div>
            </div>
            <div class="scanning-overlay" id="scanningOverlay"></div>
            <div class="coordinates-display" id="coordinatesDisplay">
                Lat: 0.000000 | Lng: 0.000000
            </div>
        </div>
        
        <div style="margin-top: 20px; padding: 15px; background: rgba(0,0,0,0.7); border-radius: 10px;">
            <div style="color: #CCC; font-size: 12px; line-height: 1.4;">
                <div><i class="fas fa-circle" style="color: #4CD964; font-size: 8px;"></i> <strong>Live View:</strong> Real-time satellite imagery</div>
                <div><i class="fas fa-circle" style="color: #FF9500; font-size: 8px;"></i> <strong>Accuracy:</strong> <span id="accuracyText">High</span></div>
                <div><i class="fas fa-circle" style="color: var(--stealth-satellite); font-size: 8px;"></i> <strong>Satellite:</strong> <span id="satelliteName">Sentinel-2B</span></div>
            </div>
        </div>
    </div>

    <!-- Route Planning Modal -->
    <div class="route-modal" id="routeModal">
        <div class="route-header">
            <div>
                <h2 style="color: white;">
                    <i class="fas fa-route"></i> ROUTE PLANNER
                </h2>
                <p style="color: #CCC; font-size: 12px;">
                    <i class="fas fa-directions"></i> 
                    <span id="routeStatusText">Plan your route below</span>
                </p>
            </div>
            <div>
                <button class="stealth-btn btn-route" onclick="saveCurrentRoute()" style="width: auto; padding: 10px 15px; margin-right: 10px;">
                    <i class="fas fa-save"></i> Save
                </button>
                <button class="stealth-btn btn-stealth" onclick="closeRoutePlan()" style="width: auto; padding: 10px 15px;">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
        </div>
        
        <div id="routeMap">
            <div class="map-loading" id="routeMapLoading">
                <div class="stealth-spinner" style="width: 40px; height: 40px;"></div>
                <div style="margin-top: 15px;">Loading route planner...</div>
            </div>
        </div>
        
        <div class="route-controls">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                <div>
                    <label style="color: #CCC; font-size: 12px; display: block; margin-bottom: 5px;">Start</label>
                    <input type="text" id="routeStart" class="form-input" placeholder="Current location" style="font-size: 12px; padding: 8px;">
                </div>
                <div>
                    <label style="color: #CCC; font-size: 12px; display: block; margin-bottom: 5px;">Destination</label>
                    <input type="text" id="routeEnd" class="form-input" placeholder="Enter destination" style="font-size: 12px; padding: 8px;">
                </div>
            </div>
            
            <div class="route-info">
                <div class="route-stat">
                    <div style="color: #666; font-size: 10px;">Distance</div>
                    <div id="routeDistance">-- km</div>
                </div>
                <div class="route-stat">
                    <div style="color: #666; font-size: 10px;">Duration</div>
                    <div id="routeDuration">-- min</div>
                </div>
                <div class="route-stat">
                    <div style="color: #666; font-size: 10px;">ETA</div>
                    <div id="routeETA">--:--</div>
                </div>
                <div class="route-stat">
                    <div style="color: #666; font-size: 10px;">Route</div>
                    <div id="routeType">Driving</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Logs Modal -->
    <div class="hidden-panel" id="logsPanel" style="display: none;">
        <div class="panel-content">
            <div class="panel-header">
                <h2><i class="fas fa-history"></i> Alert Logs</h2>
                <button class="stealth-btn btn-stealth" onclick="closeLogs()" style="width: auto; padding: 10px 20px;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="logsContent" style="color: #CCC; font-size: 14px;">
                Loading logs...
            </div>
            
            <button class="stealth-btn btn-stealth" onclick="clearLogs()" style="margin-top: 20px;">
                <i class="fas fa-trash"></i> Clear All Logs
            </button>
        </div>
    </div>

    <script>
        // Mapbox Access Token - Your Token Integrated
        mapboxgl.accessToken = 'pk.eyJ1IjoiZWtlaWRpbWF1Y2h1a3d1IiwiYSI6ImNtbDYxZ3NvazA2cDYza3NjOXlwNmx0aXcifQ.agDhj-euUG6sEyMTiDsQAA';

        // Global Guardian Application
        const Guardian = {
            // Configuration
            config: {
                // Contacts
                contacts: ["+2348103365359", "+2349088757570"],
                emergencyMessage: `üö® SOS-GUARDIAN-PRO ALERT! 

User requires immediate assistance.

üìç Location: {{LOCATION}}
üïê Time: {{TIME}}
üîã Battery: {{BATTERY}}%
üì∂ Network: {{NETWORK}}
üõ∞Ô∏è Satellite Scan: {{SATELLITE_LINK}}
üó∫Ô∏è Route: {{ROUTE_INFO}}

Please respond urgently.`,
                
                // Twilio Configuration
                twilio: {
                    sid: "AC4fb1c1b8af2739e2e06c3fb593eb664f",
                    token: "b0db4c5717d4f3db5edd7df987c979d2",
                    number: "+12608297880",
                    enabled: true
                },
                
                // Route Planning
                routes: {
                    home: "",
                    work: "",
                    frequent1: "",
                    frequent2: "",
                    includeInAlerts: true,
                    monitorDeviations: true
                },
                
                // Settings
                testMode: false,
                silentMode: false,
                enableGPS: true,
                enableSatellite: true,
                enableRoutePlanning: true,
                autoLocationUpdate: true,
                sosCountdown: 3
            },
            
            // Application state
            state: {
                // Location & Sensors
                currentLocation: null,
                batteryLevel: 100,
                networkStatus: true,
                gpsStatus: false,
                satelliteStatus: true,
                routeStatus: false,
                
                // Timers & Counters
                sosCountdown: null,
                lastSOSTime: 0,
                locationWatchId: null,
                
                // Map Instances
                satelliteMap: null,
                routeMap: null,
                directions: null,
                
                // Scanning State
                isScanning: false,
                scanInterval: null,
                
                // Current Route
                currentRoute: null,
                savedRoutes: [],
                
                // Twilio Status
                twilioConnected: false,
                
                // Satellite Names
                satelliteNames: [
                    "Sentinel-2B", "Landsat 8", "GOES-16", "NOAA-20",
                    "TerraSAR-X", "WorldView-3", "PlanetScope", "SkySat"
                ]
            },

            // Initialize application
            async init() {
                console.log('üöÄ SOS Guardian Pro v5.0 Initializing...');
                console.log('üó∫Ô∏è Mapbox Token Verified:', mapboxgl.accessToken.substring(0, 20) + '...');
                
                // Load configuration
                this.loadConfig();
                
                // Show main interface after loading
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                    document.getElementById('phoneInterface').style.display = 'block';
                    this.showToast('System Ready - Route Planning Active', 'success');
                    
                    // Initialize subsystems
                    this.initClock();
                    this.initNetworkMonitoring();
                    this.initBatteryMonitoring();
                    this.initGPS();
                    this.initEventListeners();
                    this.initStatusIndicators();
                    
                }, 2000);
            },

            // Load configuration from localStorage
            loadConfig() {
                try {
                    const savedConfig = localStorage.getItem('sos_config_v5');
                    if (savedConfig) {
                        this.config = JSON.parse(savedConfig);
                        this.updateConfigUI();
                    }
                } catch (e) {
                    console.warn('Could not load config:', e);
                }
                
                // Load saved routes
                try {
                    const savedRoutes = localStorage.getItem('sos_saved_routes');
                    if (savedRoutes) {
                        this.state.savedRoutes = JSON.parse(savedRoutes);
                    }
                } catch (e) {
                    console.warn('Could not load routes:', e);
                }
            },

            // Save configuration
            saveConfig() {
                try {
                    // Get values from UI
                    this.config.contacts = [
                        document.getElementById('contact1').value.trim(),
                        document.getElementById('contact2').value.trim()
                    ].filter(c => c.length > 0);
                    
                    this.config.twilio.sid = document.getElementById('twilioSid').value.trim();
                    this.config.twilio.token = document.getElementById('twilioToken').value.trim();
                    this.config.twilio.number = document.getElementById('twilioNumber').value.trim();
                    this.config.twilio.enabled = document.getElementById('enableTwilio').checked;
                    
                    this.config.routes.home = document.getElementById('homeAddress').value.trim();
                    this.config.routes.work = document.getElementById('workAddress').value.trim();
                    this.config.routes.frequent1 = document.getElementById('route1').value.trim();
                    this.config.routes.frequent2 = document.getElementById('route2').value.trim();
                    this.config.routes.includeInAlerts = document.getElementById('includeRouteInAlerts').checked;
                    this.config.routes.monitorDeviations = document.getElementById('monitorRouteDeviations').checked;
                    
                    this.config.testMode = document.getElementById('testMode').checked;
                    this.config.silentMode = document.getElementById('silentMode').checked;
                    this.config.enableGPS = document.getElementById('enableGPS').checked;
                    this.config.enableSatellite = document.getElementById('enableSatellite').checked;
                    this.config.enableRoutePlanning = document.getElementById('enableRoutePlanning').checked;
                    this.config.autoLocationUpdate = document.getElementById('autoLocationUpdate').checked;
                    this.config.sosCountdown = parseInt(document.getElementById('sosCountdown').value) || 3;
                    
                    this.config.emergencyMessage = document.getElementById('emergencyMessage').value;
                    
                    // Save to localStorage
                    localStorage.setItem('sos_config_v5', JSON.stringify(this.config));
                    
                    // Update UI
                    document.getElementById('testModeIndicator').style.display = 
                        this.config.testMode ? 'block' : 'none';
                    
                    // Update status indicators
                    this.updateStatusIndicators();
                    
                    this.showToast('Configuration saved successfully', 'success');
                    console.log('‚úÖ Config saved:', this.config);
                    
                } catch (e) {
                    console.error('‚ùå Error saving config:', e);
                    this.showToast('Error saving configuration', 'error');
                }
            },

            // Save route settings
            saveRouteSettings() {
                try {
                    this.config.routes.home = document.getElementById('homeAddress').value.trim();
                    this.config.routes.work = document.getElementById('workAddress').value.trim();
                    this.config.routes.frequent1 = document.getElementById('route1').value.trim();
                    this.config.routes.frequent2 = document.getElementById('route2').value.trim();
                    this.config.routes.includeInAlerts = document.getElementById('includeRouteInAlerts').checked;
                    this.config.routes.monitorDeviations = document.getElementById('monitorRouteDeviations').checked;
                    
                    localStorage.setItem('sos_config_v5', JSON.stringify(this.config));
                    this.showToast('Route settings saved', 'success');
                } catch (e) {
                    console.error('Error saving route settings:', e);
                    this.showToast('Error saving route settings', 'error');
                }
            },

            // Update configuration UI
            updateConfigUI() {
                // Contacts
                document.getElementById('contact1').value = this.config.contacts[0] || '';
                document.getElementById('contact2').value = this.config.contacts[1] || '';
                document.getElementById('emergencyMessage').value = this.config.emergencyMessage;
                
                // Twilio
                document.getElementById('twilioSid').value = this.config.twilio.sid;
                document.getElementById('twilioToken').value = this.config.twilio.token;
                document.getElementById('twilioNumber').value = this.config.twilio.number;
                document.getElementById('enableTwilio').checked = this.config.twilio.enabled;
                
                // Routes
                document.getElementById('homeAddress').value = this.config.routes.home || '';
                document.getElementById('workAddress').value = this.config.routes.work || '';
                document.getElementById('route1').value = this.config.routes.frequent1 || '';
                document.getElementById('route2').value = this.config.routes.frequent2 || '';
                document.getElementById('includeRouteInAlerts').checked = this.config.routes.includeInAlerts;
                document.getElementById('monitorRouteDeviations').checked = this.config.routes.monitorDeviations;
                
                // Settings
                document.getElementById('testMode').checked = this.config.testMode;
                document.getElementById('silentMode').checked = this.config.silentMode;
                document.getElementById('enableGPS').checked = this.config.enableGPS;
                document.getElementById('enableSatellite').checked = this.config.enableSatellite;
                document.getElementById('enableRoutePlanning').checked = this.config.enableRoutePlanning;
                document.getElementById('autoLocationUpdate').checked = this.config.autoLocationUpdate;
                document.getElementById('sosCountdown').value = this.config.sosCountdown;
                
                document.getElementById('testModeIndicator').style.display = 
                    this.config.testMode ? 'block' : 'none';
            },

            // Switch tabs in config panel
            switchTab(tabId) {
                // Hide all tabs
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // Deactivate all tab buttons
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // Show selected tab
                document.getElementById(tabId + 'Tab').classList.add('active');
                
                // Activate selected tab button
                document.querySelectorAll('.tab').forEach(tab => {
                    if (tab.textContent.toLowerCase().includes(tabId)) {
                        tab.classList.add('active');
                    }
                });
            },

            // Initialize clock
            initClock() {
                const updateClock = () => {
                    const now = new Date();
                    const timeStr = now.getHours().toString().padStart(2, '0') + ':' + 
                                   now.getMinutes().toString().padStart(2, '0');
                    document.getElementById('currentTime').textContent = timeStr;
                };
                updateClock();
                setInterval(updateClock, 1000);
            },

            // Initialize network monitoring
            initNetworkMonitoring() {
                const updateNetworkStatus = () => {
                    this.state.networkStatus = navigator.onLine;
                    
                    const netStatusEl = document.getElementById('netStatus');
                    const signalIcon = document.getElementById('signalIcon');
                    
                    if (this.state.networkStatus) {
                        netStatusEl.className = 'status-dot active';
                        signalIcon.className = 'fas fa-signal';
                        document.getElementById('networkStatus').textContent = 'Online';
                    } else {
                        netStatusEl.className = 'status-dot warning';
                        signalIcon.className = 'fas fa-signal-slash';
                        document.getElementById('networkStatus').textContent = 'Offline';
                    }
                };
                
                updateNetworkStatus();
                window.addEventListener('online', updateNetworkStatus);
                window.addEventListener('offline', updateNetworkStatus);
            },

            // Initialize battery monitoring
            initBatteryMonitoring() {
                if ('getBattery' in navigator) {
                    navigator.getBattery().then(battery => {
                        this.updateBatteryStatus(battery);
                        
                        battery.addEventListener('levelchange', () => {
                            this.updateBatteryStatus(battery);
                        });
                        
                        battery.addEventListener('chargingchange', () => {
                            this.updateBatteryStatus(battery);
                        });
                    });
                } else {
                    // Fallback
                    this.updateBatteryStatus({ level: 0.85, charging: false });
                }
            },

            // Update battery status
            updateBatteryStatus(battery) {
                this.state.batteryLevel = Math.round(battery.level * 100);
                const batteryEl = document.getElementById('batteryStatus');
                
                if (battery.charging) {
                    batteryEl.className = 'status-dot active';
                } else if (this.state.batteryLevel < 20) {
                    batteryEl.className = 'status-dot warning';
                } else {
                    batteryEl.className = 'status-dot active';
                }
            },

            // Initialize GPS
            initGPS() {
                if (!navigator.geolocation) {
                    console.warn('Geolocation not supported');
                    this.state.gpsStatus = false;
                    document.getElementById('gpsStatus').className = 'status-dot warning';
                    return;
                }
                
                // Get initial position
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        this.state.currentLocation = position;
                        this.state.gpsStatus = true;
                        document.getElementById('gpsStatus').className = 'status-dot active';
                        console.log('üìç GPS acquired:', position.coords);
                        
                        // Start auto updates if enabled
                        if (this.config.autoLocationUpdate) {
                            this.startAutoLocationUpdates();
                        }
                    },
                    (error) => {
                        console.warn('GPS error:', error.message);
                        this.state.gpsStatus = false;
                        document.getElementById('gpsStatus').className = 'status-dot warning';
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            },

            // Start auto location updates
            startAutoLocationUpdates() {
                if (this.state.locationWatchId) {
                    navigator.geolocation.clearWatch(this.state.locationWatchId);
                }
                
                this.state.locationWatchId = navigator.geolocation.watchPosition(
                    (position) => {
                        this.state.currentLocation = position;
                        this.state.gpsStatus = true;
                        document.getElementById('gpsStatus').className = 'status-dot active';
                        
                        // Update maps if they're open
                        if (this.state.satelliteMap) {
                            this.updateSatelliteMapLocation(position);
                        }
                        
                        if (this.state.routeMap && this.state.directions) {
                            this.updateRouteMapLocation(position);
                        }
                    },
                    () => {
                        this.state.gpsStatus = false;
                        document.getElementById('gpsStatus').className = 'status-dot warning';
                    },
                    {
                        enableHighAccuracy: true,
                        maximumAge: 30000,
                        timeout: 5000
                    }
                );
            },

            // Initialize event listeners
            initEventListeners() {
                // SOS Trigger
                document.getElementById('sosTrigger').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.triggerSOS();
                });
                
                // Settings App
                document.getElementById('settingsApp').addEventListener('click', () => {
                    this.openConfig();
                });
                
                // Satellite Scan App
                document.getElementById('satelliteScanApp').addEventListener('click', () => {
                    this.openSatelliteScan();
                });
                
                // Route Plan App
                document.getElementById('routePlanApp').addEventListener('click', () => {
                    this.openRoutePlan();
                });
                
                // Emergency Modal Buttons
                document.getElementById('confirmSOS').addEventListener('click', () => {
                    this.sendEmergencyAlert();
                });
                
                document.getElementById('cancelSOS').addEventListener('click', () => {
                    this.cancelSOS();
                });
                
                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    // Ctrl+Shift+S for SOS
                    if (e.ctrlKey && e.shiftKey && e.key === 'S') {
                        this.triggerSOS();
                    }
                    
                    // Escape to cancel
                    if (e.key === 'Escape') {
                        this.cancelSOS();
                        this.closeSatelliteScan();
                        this.closeRoutePlan();
                    }
                    
                    // S for satellite scan
                    if (e.key === 's' || e.key === 'S') {
                        this.openSatelliteScan();
                    }
                    
                    // R for route plan
                    if (e.key === 'r' || e.key === 'R') {
                        this.openRoutePlan();
                    }
                });
            },

            // Initialize status indicators
            initStatusIndicators() {
                // Satellite status
                const satelliteEl = document.getElementById('satelliteStatus');
                satelliteEl.className = 'status-dot satellite active';
                
                // Route status
                const routeEl = document.getElementById('routeStatus');
                routeEl.className = 'status-dot route active';
                
                // Twilio status check
                this.checkTwilioStatus();
            },

            // Check Twilio status
            async checkTwilioStatus() {
                if (!this.config.twilio.enabled || !this.config.twilio.sid || !this.config.twilio.token) {
                    this.state.twilioConnected = false;
                    return;
                }
                
                try {
                    // Test Twilio connection
                    const credentials = btoa(`${this.config.twilio.sid}:${this.config.twilio.token}`);
                    const response = await fetch(
                        `https://api.twilio.com/2010-04-01/Accounts/${this.config.twilio.sid}.json`,
                        {
                            headers: {
                                'Authorization': `Basic ${credentials}`
                            }
                        }
                    );
                    
                    this.state.twilioConnected = response.ok;
                    
                    if (this.state.twilioConnected) {
                        console.log('‚úÖ Twilio connection successful');
                    } else {
                        console.warn('‚ö†Ô∏è Twilio connection failed');
                    }
                } catch (error) {
                    console.error('‚ùå Twilio check error:', error);
                    this.state.twilioConnected = false;
                }
            },

            // Test Twilio connection
            async testTwilioConnection() {
                if (!this.config.twilio.sid || !this.config.twilio.token) {
                    this.showToast('Please enter Twilio credentials first', 'warning');
                    return;
                }
                
                this.showToast('Testing Twilio connection...', 'info');
                
                try {
                    const credentials = btoa(`${this.config.twilio.sid}:${this.config.twilio.token}`);
                    const response = await fetch(
                        `https://api.twilio.com/2010-04-01/Accounts/${this.config.twilio.sid}.json`,
                        {
                            headers: {
                                'Authorization': `Basic ${credentials}`
                            }
                        }
                    );
                    
                    if (response.ok) {
                        this.state.twilioConnected = true;
                        this.showToast('‚úÖ Twilio connection successful!', 'success');
                    } else {
                        this.state.twilioConnected = false;
                        this.showToast('‚ùå Twilio connection failed', 'error');
                    }
                } catch (error) {
                    this.state.twilioConnected = false;
                    this.showToast('‚ùå Twilio connection error', 'error');
                }
            },

            // Open configuration
            openConfig() {
                document.getElementById('configPanel').style.display = 'block';
            },

            // Close configuration
            closeConfig() {
                document.getElementById('configPanel').style.display = 'none';
            },

            // Open satellite scan
            openSatelliteScan() {
                if (!this.config.enableSatellite) {
                    this.showToast('Satellite scan is disabled in settings', 'warning');
                    return;
                }
                
                document.getElementById('satelliteModal').style.display = 'flex';
                
                // Initialize map if not already done
                if (!this.state.satelliteMap) {
                    this.initSatelliteMap();
                }
                
                // Update location display
                this.updateLocationDisplay();
                
                // Random satellite name
                const randomSat = this.state.satelliteNames[Math.floor(Math.random() * this.state.satelliteNames.length)];
                document.getElementById('satelliteName').textContent = randomSat;
                
                // Random accuracy
                const accuracies = ['High', 'Medium', 'Optimal', 'Good'];
                document.getElementById('accuracyText').textContent = 
                    accuracies[Math.floor(Math.random() * accuracies.length)];
                
                this.showToast('Satellite scan activated', 'success');
            },

            // Close satellite scan
            closeSatelliteScan() {
                document.getElementById('satelliteModal').style.display = 'none';
                this.stopScan();
            },

            // Open route plan
            openRoutePlan() {
                if (!this.config.enableRoutePlanning) {
                    this.showToast('Route planning is disabled in settings', 'warning');
                    return;
                }
                
                document.getElementById('routeModal').style.display = 'flex';
                
                // Initialize map if not already done
                if (!this.state.routeMap) {
                    this.initRouteMap();
                }
                
                this.showToast('Route planner activated', 'success');
            },

            // Close route plan
            closeRoutePlan() {
                document.getElementById('routeModal').style.display = 'none';
            },

            // Start scanning
            startScan() {
                if (this.state.isScanning) {
                    this.stopScan();
                    return;
                }
                
                this.state.isScanning = true;
                document.getElementById('scanningOverlay').style.display = 'block';
                
                // Start simulated scan updates
                this.state.scanInterval = setInterval(() => {
                    if (this.state.currentLocation) {
                        // Add some random variation to simulate scanning
                        const lat = this.state.currentLocation.coords.latitude + (Math.random() - 0.5) * 0.001;
                        const lng = this.state.currentLocation.coords.longitude + (Math.random() - 0.5) * 0.001;
                        
                        document.getElementById('coordinatesDisplay').innerHTML = 
                            `Lat: ${lat.toFixed(6)} | Lng: ${lng.toFixed(6)}`;
                    }
                }, 1000);
                
                this.showToast('Satellite scan started', 'info');
            },

            // Stop scanning
            stopScan() {
                this.state.isScanning = false;
                document.getElementById('scanningOverlay').style.display = 'none';
                
                if (this.state.scanInterval) {
                    clearInterval(this.state.scanInterval);
                    this.state.scanInterval = null;
                }
                
                // Reset to actual location
                if (this.state.currentLocation) {
                    const coords = this.state.currentLocation.coords;
                    document.getElementById('coordinatesDisplay').innerHTML = 
                        `Lat: ${coords.latitude.toFixed(6)} | Lng: ${coords.longitude.toFixed(6)}`;
                }
            },

            // Initialize satellite map
            initSatelliteMap() {
                try {
                    console.log('üó∫Ô∏è Initializing Satellite Map...');
                    
                    // Default to Lagos coordinates if no GPS
                    const defaultCoords = { lng: 3.3792, lat: 6.5244 };
                    
                    this.state.satelliteMap = new mapboxgl.Map({
                        container: 'satelliteMap',
                        style: 'mapbox://styles/mapbox/satellite-streets-v12',
                        center: [defaultCoords.lng, defaultCoords.lat],
                        zoom: 16,
                        pitch: 60,
                        bearing: -17.6,
                        antialias: true
                    });
                    
                    // Hide loading when map is loaded
                    this.state.satelliteMap.on('load', () => {
                        console.log('‚úÖ Satellite map loaded successfully');
                        document.getElementById('satelliteMapLoading').style.display = 'none';
                        
                        // Add terrain
                        this.state.satelliteMap.addSource('mapbox-dem', {
                            'type': 'raster-dem',
                            'url': 'mapbox://mapbox.mapbox-terrain-dem-v1',
                            'tileSize': 512,
                            'maxzoom': 14
                        });
                        
                        this.state.satelliteMap.setTerrain({ 'source': 'mapbox-dem', 'exaggeration': 1.5 });
                        
                        // Add current location marker
                        if (this.state.currentLocation) {
                            this.updateSatelliteMapLocation(this.state.currentLocation);
                        }
                    });
                    
                    // Add navigation controls
                    this.state.satelliteMap.addControl(new mapboxgl.NavigationControl());
                    
                } catch (error) {
                    console.error('‚ùå Error initializing satellite map:', error);
                    document.getElementById('satelliteMapLoading').innerHTML = `
                        <div style="text-align: center;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 40px; color: #FFA500;"></i>
                            <div style="margin-top: 15px; color: #FFA500;">Satellite map loading failed</div>
                        </div>
                    `;
                    this.showToast('Satellite map unavailable', 'error');
                }
            },

            // Initialize route map
            initRouteMap() {
                try {
                    console.log('üó∫Ô∏è Initializing Route Map...');
                    
                    // Default to Lagos coordinates
                    const defaultCoords = { lng: 3.3792, lat: 6.5244 };
                    
                    this.state.routeMap = new mapboxgl.Map({
                        container: 'routeMap',
                        style: 'mapbox://styles/mapbox/streets-v11',
                        center: [defaultCoords.lng, defaultCoords.lat],
                        zoom: 13
                    });
                    
                    // Hide loading when map is loaded
                    this.state.routeMap.on('load', () => {
                        console.log('‚úÖ Route map loaded successfully');
                        document.getElementById('routeMapLoading').style.display = 'none';
                        
                        // Initialize directions
                        this.state.directions = new MapboxDirections({
                            accessToken: mapboxgl.accessToken,
                            unit: 'metric',
                            profile: 'mapbox/driving',
                            controls: {
                                instructions: true,
                                profileSwitcher: true
                            },
                            flyTo: true
                        });
                        
                        // Add directions to map
                        this.state.routeMap.addControl(this.state.directions, 'top-left');
                        
                        // Listen for route changes
                        this.state.directions.on('route', (event) => {
                            this.updateRouteInfo(event.route);
                        });
                        
                        // Set current location as start if available
                        if (this.state.currentLocation) {
                            const coords = this.state.currentLocation.coords;
                            this.state.directions.setOrigin([coords.longitude, coords.latitude]);
                            document.getElementById('routeStart').value = 'Current Location';
                        }
                        
                        // Auto-fill destination if user has saved routes
                        if (this.config.routes.home) {
                            document.getElementById('routeEnd').value = this.config.routes.home;
                            this.state.directions.setDestination(this.config.routes.home);
                        }
                    });
                    
                    // Add geolocate control
                    const geolocate = new mapboxgl.GeolocateControl({
                        positionOptions: {
                            enableHighAccuracy: true
                        },
                        trackUserLocation: true
                    });
                    this.state.routeMap.addControl(geolocate);
                    
                } catch (error) {
                    console.error('‚ùå Error initializing route map:', error);
                    document.getElementById('routeMapLoading').innerHTML = `
                        <div style="text-align: center;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 40px; color: #FFA500;"></i>
                            <div style="margin-top: 15px; color: #FFA500;">Route map loading failed</div>
                        </div>
                    `;
                    this.showToast('Route map unavailable', 'error');
                }
            },

            // Update satellite map location
            updateSatelliteMapLocation(position) {
                if (!this.state.satelliteMap) return;
                
                const coords = position.coords;
                const lngLat = [coords.longitude, coords.latitude];
                
                // Fly to new location
                this.state.satelliteMap.flyTo({
                    center: lngLat,
                    zoom: 17,
                    duration: 2000
                });
                
                // Update coordinates display
                document.getElementById('coordinatesDisplay').innerHTML = 
                    `Lat: ${coords.latitude.toFixed(6)} | Lng: ${coords.longitude.toFixed(6)}`;
                
                // Update location text
                document.getElementById('currentLocationText').textContent = 
                    `${coords.latitude.toFixed(6)}, ${coords.longitude.toFixed(6)}`;
            },

            // Update route map location
            updateRouteMapLocation(position) {
                if (!this.state.routeMap || !this.state.directions) return;
                
                const coords = position.coords;
                this.state.directions.setOrigin([coords.longitude, coords.latitude]);
                document.getElementById('routeStart').value = 'Current Location';
            },

            // Update location display
            updateLocationDisplay() {
                if (this.state.currentLocation) {
                    const coords = this.state.currentLocation.coords;
                    document.getElementById('currentLocationText').textContent = 
                        `${coords.latitude.toFixed(6)}, ${coords.longitude.toFixed(6)}`;
                    
                    document.getElementById('coordinatesDisplay').innerHTML = 
                        `Lat: ${coords.latitude.toFixed(6)} | Lng: ${coords.longitude.toFixed(6)}`;
                }
            },

            // Update route information
            updateRouteInfo(route) {
                if (!route || route.length === 0) return;
                
                const firstRoute = route[0];
                this.state.currentRoute = firstRoute;
                
                // Update display
                document.getElementById('routeDistance').textContent = 
                    `${(firstRoute.distance / 1000).toFixed(1)} km`;
                
                document.getElementById('routeDuration').textContent = 
                    `${Math.round(firstRoute.duration / 60)} min`;
                
                // Calculate ETA
                const now = new Date();
                const eta = new Date(now.getTime() + firstRoute.duration * 1000);
                document.getElementById('routeETA').textContent = 
                    eta.getHours().toString().padStart(2, '0') + ':' + 
                    eta.getMinutes().toString().padStart(2, '0');
                
                // Update route type
                const profile = this.state.directions ? this.state.directions.getProfile() : 'driving';
                document.getElementById('routeType').textContent = 
                    profile.replace('mapbox/', '').charAt(0).toUpperCase() + 
                    profile.replace('mapbox/', '').slice(1);
                
                document.getElementById('routeStatusText').textContent = 'Route calculated';
            },

            // Save current route
            saveCurrentRoute() {
                if (!this.state.currentRoute) {
                    this.showToast('No route to save. Please plan a route first.', 'warning');
                    return;
                }
                
                const routeName = prompt('Enter a name for this route:', 'My Route');
                if (!routeName) return;
                
                const savedRoute = {
                    name: routeName,
                    route: this.state.currentRoute,
                    timestamp: new Date().toISOString(),
                    start: document.getElementById('routeStart').value,
                    end: document.getElementById('routeEnd').value
                };
                
                this.state.savedRoutes.push(savedRoute);
                
                // Save to localStorage
                localStorage.setItem('sos_saved_routes', JSON.stringify(this.state.savedRoutes));
                
                this.showToast(`Route "${routeName}" saved successfully`, 'success');
            },

            // Trigger SOS
            triggerSOS() {
                // Prevent rapid triggering
                const now = Date.now();
                if (now - this.state.lastSOSTime < 10000 && !this.config.testMode) {
                    this.showToast('Please wait before sending another alert', 'warning');
                    return;
                }
                
                this.state.lastSOSTime = now;
                
                if (this.config.silentMode) {
                    // Send immediately
                    this.sendEmergencyAlert();
                } else {
                    // Show countdown
                    this.showCountdownModal();
                }
            },

            // Show countdown modal
            showCountdownModal() {
                const modal = document.getElementById('emergencyModal');
                const countdownEl = document.getElementById('countdownDisplay');
                const msgEl = document.getElementById('modalMsg');
                
                modal.style.display = 'flex';
                let countdown = this.config.sosCountdown;
                
                countdownEl.textContent = countdown;
                msgEl.textContent = `Emergency alert will trigger in ${countdown} seconds...`;
                
                // Clear existing countdown
                if (this.state.sosCountdown) {
                    clearInterval(this.state.sosCountdown);
                }
                
                // Start countdown
                this.state.sosCountdown = setInterval(() => {
                    countdown--;
                    countdownEl.textContent = countdown;
                    
                    if (countdown > 0) {
                        msgEl.textContent = `Emergency alert will trigger in ${countdown} second${countdown !== 1 ? 's' : ''}...`;
                    } else {
                        clearInterval(this.state.sosCountdown);
                        this.sendEmergencyAlert();
                    }
                }, 1000);
            },

            // Cancel SOS
            cancelSOS() {
                if (this.state.sosCountdown) {
                    clearInterval(this.state.sosCountdown);
                    this.state.sosCountdown = null;
                }
                
                document.getElementById('emergencyModal').style.display = 'none';
                this.showToast('SOS cancelled', 'info');
            },

            // Send emergency alert via Twilio or backend
            async sendEmergencyAlert() {
                // Hide modal
                document.getElementById('emergencyModal').style.display = 'none';
                
                // Collect emergency data
                const emergencyData = await this.collectEmergencyData();
                
                // Create message with all information
                let message = this.config.emergencyMessage
                    .replace('{{LOCATION}}', emergencyData.location)
                    .replace('{{TIME}}', emergencyData.time)
                    .replace('{{BATTERY}}', emergencyData.battery)
                    .replace('{{NETWORK}}', emergencyData.network)
                    .replace('{{SATELLITE_LINK}}', emergencyData.satelliteLink)
                    .replace('{{ROUTE_INFO}}', emergencyData.routeInfo);
                
                if (this.config.testMode) {
                    // Test mode
                    this.showToast(
                        `TEST: Would send to ${this.config.contacts.length} contact(s)`,
                        'success'
                    );
                    this.logAlert('TEST', message, this.config.contacts);
                    return;
                }
                
                // Show sending status
                this.showToast('Sending emergency alerts...', 'info');
                
                let successCount = 0;
                let failCount = 0;
                
                for (let i = 0; i < this.config.contacts.length; i++) {
                    const contact = this.config.contacts[i];
                    if (!contact || contact.trim().length === 0) continue;
                    
                    try {
                        let sent = false;
                        
                        // Try Twilio first if enabled and connected
                        if (this.config.twilio.enabled && this.state.twilioConnected) {
                            try {
                                const result = await this.sendViaTwilio(contact, message);
                                if (result.success) {
                                    sent = true;
                                    successCount++;
                                    console.log(`‚úÖ Twilio SMS sent to ${contact}`);
                                }
                            } catch (twilioError) {
                                console.warn(`‚ùå Twilio failed for ${contact}:`, twilioError);
                            }
                        }
                        
                        // Fallback to browser SMS
                        if (!sent) {
                            try {
                                await this.sendViaSMSFallback(contact, message);
                                sent = true;
                                successCount++;
                                console.log(`üì± Browser SMS sent to ${contact}`);
                            } catch (smsError) {
                                console.error(`‚ùå SMS fallback failed for ${contact}:`, smsError);
                                failCount++;
                            }
                        }
                        
                        if (!sent) {
                            failCount++;
                        }
                        
                        // Small delay between sends
                        await new Promise(resolve => setTimeout(resolve, 500));
                        
                    } catch (error) {
                        console.error(`‚ùå Error sending to ${contact}:`, error);
                        failCount++;
                    }
                }
                
                // Show results
                if (successCount > 0) {
                    this.showToast(
                        `‚úÖ Alerts sent to ${successCount} contact(s)` + 
                        (failCount > 0 ? `, failed: ${failCount}` : ''),
                        'success'
                    );
                } else {
                    this.showToast('‚ùå Failed to send alerts to all contacts', 'error');
                }
                
                // Log the alert
                this.logAlert('EMERGENCY', message, this.config.contacts);
            },

            // Send via Twilio
            async sendViaTwilio(to, message) {
                try {
                    const credentials = btoa(`${this.config.twilio.sid}:${this.config.twilio.token}`);
                    
                    const formData = new URLSearchParams();
                    formData.append('To', to);
                    formData.append('From', this.config.twilio.number);
                    formData.append('Body', message);
                    
                    const response = await fetch(
                        `https://api.twilio.com/2010-04-01/Accounts/${this.config.twilio.sid}/Messages.json`,
                        {
                            method: 'POST',
                            headers: {
                                'Authorization': `Basic ${credentials}`,
                                'Content-Type': 'application/x-www-form-urlencoded'
                            },
                            body: formData
                        }
                    );
                    
                    if (!response.ok) {
                        throw new Error(`Twilio API error: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    return {
                        success: true,
                        sid: data.sid,
                        status: data.status
                    };
                    
                } catch (error) {
                    console.error('Twilio SMS error:', error);
                    return { success: false, error: error.message };
                }
            },

            // SMS fallback
            async sendViaSMSFallback(contact, message) {
                try {
                    const smsUrl = `sms:${contact}?body=${encodeURIComponent(message)}`;
                    window.location.href = smsUrl;
                    return { success: true, method: 'sms' };
                } catch (error) {
                    console.error('SMS fallback error:', error);
                    return { success: false, error: error.message };
                }
            },

            // Collect emergency data
            async collectEmergencyData() {
                const now = new Date();
                let location = "Location unavailable";
                let satelliteLink = "Satellite scan disabled";
                let routeInfo = "No route information";
                
                if (this.config.enableGPS && this.state.currentLocation) {
                    const coords = this.state.currentLocation.coords;
                    location = `https://maps.google.com/?q=${coords.latitude},${coords.longitude}`;
                    
                    // Generate satellite view link
                    if (this.config.enableSatellite) {
                        satelliteLink = `https://www.google.com/maps/@${coords.latitude},${coords.longitude},17z/data=!3m1!1e3`;
                    }
                    
                    // Get approximate address
                    try {
                        const response = await fetch(
                            `https://nominatim.openstreetmap.org/reverse?format=json&lat=${coords.latitude}&lon=${coords.longitude}&zoom=18&addressdetails=1`
                        );
                        if (response.ok) {
                            const data = await response.json();
                            if (data.display_name) {
                                const address = data.display_name.split(',').slice(0, 3).join(',');
                                location += `\nüìç ${address}`;
                            }
                        }
                    } catch (e) {
                        // Ignore reverse geocoding errors
                    }
                }
                
                // Add route information if available
                if (this.config.routes.includeInAlerts && this.state.currentRoute) {
                    routeInfo = `Route: ${document.getElementById('routeStart').value} to ${document.getElementById('routeEnd').value}`;
                    routeInfo += `\nDistance: ${(this.state.currentRoute.distance / 1000).toFixed(1)} km`;
                    routeInfo += `\nETA: ${document.getElementById('routeETA').textContent}`;
                } else if (this.config.routes.home || this.config.routes.work) {
                    routeInfo = "Common routes configured: ";
                    if (this.config.routes.home) routeInfo += "Home, ";
                    if (this.config.routes.work) routeInfo += "Work, ";
                    routeInfo = routeInfo.slice(0, -2);
                }
                
                return {
                    time: now.toLocaleString(),
                    location: location,
                    satelliteLink: satelliteLink,
                    routeInfo: routeInfo,
                    battery: this.state.batteryLevel,
                    network: this.state.networkStatus ? 'Online' : 'Offline',
                    timestamp: now.toISOString()
                };
            },

            // Log alert
            logAlert(type, message, contacts) {
                try {
                    const logs = JSON.parse(localStorage.getItem('sos_alert_logs') || '[]');
                    
                    logs.unshift({
                        id: Date.now(),
                        type: type,
                        timestamp: new Date().toISOString(),
                        contacts: contacts.length,
                        message: message.substring(0, 100) + '...',
                        testMode: this.config.testMode,
                        method: this.state.twilioConnected ? 'Twilio' : 'SMS'
                    });
                    
                    // Keep last 50 logs
                    if (logs.length > 50) {
                        logs.pop();
                    }
                    
                    localStorage.setItem('sos_alert_logs', JSON.stringify(logs));
                    
                } catch (e) {
                    console.error('Error logging alert:', e);
                }
            },

            // Show logs
            showLogs() {
                document.getElementById('configPanel').style.display = 'none';
                document.getElementById('logsPanel').style.display = 'block';
                
                try {
                    const logs = JSON.parse(localStorage.getItem('sos_alert_logs') || '[]');
                    const logsContent = document.getElementById('logsContent');
                    
                    if (logs.length === 0) {
                        logsContent.innerHTML = '<p style="color: #666; text-align: center;">No alert logs found.</p>';
                        return;
                    }
                    
                    let html = '<div style="display: flex; flex-direction: column; gap: 10px;">';
                    
                    logs.forEach(log => {
                        const date = new Date(log.timestamp);
                        const timeStr = date.toLocaleString();
                        
                        html += `
                            <div style="background: #222; padding: 15px; border-radius: 8px; border-left: 4px solid ${log.type === 'EMERGENCY' ? '#FF3B30' : '#FFA500'}">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <strong style="color: ${log.type === 'EMERGENCY' ? '#FF3B30' : '#FFA500'}">
                                        ${log.type}
                                    </strong>
                                    <small style="color: #666;">${timeStr}</small>
                                </div>
                                <div style="color: #AAA; font-size: 12px; margin-bottom: 5px;">
                                    To: ${log.contacts} contact(s) | 
                                    ${log.testMode ? 'TEST MODE' : 'REAL ALERT'} |
                                    Method: ${log.method || 'SMS'}
                                </div>
                                <div style="color: #CCC; font-size: 13px;">
                                    ${log.message}
                                </div>
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                    logsContent.innerHTML = html;
                    
                } catch (e) {
                    document.getElementById('logsContent').innerHTML = 
                        '<p style="color: #FF3B30;">Error loading logs.</p>';
                }
            },

            // Close logs
            closeLogs() {
                document.getElementById('logsPanel').style.display = 'none';
            },

            // Clear logs
            clearLogs() {
                if (confirm('Are you sure you want to clear all alert logs?')) {
                    localStorage.removeItem('sos_alert_logs');
                    document.getElementById('logsContent').innerHTML = 
                        '<p style="color: #666; text-align: center;">No alert logs found.</p>';
                    this.showToast('Logs cleared', 'info');
                }
            },

            // Test alert system
            testAlert() {
                const oldTestMode = this.config.testMode;
                this.config.testMode = true;
                
                this.showToast('Testing alert system...', 'info');
                setTimeout(() => {
                    this.triggerSOS();
                    this.config.testMode = oldTestMode;
                }, 1000);
            },

            // Show toast notification
            showToast(message, type = 'info') {
                const toast = document.getElementById('toast');
                toast.textContent = message;
                
                // Set color based on type
                switch (type) {
                    case 'error':
                        toast.style.borderColor = '#FF3B30';
                        toast.style.background = 'rgba(255, 59, 48, 0.1)';
                        break;
                    case 'success':
                        toast.style.borderColor = '#4CD964';
                        toast.style.background = 'rgba(76, 217, 100, 0.1)';
                        break;
                    case 'warning':
                        toast.style.borderColor = '#FF9500';
                        toast.style.background = 'rgba(255, 149, 0, 0.1)';
                        break;
                    default:
                        toast.style.borderColor = '#007AFF';
                        toast.style.background = 'rgba(0, 122, 255, 0.1)';
                }
                
                toast.style.display = 'block';
                
                // Auto-hide
                setTimeout(() => {
                    toast.style.display = 'none';
                }, 3000);
            }
        };

        // Global helper functions
        function showToast(message) {
            Guardian.showToast(message);
        }

        function saveConfig() {
            Guardian.saveConfig();
        }

        function closeConfig() {
            Guardian.closeConfig();
        }

        function testAlert() {
            Guardian.testAlert();
        }

        function testTwilioConnection() {
            Guardian.testTwilioConnection();
        }

        function showLogs() {
            Guardian.showLogs();
        }

        function closeLogs() {
            Guardian.closeLogs();
        }

        function clearLogs() {
            Guardian.clearLogs();
        }

        function openSatelliteScan() {
            Guardian.openSatelliteScan();
        }

        function closeSatelliteScan() {
            Guardian.closeSatelliteScan();
        }

        function openRoutePlan() {
            Guardian.openRoutePlan();
        }

        function closeRoutePlan() {
            Guardian.closeRoutePlan();
        }

        function startScan() {
            Guardian.startScan();
        }

        function saveCurrentRoute() {
            Guardian.saveCurrentRoute();
        }

        function saveRouteSettings() {
            Guardian.saveRouteSettings();
        }

        function switchTab(tabId) {
            Guardian.switchTab(tabId);
        }

        // Initialize application
        document.addEventListener('DOMContentLoaded', () => {
            Guardian.init();
        });

        // Handle beforeunload
        window.addEventListener('beforeunload', (e) => {
            if (Guardian.state.sosCountdown) {
                e.preventDefault();
                e.returnValue = 'Emergency alert is being sent. Are you sure you want to leave?';
            }
        });

        // Prevent context menu
        document.addEventListener('contextmenu', (e) => {
            e.preventDefault();
        });
    </script>
</body>
</html>
