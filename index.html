<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    
    <title>SecureOS-Pro</title>
    
    <!-- Mapbox for Satellite & Street View -->
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.css' rel='stylesheet' />
    <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.0/mapbox-gl-directions.js'></script>
    <link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.0/mapbox-gl-directions.css' />
    
    <!-- Street View Simulation -->
    <script src='https://unpkg.com/three@0.126.0/build/three.min.js'></script>
    <script src='https://unpkg.com/three@0.126.0/examples/js/loaders/GLTFLoader.js'></script>
    
    <link rel="manifest" href="manifest.webmanifest">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root {
            --stealth-bg: #000000;
            --stealth-text: #00FF00;
            --stealth-accent: #008751;
            --stealth-alert: #FF3B30;
            --stealth-gray: #333333;
            --stealth-satellite: #1a5fb4;
            --stealth-route: #FF6B35;
            --stealth-street: #8B4513;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: var(--stealth-bg);
            color: var(--stealth-text);
            position: fixed;
            user-select: none;
        }

        #app {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        /* === STEALTH LOADING === */
        .stealth-loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--stealth-bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .stealth-spinner {
            width: 60px;
            height: 60px;
            border: 3px solid var(--stealth-gray);
            border-top-color: var(--stealth-text);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* === PHONE INTERFACE === */
        .phone-interface {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a1a, #0a0a0a);
            display: flex;
            flex-direction: column;
            padding: 20px;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            color: #CCC;
            font-size: 14px;
            border-bottom: 1px solid var(--stealth-gray);
            margin-bottom: 30px;
        }

        .app-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            padding: 20px;
        }

        .app-icon {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .app-icon:hover {
            background: rgba(255,255,255,0.15);
            transform: scale(1.05);
        }

        .app-icon i { 
            font-size: 28px; 
            margin-bottom: 10px; 
            color: #CCC; 
        }
        
        .app-name { 
            font-size: 12px; 
            color: #AAA; 
        }

        /* === HIDDEN SOS TRIGGERS === */
        .volume-trigger {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: rgba(0,0,0,0.8);
            border: 2px solid var(--stealth-text);
            border-radius: 50%;
            width: 70px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            cursor: pointer;
            z-index: 1000;
            animation: pulse 2s infinite;
            transition: all 0.3s;
        }

        .volume-trigger:hover {
            background: rgba(255,59,48,0.3);
            border-color: var(--stealth-alert);
            transform: scale(1.1);
        }

        /* Hidden corner triggers */
        .corner-trigger {
            position: fixed;
            width: 60px;
            height: 60px;
            z-index: 999;
            opacity: 0.3;
        }

        .top-left-trigger { top: 0; left: 0; }
        .top-right-trigger { top: 0; right: 0; }
        .bottom-left-trigger { bottom: 0; left: 0; }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* === CONFIG PANEL === */
        .hidden-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.98);
            z-index: 3000;
            display: none;
            overflow-y: auto;
            padding: 20px;
            color: var(--stealth-text);
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--stealth-gray);
        }

        .panel-content {
            max-width: 500px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #CCC;
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            background: #222;
            border: 1px solid var(--stealth-gray);
            border-radius: 8px;
            color: white;
            font-size: 16px;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--stealth-text);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            margin: 15px 0;
        }

        .checkbox-input {
            margin-right: 10px;
            width: 18px;
            height: 18px;
        }

        /* === SUBSCRIPTION STATUS === */
        .subscription-status {
            background: rgba(0, 135, 81, 0.1);
            border: 1px solid var(--stealth-accent);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        /* === EMERGENCY MODAL === */
        .emergency-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 4000;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-content {
            background: var(--stealth-bg);
            border: 3px solid var(--stealth-alert);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .countdown {
            font-size: 48px;
            font-weight: bold;
            color: var(--stealth-alert);
            margin: 20px 0;
            text-shadow: 0 0 10px rgba(255,59,48,0.5);
        }

        /* === SATELLITE SCAN MODAL === */
        .satellite-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 5000;
            display: none;
            flex-direction: column;
            padding: 20px;
        }

        .satellite-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            color: white;
            padding: 15px;
            background: rgba(26, 95, 180, 0.2);
            border-radius: 10px;
            border: 1px solid var(--stealth-satellite);
        }

        #satelliteMap {
            flex: 1;
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid var(--stealth-satellite);
            background: #000;
            position: relative;
        }

        /* === ADVANCED ROUTE SCANNER === */
        .route-scanner {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 6000;
            display: none;
            flex-direction: column;
            padding: 20px;
        }

        .scanner-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            color: white;
            padding: 15px;
            background: rgba(255, 107, 53, 0.2);
            border-radius: 10px;
            border: 1px solid var(--stealth-route);
        }

        .scanner-container {
            flex: 1;
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        #routeMap {
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid var(--stealth-route);
            background: #000;
            position: relative;
        }

        .scan-sidebar {
            background: rgba(0,0,0,0.7);
            border-radius: 15px;
            border: 1px solid var(--stealth-gray);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .scan-view {
            flex: 1;
            background: #111;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .scan-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 107, 53, 0.1),
                transparent
            );
            animation: scanning 2s linear infinite;
            pointer-events: none;
            z-index: 2;
            display: none;
        }

        @keyframes scanning {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .scan-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .scan-cell {
            background: #222;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            font-size: 11px;
            position: relative;
            overflow: hidden;
        }

        .scan-cell.active {
            border: 2px solid var(--stealth-text);
            background: rgba(0, 255, 0, 0.1);
        }

        .scan-cell.danger {
            border: 2px solid var(--stealth-alert);
            background: rgba(255, 59, 48, 0.1);
        }

        /* === STREET VIEW SIMULATION === */
        .street-view {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: none;
        }

        #streetViewCanvas {
            width: 100%;
            height: 100%;
        }

        .street-controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 10px;
        }

        /* === SYSTEM STATUS === */
        .system-status {
            position: fixed;
            bottom: 20px;
            left: 20px;
            display: flex;
            gap: 15px;
            background: rgba(0,0,0,0.7);
            padding: 10px 15px;
            border-radius: 10px;
        }

        .status-dot { 
            width: 10px; 
            height: 10px; 
            background: #666; 
            border-radius: 50%; 
        }
        
        .status-dot.active { 
            background: var(--stealth-text); 
            box-shadow: 0 0 10px var(--stealth-text); 
            animation: glow 2s infinite;
        }
        
        .status-dot.warning { 
            background: #FFA500; 
            box-shadow: 0 0 10px #FFA500;
            animation: blink 1s infinite;
        }
        
        .status-dot.satellite { 
            background: var(--stealth-satellite); 
            box-shadow: 0 0 10px var(--stealth-satellite);
        }
        
        .status-dot.route { 
            background: var(--stealth-route); 
            box-shadow: 0 0 10px var(--stealth-route);
        }
        
        .status-dot.street { 
            background: var(--stealth-street); 
            box-shadow: 0 0 10px var(--stealth-street);
        }
        
        .status-label { 
            font-size: 12px; 
            color: #666; 
        }

        @keyframes glow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* === BUTTONS === */
        .stealth-btn {
            width: 100%;
            padding: 15px;
            margin-top: 10px;
            border-radius: 10px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-alert { 
            background: var(--stealth-alert); 
            color: white; 
        }
        
        .btn-alert:hover {
            background: #FF1A1A;
            transform: translateY(-2px);
        }
        
        .btn-stealth { 
            background: var(--stealth-gray); 
            color: var(--stealth-text); 
        }
        
        .btn-stealth:hover {
            background: #444;
            transform: translateY(-2px);
        }
        
        .btn-green { 
            background: var(--stealth-accent); 
            color: white; 
        }
        
        .btn-green:hover {
            background: #00AA66;
            transform: translateY(-2px);
        }
        
        .btn-satellite { 
            background: var(--stealth-satellite); 
            color: white; 
        }
        
        .btn-satellite:hover {
            background: #0c77e0;
            transform: translateY(-2px);
        }
        
        .btn-route { 
            background: var(--stealth-route); 
            color: white; 
        }
        
        .btn-route:hover {
            background: #FF8535;
            transform: translateY(-2px);
        }
        
        .btn-street { 
            background: var(--stealth-street); 
            color: white; 
        }
        
        .btn-street:hover {
            background: #A0522D;
            transform: translateY(-2px);
        }

        /* === TOAST === */
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            border: 1px solid var(--stealth-accent);
            z-index: 7000;
            display: none;
            max-width: 90%;
            text-align: center;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                transform: translateX(-50%) translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }

        /* === COORDINATES === */
        .coordinates-display {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: var(--stealth-text);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 12px;
            font-family: 'Courier New', monospace;
            z-index: 10;
            border: 1px solid var(--stealth-satellite);
        }

        /* === LOADING OVERLAY === */
        .map-loading {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            color: var(--stealth-text);
        }

        /* === APP HIDER === */
        .app-hider {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1002;
        }

        .hide-app-btn {
            background: rgba(0,0,0,0.7);
            color: #666;
            border: 1px solid #333;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .hide-app-btn:hover {
            color: var(--stealth-alert);
            border-color: var(--stealth-alert);
        }

        /* === RESPONSIVE === */
        @media (max-width: 768px) {
            .scanner-container {
                grid-template-columns: 1fr;
            }
            
            .scan-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .app-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 15px;
                padding: 15px;
            }
            
            .volume-trigger {
                width: 60px;
                height: 60px;
                bottom: 20px;
                right: 20px;
                font-size: 24px;
            }
            
            .modal-content {
                padding: 25px;
            }
            
            .scan-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="stealth-loading" id="loadingScreen">
        <div class="stealth-spinner"></div>
        <div>SecureOS-Pro</div>
        <div style="font-size: 12px; color: #666;">Initializing Advanced Security Systems...</div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- Hidden SOS Triggers -->
    <div class="volume-trigger" id="sosTrigger">
        <i class="fas fa-shield-alt"></i>
    </div>
    
    <!-- Hidden Corner Triggers (Volume Button Simulation) -->
    <div class="corner-trigger top-left-trigger" id="volumeUpTrigger"></div>
    <div class="corner-trigger top-right-trigger" id="volumeDownTrigger"></div>
    <div class="corner-trigger bottom-left-trigger" id="powerButtonTrigger"></div>

    <!-- App Hider Button -->
    <div class="app-hider" id="appHider">
        <div class="hide-app-btn" title="Hide App Interface">
            <i class="fas fa-eye-slash"></i>
        </div>
    </div>

    <!-- Main Phone Interface -->
    <div id="phoneInterface" style="display: none;">
        <div class="phone-interface">
            <div class="status-bar">
                <div id="currentTime">09:41</div>
                <div><i class="fas fa-signal" id="signalIcon"></i> <span id="networkStatus">4G</span></div>
            </div>

            <div class="app-grid">
                <div class="app-icon" onclick="showToast('Phone app would open')">
                    <i class="fas fa-phone"></i>
                    <div class="app-name">Phone</div>
                </div>
                <div class="app-icon" id="settingsApp">
                    <i class="fas fa-gear"></i>
                    <div class="app-name">Settings</div>
                </div>
                <div class="app-icon" id="satelliteApp">
                    <i class="fas fa-satellite"></i>
                    <div class="app-name">Sat View</div>
                </div>
                <div class="app-icon" id="routeScannerApp">
                    <i class="fas fa-road"></i>
                    <div class="app-name">Route Scan</div>
                </div>
            </div>
        </div>

        <!-- System Status -->
        <div class="system-status">
            <div class="status-dot" id="gpsStatus"></div>
            <span class="status-label">GPS</span>
            <div class="status-dot" id="netStatus"></div>
            <span class="status-label">NET</span>
            <div class="status-dot" id="batteryStatus"></div>
            <span class="status-label">BAT</span>
            <div class="status-dot" id="satelliteStatus"></div>
            <span class="status-label">SAT</span>
            <div class="status-dot" id="routeStatus"></div>
            <span class="status-label">ROUTE</span>
        </div>
    </div>

    <!-- Configuration Panel -->
    <div class="hidden-panel" id="configPanel">
        <div class="panel-content">
            <div class="panel-header">
                <h2><i class="fas fa-user-secret"></i> SecureOS Configuration</h2>
                <button class="stealth-btn btn-stealth" onclick="closeConfig()" style="width: auto; padding: 10px 20px;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- Subscription Status -->
            <div class="subscription-status">
                <div class="status-indicator">
                    <div class="status-dot active" id="subscriptionDot"></div>
                    <span id="subscriptionText" style="color: var(--stealth-accent);">
                        Advanced Scanning: Active
                    </span>
                </div>
                <p style="color: #666; font-size: 12px; margin: 0;">
                    <i class="fas fa-info-circle"></i> 
                    Route scanning with 100m front, 50m left/right coverage
                </p>
            </div>
            
            <!-- Emergency Contacts -->
            <div class="form-group">
                <label class="form-label">Emergency Contact 1</label>
                <input type="text" class="form-input" id="contact1" placeholder="+2348103365359">
            </div>
            
            <div class="form-group">
                <label class="form-label">Emergency Contact 2</label>
                <input type="text" class="form-input" id="contact2" placeholder="+2349088757570">
            </div>
            
            <div class="form-group">
                <label class="form-label">Emergency Message</label>
                <textarea class="form-input" id="emergencyMessage" rows="4">üö® SECUREOS-PRO ALERT! 

EMERGENCY ASSISTANCE REQUIRED!

üìç Current Location: {{LOCATION}}
üõ∞Ô∏è Satellite View: {{SATELLITE_LINK}}
üõ£Ô∏è Route Scan: {{ROUTE_SCAN}}
üëÅÔ∏è Roadside View: {{STREET_VIEW}}
üïê Time: {{TIME}}
üîã Battery: {{BATTERY}}%
üì∂ Network: {{NETWORK}}

Immediate response needed!</textarea>
            </div>
            
            <!-- Route Planning -->
            <div class="form-group">
                <label class="form-label">Frequent Route 1 (Start ‚Üí End)</label>
                <input type="text" class="form-input" id="route1" placeholder="Home ‚Üí Work">
            </div>
            
            <div class="form-group">
                <label class="form-label">Frequent Route 2 (Start ‚Üí End)</label>
                <input type="text" class="form-input" id="route2" placeholder="Work ‚Üí Gym">
            </div>
            
            <!-- Advanced Settings -->
            <div class="checkbox-group">
                <input type="checkbox" class="checkbox-input" id="testMode" checked>
                <label class="form-label" style="margin: 0;">Test Mode (No real alerts)</label>
            </div>
            
            <div class="checkbox-group">
                <input type="checkbox" class="checkbox-input" id="silentMode">
                <label class="form-label" style="margin: 0;">Silent SOS (No countdown)</label>
            </div>
            
            <div class="checkbox-group">
                <input type="checkbox" class="checkbox-input" id="enableGPS" checked>
                <label class="form-label" style="margin: 0;">Enable GPS Tracking</label>
            </div>
            
            <div class="checkbox-group">
                <input type="checkbox" class="checkbox-input" id="enableSatellite" checked>
                <label class="form-label" style="margin: 0;">Enable Satellite View</label>
            </div>
            
            <div class="checkbox-group">
                <input type="checkbox" class="checkbox-input" id="enableRouteScan" checked>
                <label class="form-label" style="margin: 0;">Enable Route Scanning</label>
            </div>
            
            <div class="checkbox-group">
                <input type="checkbox" class="checkbox-input" id="enableStreetView">
                <label class="form-label" style="margin: 0;">Enable Street View Simulation</label>
            </div>
            
            <div class="checkbox-group">
                <input type="checkbox" class="checkbox-input" id="volumeButtonTrigger" checked>
                <label class="form-label" style="margin: 0;">Volume Button SOS Trigger</label>
            </div>
            
            <div class="checkbox-group">
                <input type="checkbox" class="checkbox-input" id="hideAfterRoute">
                <label class="form-label" style="margin: 0;">Hide App After Route Setup</label>
            </div>
            
            <!-- Action Buttons -->
            <button class="stealth-btn btn-green" onclick="saveConfig()">
                <i class="fas fa-save"></i> Save Configuration
            </button>
            
            <button class="stealth-btn btn-route" onclick="testAlert()">
                <i class="fas fa-bell"></i> Test Alert System
            </button>
            
            <button class="stealth-btn btn-stealth" onclick="showLogs()">
                <i class="fas fa-history"></i> View Alert Logs
            </button>
            
            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--stealth-gray);">
                <p style="color: #666; font-size: 12px; text-align: center;">
                    <i class="fas fa-shield-alt"></i> SecureOS-Pro v2.0<br>
                    Advanced Route Scanning & Satellite Intelligence
                </p>
            </div>
        </div>
    </div>

    <!-- Emergency Modal -->
    <div class="emergency-modal" id="emergencyModal">
        <div class="modal-content">
            <h2 style="color: white; margin-bottom: 20px;">
                <i class="fas fa-exclamation-triangle"></i> SOS ACTIVATED
            </h2>
            <div class="countdown" id="countdownDisplay">3</div>
            <p id="modalMsg" style="color: #CCC; margin-bottom: 20px;">
                Sending satellite scan + route analysis...
            </p>
            <button class="stealth-btn btn-alert" id="confirmSOS">
                CONFIRM EMERGENCY
            </button>
            <button class="stealth-btn btn-stealth" id="cancelSOS">
                CANCEL
            </button>
        </div>
    </div>

    <!-- Satellite Scan Modal -->
    <div class="satellite-modal" id="satelliteModal">
        <div class="satellite-header">
            <div>
                <h2 style="color: white;">
                    <i class="fas fa-satellite"></i> LIVE SATELLITE INTEL
                </h2>
                <p style="color: #CCC; font-size: 12px;">
                    <i class="fas fa-map-marker-alt"></i> 
                    <span id="satelliteLocation">Acquiring position...</span>
                </p>
            </div>
            <div>
                <button class="stealth-btn btn-satellite" onclick="scanArea()" style="width: auto; padding: 10px 15px; margin-right: 10px;">
                    <i class="fas fa-crosshairs"></i> Scan
                </button>
                <button class="stealth-btn btn-stealth" onclick="closeSatellite()" style="width: auto; padding: 10px 15px;">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
        </div>
        
        <div id="satelliteMap">
            <div class="map-loading" id="satelliteLoading">
                <div class="stealth-spinner" style="width: 40px; height: 40px;"></div>
                <div style="margin-top: 15px;">Loading satellite intelligence...</div>
            </div>
            <div class="coordinates-display" id="satelliteCoords">
                Lat: 0.000000 | Lng: 0.000000
            </div>
        </div>
    </div>

    <!-- Advanced Route Scanner -->
    <div class="route-scanner" id="routeScanner">
        <div class="scanner-header">
            <div>
                <h2 style="color: white;">
                    <i class="fas fa-road"></i> ADVANCED ROUTE SCANNER
                </h2>
                <p style="color: #CCC; font-size: 12px;">
                    <i class="fas fa-expand-arrows-alt"></i> 
                    <span id="scanAreaText">100m front, 50m left/right coverage</span>
                </p>
            </div>
            <div>
                <button class="stealth-btn btn-route" onclick="startRouteScan()" style="width: auto; padding: 10px 15px; margin-right: 10px;">
                    <i class="fas fa-play"></i> Scan Route
                </button>
                <button class="stealth-btn btn-street" onclick="toggleStreetView()" style="width: auto; padding: 10px 15px; margin-right: 10px;">
                    <i class="fas fa-street-view"></i> Street
                </button>
                <button class="stealth-btn btn-stealth" onclick="closeRouteScanner()" style="width: auto; padding: 10px 15px;">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
        </div>
        
        <div class="scanner-container">
            <div id="routeMap">
                <div class="map-loading" id="routeLoading">
                    <div class="stealth-spinner" style="width: 40px; height: 40px;"></div>
                    <div style="margin-top: 15px;">Loading route intelligence...</div>
                </div>
                <div class="coordinates-display" id="routeCoords">
                    Planning route...
                </div>
            </div>
            
            <div class="scan-sidebar">
                <div class="scan-view" id="scanView">
                    <div class="street-view" id="streetView">
                        <canvas id="streetViewCanvas"></canvas>
                        <div class="street-controls">
                            <button class="stealth-btn btn-street" onclick="streetViewLeft()" style="width: auto; padding: 8px 12px;">
                                <i class="fas fa-arrow-left"></i>
                            </button>
                            <button class="stealth-btn btn-street" onclick="streetViewForward()" style="width: auto; padding: 8px 12px;">
                                <i class="fas fa-arrow-up"></i>
                            </button>
                            <button class="stealth-btn btn-street" onclick="streetViewRight()" style="width: auto; padding: 8px 12px;">
                                <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                    <div class="scan-overlay" id="scanOverlay"></div>
                </div>
                
                <div class="scan-grid" id="scanGrid">
                    <!-- Scan cells will be generated here -->
                </div>
                
                <div style="color: #CCC; font-size: 12px;">
                    <div><i class="fas fa-square" style="color: #00FF00;"></i> Safe Zone</div>
                    <div><i class="fas fa-square" style="color: #FFA500;"></i> Caution Zone</div>
                    <div><i class="fas fa-square" style="color: #FF3B30;"></i> Danger Zone</div>
                </div>
            </div>
        </div>
        
        <div style="padding: 15px; background: rgba(0,0,0,0.7); border-radius: 10px; margin-top: 10px;">
            <div style="color: #CCC; font-size: 12px;">
                <strong><i class="fas fa-info-circle"></i> Route Intelligence:</strong>
                <div id="routeIntel">Scanning 100m ahead with 50m left/right coverage...</div>
            </div>
        </div>
    </div>

    <!-- Logs Modal -->
    <div class="hidden-panel" id="logsPanel" style="display: none;">
        <div class="panel-content">
            <div class="panel-header">
                <h2><i class="fas fa-history"></i> Security Logs</h2>
                <button class="stealth-btn btn-stealth" onclick="closeLogs()" style="width: auto; padding: 10px 20px;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="logsContent" style="color: #CCC; font-size: 14px;">
                Loading security logs...
            </div>
            
            <button class="stealth-btn btn-stealth" onclick="clearLogs()" style="margin-top: 20px;">
                <i class="fas fa-trash"></i> Clear Logs
            </button>
        </div>
    </div>

    <script>
        // Mapbox Access Token
        mapboxgl.accessToken = 'pk.eyJ1IjoiZWtlaWRpbWF1Y2h1a3d1IiwiYSI6ImNtbDYxZ3NvazA2cDYza3NjOXlwNmx0aXcifQ.agDhj-euUG6sEyMTiDsQAA';

        // Global Application
        const SecureOS = {
            // Configuration
            config: {
                contacts: ["+2348103365359", "+2349088757570"],
                routes: ["Home ‚Üí Work", "Work ‚Üí Gym"],
                testMode: true,
                silentMode: false,
                enableGPS: true,
                enableSatellite: true,
                enableRouteScan: true,
                enableStreetView: false,
                volumeButtonTrigger: true,
                hideAfterRoute: true,
                emergencyMessage: `üö® SECUREOS-PRO ALERT! 

EMERGENCY ASSISTANCE REQUIRED!

üìç Current Location: {{LOCATION}}
üõ∞Ô∏è Satellite View: {{SATELLITE_LINK}}
üõ£Ô∏è Route Scan: {{ROUTE_SCAN}}
üëÅÔ∏è Roadside View: {{STREET_VIEW}}
üïê Time: {{TIME}}
üîã Battery: {{BATTERY}}%
üì∂ Network: {{NETWORK}}

Immediate response needed!`
            },
            
            // Application State
            state: {
                // Location & Sensors
                currentLocation: null,
                batteryLevel: 100,
                networkStatus: true,
                gpsStatus: false,
                satelliteStatus: false,
                routeStatus: false,
                streetViewStatus: false,
                
                // Timers & Counters
                sosCountdown: null,
                lastSOSTime: 0,
                volumePressCount: 0,
                lastVolumePress: 0,
                
                // Map Instances
                satelliteMap: null,
                routeMap: null,
                directions: null,
                streetViewScene: null,
                streetViewCamera: null,
                streetViewRenderer: null,
                
                // Scanning State
                isScanning: false,
                scanInterval: null,
                currentRoute: null,
                scanCells: [],
                
                // App State
                appHidden: false,
                streetViewActive: false
            },

            // Initialize Application
            async init() {
                console.log('üöÄ SecureOS-Pro Advanced Initializing...');
                
                // Load configuration
                this.loadConfig();
                
                // Show main interface
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                    document.getElementById('phoneInterface').style.display = 'block';
                    
                    // Initialize systems
                    this.initClock();
                    this.initNetworkMonitoring();
                    this.initBatteryMonitoring();
                    this.initGPS();
                    this.initEventListeners();
                    this.initVolumeButtonDetection();
                    this.initStatusIndicators();
                    
                    this.showToast('SecureOS Active - Advanced Scanning Ready', 'success');
                    
                }, 2000);
            },

            // Load Configuration
            loadConfig() {
                try {
                    const savedConfig = localStorage.getItem('secureos_config');
                    if (savedConfig) {
                        this.config = JSON.parse(savedConfig);
                        this.updateConfigUI();
                    }
                } catch (e) {
                    console.warn('Could not load config:', e);
                }
            },

            // Save Configuration
            saveConfig() {
                try {
                    // Get values from UI
                    this.config.contacts = [
                        document.getElementById('contact1').value.trim(),
                        document.getElementById('contact2').value.trim()
                    ];
                    
                    this.config.routes = [
                        document.getElementById('route1').value.trim(),
                        document.getElementById('route2').value.trim()
                    ];
                    
                    this.config.testMode = document.getElementById('testMode').checked;
                    this.config.silentMode = document.getElementById('silentMode').checked;
                    this.config.enableGPS = document.getElementById('enableGPS').checked;
                    this.config.enableSatellite = document.getElementById('enableSatellite').checked;
                    this.config.enableRouteScan = document.getElementById('enableRouteScan').checked;
                    this.config.enableStreetView = document.getElementById('enableStreetView').checked;
                    this.config.volumeButtonTrigger = document.getElementById('volumeButtonTrigger').checked;
                    this.config.hideAfterRoute = document.getElementById('hideAfterRoute').checked;
                    this.config.emergencyMessage = document.getElementById('emergencyMessage').value;
                    
                    // Save to localStorage
                    localStorage.setItem('secureos_config', JSON.stringify(this.config));
                    
                    this.showToast('Configuration saved', 'success');
                    console.log('‚úÖ Config saved:', this.config);
                    
                } catch (e) {
                    console.error('‚ùå Error saving config:', e);
                    this.showToast('Error saving configuration', 'error');
                }
            },

            // Update Configuration UI
            updateConfigUI() {
                document.getElementById('contact1').value = this.config.contacts[0] || '';
                document.getElementById('contact2').value = this.config.contacts[1] || '';
                document.getElementById('route1').value = this.config.routes[0] || '';
                document.getElementById('route2').value = this.config.routes[1] || '';
                document.getElementById('testMode').checked = this.config.testMode;
                document.getElementById('silentMode').checked = this.config.silentMode;
                document.getElementById('enableGPS').checked = this.config.enableGPS;
                document.getElementById('enableSatellite').checked = this.config.enableSatellite;
                document.getElementById('enableRouteScan').checked = this.config.enableRouteScan;
                document.getElementById('enableStreetView').checked = this.config.enableStreetView;
                document.getElementById('volumeButtonTrigger').checked = this.config.volumeButtonTrigger;
                document.getElementById('hideAfterRoute').checked = this.config.hideAfterRoute;
                document.getElementById('emergencyMessage').value = this.config.emergencyMessage;
            },

            // Initialize Clock
            initClock() {
                const updateClock = () => {
                    const now = new Date();
                    const timeStr = now.getHours().toString().padStart(2, '0') + ':' + 
                                   now.getMinutes().toString().padStart(2, '0');
                    document.getElementById('currentTime').textContent = timeStr;
                };
                updateClock();
                setInterval(updateClock, 1000);
            },

            // Initialize Network Monitoring
            initNetworkMonitoring() {
                const updateNetworkStatus = () => {
                    this.state.networkStatus = navigator.onLine;
                    
                    const netStatusEl = document.getElementById('netStatus');
                    const signalIcon = document.getElementById('signalIcon');
                    
                    if (this.state.networkStatus) {
                        netStatusEl.className = 'status-dot active';
                        signalIcon.className = 'fas fa-signal';
                        document.getElementById('networkStatus').textContent = 'Online';
                    } else {
                        netStatusEl.className = 'status-dot warning';
                        signalIcon.className = 'fas fa-signal-slash';
                        document.getElementById('networkStatus').textContent = 'Offline';
                    }
                };
                
                updateNetworkStatus();
                window.addEventListener('online', updateNetworkStatus);
                window.addEventListener('offline', updateNetworkStatus);
            },

            // Initialize Battery Monitoring
            initBatteryMonitoring() {
                if ('getBattery' in navigator) {
                    navigator.getBattery().then(battery => {
                        this.updateBatteryStatus(battery);
                        
                        battery.addEventListener('levelchange', () => {
                            this.updateBatteryStatus(battery);
                        });
                        
                        battery.addEventListener('chargingchange', () => {
                            this.updateBatteryStatus(battery);
                        });
                    });
                } else {
                    this.updateBatteryStatus({ level: 0.85, charging: false });
                }
            },

            // Update Battery Status
            updateBatteryStatus(battery) {
                this.state.batteryLevel = Math.round(battery.level * 100);
                const batteryEl = document.getElementById('batteryStatus');
                
                if (battery.charging) {
                    batteryEl.className = 'status-dot active';
                } else if (this.state.batteryLevel < 20) {
                    batteryEl.className = 'status-dot warning';
                } else {
                    batteryEl.className = 'status-dot active';
                }
            },

            // Initialize GPS
            initGPS() {
                if (!navigator.geolocation) {
                    console.warn('Geolocation not supported');
                    this.state.gpsStatus = false;
                    document.getElementById('gpsStatus').className = 'status-dot warning';
                    return;
                }
                
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        this.state.currentLocation = position;
                        this.state.gpsStatus = true;
                        document.getElementById('gpsStatus').className = 'status-dot active';
                        console.log('üìç GPS acquired');
                        
                        // Update status indicators
                        this.updateStatusIndicators();
                    },
                    (error) => {
                        console.warn('GPS error:', error.message);
                        this.state.gpsStatus = false;
                        document.getElementById('gpsStatus').className = 'status-dot warning';
                    }
                );
            },

            // Initialize Event Listeners
            initEventListeners() {
                // SOS Trigger Button
                document.getElementById('sosTrigger').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.triggerSOS();
                });
                
                // Settings App
                document.getElementById('settingsApp').addEventListener('click', () => {
                    this.openConfig();
                });
                
                // Satellite App
                document.getElementById('satelliteApp').addEventListener('click', () => {
                    this.openSatelliteView();
                });
                
                // Route Scanner App
                document.getElementById('routeScannerApp').addEventListener('click', () => {
                    this.openRouteScanner();
                });
                
                // Emergency Modal Buttons
                document.getElementById('confirmSOS').addEventListener('click', () => {
                    this.sendEmergencyAlert();
                });
                
                document.getElementById('cancelSOS').addEventListener('click', () => {
                    this.cancelSOS();
                });
                
                // App Hider
                document.getElementById('appHider').addEventListener('click', () => {
                    this.toggleAppVisibility();
                });
                
                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    // Volume up/down simulation
                    if (e.key === 'ArrowUp') this.simulateVolumeUp();
                    if (e.key === 'ArrowDown') this.simulateVolumeDown();
                    
                    // Power button simulation
                    if (e.key === 'p' || e.key === 'P') this.simulatePowerButton();
                    
                    // Escape to close modals
                    if (e.key === 'Escape') {
                        this.cancelSOS();
                        this.closeSatellite();
                        this.closeRouteScanner();
                        this.closeConfig();
                        this.closeLogs();
                    }
                });
            },

            // Initialize Volume Button Detection
            initVolumeButtonDetection() {
                if (!this.config.volumeButtonTrigger) return;
                
                // Touch detection for volume buttons (simulated)
                document.getElementById('volumeUpTrigger').addEventListener('click', () => {
                    this.simulateVolumeUp();
                });
                
                document.getElementById('volumeDownTrigger').addEventListener('click', () => {
                    this.simulateVolumeDown();
                });
                
                document.getElementById('powerButtonTrigger').addEventListener('click', () => {
                    this.simulatePowerButton();
                });
                
                // Volume button triple-press detection
                let pressCount = 0;
                let pressTimer;
                
                const detectTriplePress = () => {
                    const now = Date.now();
                    
                    if (now - this.state.lastVolumePress > 2000) {
                        pressCount = 0;
                    }
                    
                    pressCount++;
                    this.state.lastVolumePress = now;
                    
                    clearTimeout(pressTimer);
                    pressTimer = setTimeout(() => {
                        if (pressCount >= 3) {
                            this.triggerSOS();
                            pressCount = 0;
                        }
                    }, 1000);
                };
                
                // Listen for simulated volume presses
                window.addEventListener('volumeButtonPress', detectTriplePress);
            },

            // Simulate Volume Up
            simulateVolumeUp() {
                if (!this.config.volumeButtonTrigger) return;
                
                this.showToast('Volume Up', 'info');
                window.dispatchEvent(new Event('volumeButtonPress'));
            },

            // Simulate Volume Down
            simulateVolumeDown() {
                if (!this.config.volumeButtonTrigger) return;
                
                this.showToast('Volume Down', 'info');
                window.dispatchEvent(new Event('volumeButtonPress'));
            },

            // Simulate Power Button
            simulatePowerButton() {
                if (!this.config.volumeButtonTrigger) return;
                
                this.showToast('Power Button', 'info');
                // Triple power button for emergency
                let pressCount = 0;
                let timer;
                
                const now = Date.now();
                if (now - this.state.lastVolumePress > 2000) {
                    pressCount = 0;
                }
                
                pressCount++;
                this.state.lastVolumePress = now;
                
                clearTimeout(timer);
                timer = setTimeout(() => {
                    if (pressCount >= 3) {
                        this.triggerSOS();
                        pressCount = 0;
                    }
                }, 1000);
            },

            // Initialize Status Indicators
            initStatusIndicators() {
                // Satellite status
                const satelliteEl = document.getElementById('satelliteStatus');
                satelliteEl.className = 'status-dot satellite active';
                this.state.satelliteStatus = true;
                
                // Route status
                const routeEl = document.getElementById('routeStatus');
                routeEl.className = 'status-dot route active';
                this.state.routeStatus = true;
            },

            // Update Status Indicators
            updateStatusIndicators() {
                // Update based on current state
                if (this.state.streetViewActive) {
                    document.getElementById('routeStatus').className = 'status-dot street active';
                } else {
                    document.getElementById('routeStatus').className = 'status-dot route active';
                }
            },

            // Toggle App Visibility
            toggleAppVisibility() {
                this.state.appHidden = !this.state.appHidden;
                const appInterface = document.getElementById('phoneInterface');
                
                if (this.state.appHidden) {
                    appInterface.style.display = 'none';
                    this.showToast('App hidden - SOS still active', 'info');
                } else {
                    appInterface.style.display = 'block';
                    this.showToast('App visible', 'info');
                }
            },

            // Open Configuration
            openConfig() {
                document.getElementById('configPanel').style.display = 'block';
            },

            // Close Configuration
            closeConfig() {
                document.getElementById('configPanel').style.display = 'none';
            },

            // Open Satellite View
            openSatelliteView() {
                if (!this.config.enableSatellite) {
                    this.showToast('Satellite view is disabled', 'warning');
                    return;
                }
                
                document.getElementById('satelliteModal').style.display = 'flex';
                
                // Initialize map if not already done
                if (!this.state.satelliteMap) {
                    this.initSatelliteMap();
                }
                
                // Update location display
                this.updateSatelliteLocation();
                
                this.showToast('Satellite intelligence activated', 'success');
            },

            // Close Satellite View
            closeSatellite() {
                document.getElementById('satelliteModal').style.display = 'none';
            },

            // Open Route Scanner
            openRouteScanner() {
                if (!this.config.enableRouteScan) {
                    this.showToast('Route scanning is disabled', 'warning');
                    return;
                }
                
                document.getElementById('routeScanner').style.display = 'flex';
                
                // Initialize map if not already done
                if (!this.state.routeMap) {
                    this.initRouteMap();
                }
                
                // Initialize scan grid
                this.initScanGrid();
                
                this.showToast('Advanced route scanner activated', 'success');
                
                // Auto-hide app if configured
                if (this.config.hideAfterRoute) {
                    setTimeout(() => {
                        this.toggleAppVisibility();
                    }, 2000);
                }
            },

            // Close Route Scanner
            closeRouteScanner() {
                document.getElementById('routeScanner').style.display = 'none';
                this.stopScan();
                this.toggleStreetView(false);
            },

            // Initialize Satellite Map
            initSatelliteMap() {
                try {
                    // Default coordinates
                    const defaultCoords = { lng: 3.3792, lat: 6.5244 };
                    
                    this.state.satelliteMap = new mapboxgl.Map({
                        container: 'satelliteMap',
                        style: 'mapbox://styles/mapbox/satellite-streets-v12',
                        center: [defaultCoords.lng, defaultCoords.lat],
                        zoom: 16,
                        pitch: 60,
                        bearing: -17.6
                    });
                    
                    // Hide loading when map is loaded
                    this.state.satelliteMap.on('load', () => {
                        document.getElementById('satelliteLoading').style.display = 'none';
                        
                        // Add terrain
                        this.state.satelliteMap.addSource('mapbox-dem', {
                            'type': 'raster-dem',
                            'url': 'mapbox://mapbox.mapbox-terrain-dem-v1'
                        });
                        
                        this.state.satelliteMap.setTerrain({ 'source': 'mapbox-dem', 'exaggeration': 1.5 });
                        
                        // Add current location if available
                        if (this.state.currentLocation) {
                            this.updateSatelliteLocation();
                        }
                    });
                    
                    // Add navigation controls
                    this.state.satelliteMap.addControl(new mapboxgl.NavigationControl());
                    
                } catch (error) {
                    console.error('Error initializing satellite map:', error);
                    document.getElementById('satelliteLoading').innerHTML = `
                        <div style="text-align: center;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 40px; color: #FFA500;"></i>
                            <div style="margin-top: 15px; color: #FFA500;">Satellite map unavailable</div>
                        </div>
                    `;
                }
            },

            // Initialize Route Map
            initRouteMap() {
                try {
                    // Default coordinates
                    const defaultCoords = { lng: 3.3792, lat: 6.5244 };
                    
                    this.state.routeMap = new mapboxgl.Map({
                        container: 'routeMap',
                        style: 'mapbox://styles/mapbox/streets-v11',
                        center: [defaultCoords.lng, defaultCoords.lat],
                        zoom: 13
                    });
                    
                    // Hide loading when map is loaded
                    this.state.routeMap.on('load', () => {
                        document.getElementById('routeLoading').style.display = 'none';
                        
                        // Initialize directions
                        this.state.directions = new MapboxDirections({
                            accessToken: mapboxgl.accessToken,
                            unit: 'metric',
                            profile: 'mapbox/driving',
                            controls: {
                                instructions: true
                            }
                        });
                        
                        // Add directions to map
                        this.state.routeMap.addControl(this.state.directions, 'top-left');
                        
                        // Set current location as start if available
                        if (this.state.currentLocation) {
                            const coords = this.state.currentLocation.coords;
                            this.state.directions.setOrigin([coords.longitude, coords.latitude]);
                        }
                        
                        // Auto-set destination from saved routes
                        if (this.config.routes[0]) {
                            const destination = this.config.routes[0].split('‚Üí')[1]?.trim();
                            if (destination) {
                                this.state.directions.setDestination(destination);
                            }
                        }
                    });
                    
                } catch (error) {
                    console.error('Error initializing route map:', error);
                    document.getElementById('routeLoading').innerHTML = `
                        <div style="text-align: center;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 40px; color: #FFA500;"></i>
                            <div style="margin-top: 15px; color: #FFA500;">Route map unavailable</div>
                        </div>
                    `;
                }
            },

            // Initialize Scan Grid
            initScanGrid() {
                const scanGrid = document.getElementById('scanGrid');
                scanGrid.innerHTML = '';
                
                // Create 3x3 grid for roadside scanning
                // Center cell = road ahead (100m)
                // Side cells = left/right (50m)
                const gridLabels = [
                    'Left Rear', 'Rear', 'Right Rear',
                    'Left Side', 'Road Ahead', 'Right Side',
                    'Left Front', 'Front', 'Right Front'
                ];
                
                for (let i = 0; i < 9; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'scan-cell';
                    cell.id = `scanCell${i}`;
                    cell.innerHTML = `
                        <div style="font-size: 10px; margin-bottom: 5px;">${gridLabels[i]}</div>
                        <div style="font-size: 9px; color: #666;" id="scanStatus${i}">Ready</div>
                    `;
                    scanGrid.appendChild(cell);
                    
                    this.state.scanCells.push({
                        id: i,
                        element: cell,
                        status: 'ready',
                        distance: i === 4 ? '100m' : '50m', // Center cell = 100m, others = 50m
                        direction: gridLabels[i]
                    });
                }
            },

            // Update Satellite Location
            updateSatelliteLocation() {
                if (!this.state.satelliteMap || !this.state.currentLocation) return;
                
                const coords = this.state.currentLocation.coords;
                const lngLat = [coords.longitude, coords.latitude];
                
                // Fly to location
                this.state.satelliteMap.flyTo({
                    center: lngLat,
                    zoom: 17,
                    duration: 2000
                });
                
                // Update coordinates display
                document.getElementById('satelliteCoords').innerHTML = 
                    `Lat: ${coords.latitude.toFixed(6)} | Lng: ${coords.longitude.toFixed(6)}`;
                
                document.getElementById('satelliteLocation').textContent = 
                    `${coords.latitude.toFixed(4)}, ${coords.longitude.toFixed(4)}`;
            },

            // Scan Area (Satellite)
            scanArea() {
                if (this.state.isScanning) {
                    this.stopScan();
                    return;
                }
                
                this.state.isScanning = true;
                this.showToast('Scanning area with satellite intelligence...', 'info');
                
                // Simulate scanning
                let scanProgress = 0;
                this.state.scanInterval = setInterval(() => {
                    scanProgress += 10;
                    
                    if (scanProgress >= 100) {
                        this.stopScan();
                        this.showToast('Area scan complete - Threat assessment ready', 'success');
                    }
                }, 200);
            },

            // Stop Scan
            stopScan() {
                this.state.isScanning = false;
                if (this.state.scanInterval) {
                    clearInterval(this.state.scanInterval);
                    this.state.scanInterval = null;
                }
            },

            // Start Route Scan
            startRouteScan() {
                if (this.state.isScanning) {
                    this.stopRouteScan();
                    return;
                }
                
                this.state.isScanning = true;
                document.getElementById('scanOverlay').style.display = 'block';
                this.showToast('Scanning route: 100m front, 50m left/right', 'info');
                
                // Update scan cells with simulated data
                this.state.scanCells.forEach((cell, index) => {
                    setTimeout(() => {
                        // Simulate different statuses
                        const statuses = ['safe', 'caution', 'danger'];
                        const randomStatus = statuses[Math.floor(Math.random() * statuses.length)];
                        
                        cell.status = randomStatus;
                        cell.element.className = `scan-cell ${randomStatus}`;
                        
                        const statusText = {
                            'safe': '‚úÖ Clear',
                            'caution': '‚ö†Ô∏è Caution',
                            'danger': 'üö® Alert'
                        }[randomStatus];
                        
                        document.getElementById(`scanStatus${index}`).textContent = statusText;
                        document.getElementById(`scanStatus${index}`).style.color = 
                            randomStatus === 'safe' ? '#00FF00' : 
                            randomStatus === 'caution' ? '#FFA500' : '#FF3B30';
                        
                    }, index * 300);
                });
                
                // Update route intelligence
                document.getElementById('routeIntel').innerHTML = `
                    <div style="margin-top: 5px;">
                        <div><i class="fas fa-road"></i> <strong>Route Analysis Complete</strong></div>
                        <div style="font-size: 11px; margin-top: 5px;">
                            ‚Ä¢ 100m front: Clear<br>
                            ‚Ä¢ 50m left: Minor obstruction detected<br>
                            ‚Ä¢ 50m right: Clear<br>
                            ‚Ä¢ Road conditions: Good<br>
                            ‚Ä¢ Estimated safety: 85%
                        </div>
                    </div>
                `;
                
                // Update coordinates
                if (this.state.currentLocation) {
                    const coords = this.state.currentLocation.coords;
                    document.getElementById('routeCoords').innerHTML = 
                        `Scanning: ${coords.latitude.toFixed(6)}, ${coords.longitude.toFixed(6)}`;
                }
            },

            // Stop Route Scan
            stopRouteScan() {
                this.state.isScanning = false;
                document.getElementById('scanOverlay').style.display = 'none';
                this.showToast('Route scan stopped', 'info');
            },

            // Toggle Street View
            toggleStreetView(forceState = null) {
                const streetView = document.getElementById('streetView');
                const shouldShow = forceState !== null ? forceState : !this.state.streetViewActive;
                
                if (shouldShow && this.config.enableStreetView) {
                    streetView.style.display = 'block';
                    this.state.streetViewActive = true;
                    this.initStreetView();
                    this.showToast('Street View activated', 'info');
                } else {
                    streetView.style.display = 'none';
                    this.state.streetViewActive = false;
                    this.showToast('Street View deactivated', 'info');
                }
                
                this.updateStatusIndicators();
            },

            // Initialize Street View (Simulation)
            initStreetView() {
                try {
                    const canvas = document.getElementById('streetViewCanvas');
                    const width = canvas.parentElement.clientWidth;
                    const height = canvas.parentElement.clientHeight;
                    
                    // Set canvas size
                    canvas.width = width;
                    canvas.height = height;
                    
                    // Create Three.js scene
                    const scene = new THREE.Scene();
                    const camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);
                    const renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true });
                    
                    renderer.setSize(width, height);
                    renderer.setClearColor(0x000000, 0);
                    
                    // Add basic lighting
                    const light = new THREE.AmbientLight(0x404040);
                    scene.add(light);
                    
                    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
                    directionalLight.position.set(1, 1, 1);
                    scene.add(directionalLight);
                    
                    // Add simple road geometry (simulated)
                    const roadGeometry = new THREE.BoxGeometry(10, 0.1, 50);
                    const roadMaterial = new THREE.MeshBasicMaterial({ color: 0x333333 });
                    const road = new THREE.Mesh(roadGeometry, roadMaterial);
                    road.position.y = -1;
                    scene.add(road);
                    
                    // Add road markings
                    const lineGeometry = new THREE.BoxGeometry(0.1, 0.05, 50);
                    const lineMaterial = new THREE.MeshBasicMaterial({ color: 0xffff00 });
                    const centerLine = new THREE.Mesh(lineGeometry, lineMaterial);
                    centerLine.position.y = -0.95;
                    scene.add(centerLine);
                    
                    // Add simple buildings (simulated)
                    for (let i = 0; i < 4; i++) {
                        const buildingGeometry = new THREE.BoxGeometry(3, 5, 3);
                        const buildingMaterial = new THREE.MeshBasicMaterial({ 
                            color: i % 2 === 0 ? 0x8B4513 : 0x654321 
                        });
                        const building = new THREE.Mesh(buildingGeometry, buildingMaterial);
                        building.position.set(i % 2 === 0 ? -5 : 5, 2.5, i * 10 - 20);
                        scene.add(building);
                    }
                    
                    // Position camera
                    camera.position.z = 5;
                    camera.position.y = 1.5;
                    
                    // Store references
                    this.state.streetViewScene = scene;
                    this.state.streetViewCamera = camera;
                    this.state.streetViewRenderer = renderer;
                    
                    // Start animation
                    this.animateStreetView();
                    
                } catch (error) {
                    console.error('Error initializing street view:', error);
                    this.showToast('Street View simulation unavailable', 'warning');
                }
            },

            // Animate Street View
            animateStreetView() {
                if (!this.state.streetViewActive || !this.state.streetViewRenderer) return;
                
                requestAnimationFrame(() => this.animateStreetView());
                
                // Simple animation
                if (this.state.streetViewScene && this.state.streetViewCamera) {
                    // Rotate buildings slightly for realism
                    this.state.streetViewScene.children.forEach((child, index) => {
                        if (index > 2) { // Skip road and lines
                            child.rotation.y += 0.001;
                        }
                    });
                    
                    this.state.streetViewRenderer.render(this.state.streetViewScene, this.state.streetViewCamera);
                }
            },

            // Street View Controls
            streetViewLeft() {
                if (this.state.streetViewCamera) {
                    this.state.streetViewCamera.rotation.y += 0.1;
                }
            },

            streetViewForward() {
                if (this.state.streetViewCamera) {
                    this.state.streetViewCamera.position.z -= 0.5;
                }
            },

            streetViewRight() {
                if (this.state.streetViewCamera) {
                    this.state.streetViewCamera.rotation.y -= 0.1;
                }
            },

            // Trigger SOS
            triggerSOS() {
                // Prevent rapid triggering
                const now = Date.now();
                if (now - this.state.lastSOSTime < 10000 && !this.config.testMode) {
                    this.showToast('Please wait before sending another alert', 'warning');
                    return;
                }
                
                this.state.lastSOSTime = now;
                
                if (this.config.silentMode) {
                    this.sendEmergencyAlert();
                } else {
                    this.showCountdownModal();
                }
            },

            // Show Countdown Modal
            showCountdownModal() {
                const modal = document.getElementById('emergencyModal');
                const countdownEl = document.getElementById('countdownDisplay');
                const msgEl = document.getElementById('modalMsg');
                
                modal.style.display = 'flex';
                let countdown = 3;
                
                countdownEl.textContent = countdown;
                msgEl.textContent = `Sending satellite scan + route analysis...`;
                
                // Clear existing countdown
                if (this.state.sosCountdown) {
                    clearInterval(this.state.sosCountdown);
                }
                
                // Start countdown
                this.state.sosCountdown = setInterval(() => {
                    countdown--;
                    countdownEl.textContent = countdown;
                    
                    if (countdown > 0) {
                        msgEl.textContent = `Sending in ${countdown} second${countdown !== 1 ? 's' : ''}...`;
                    } else {
                        clearInterval(this.state.sosCountdown);
                        this.sendEmergencyAlert();
                    }
                }, 1000);
            },

            // Cancel SOS
            cancelSOS() {
                if (this.state.sosCountdown) {
                    clearInterval(this.state.sosCountdown);
                    this.state.sosCountdown = null;
                }
                
                document.getElementById('emergencyModal').style.display = 'none';
                this.showToast('SOS cancelled', 'info');
            },

            // Send Emergency Alert
            async sendEmergencyAlert() {
                document.getElementById('emergencyModal').style.display = 'none';
                
                // Collect emergency data
                const emergencyData = await this.collectEmergencyData();
                
                // Create message with all intelligence
                let message = this.config.emergencyMessage
                    .replace('{{LOCATION}}', emergencyData.location)
                    .replace('{{SATELLITE_LINK}}', emergencyData.satelliteLink)
                    .replace('{{ROUTE_SCAN}}', emergencyData.routeScan)
                    .replace('{{STREET_VIEW}}', emergencyData.streetView)
                    .replace('{{TIME}}', emergencyData.time)
                    .replace('{{BATTERY}}', emergencyData.battery)
                    .replace('{{NETWORK}}', emergencyData.network);
                
                if (this.config.testMode) {
                    // Test mode
                    this.showToast(
                        `TEST: Advanced scan complete. Would send to ${this.config.contacts.length} contact(s)`,
                        'success'
                    );
                    this.logAlert('TEST', message, this.config.contacts);
                    return;
                }
                
                // Show sending status
                this.showToast('Sending advanced intelligence report...', 'info');
                
                // Simulate sending
                setTimeout(() => {
                    this.showToast('‚úÖ Advanced alert sent with route intelligence', 'success');
                    this.logAlert('EMERGENCY', message, this.config.contacts);
                }, 2000);
            },

            // Collect Emergency Data
            async collectEmergencyData() {
                const now = new Date();
                let location = "Location unavailable";
                let satelliteLink = "Satellite scan: Not available";
                let routeScan = "Route scan: Not available";
                let streetView = "Street view: Not available";
                
                if (this.config.enableGPS && this.state.currentLocation) {
                    const coords = this.state.currentLocation.coords;
                    location = `https://maps.google.com/?q=${coords.latitude},${coords.longitude}`;
                    
                    // Satellite link
                    if (this.config.enableSatellite) {
                        satelliteLink = `https://www.google.com/maps/@${coords.latitude},${coords.longitude},17z/data=!3m1!1e3`;
                    }
                    
                    // Route scan info
                    if (this.config.enableRouteScan) {
                        routeScan = `Route scan complete: 100m front, 50m left/right coverage\nSafety assessment: 85% clear`;
                    }
                    
                    // Street view info
                    if (this.config.enableStreetView && this.state.streetViewActive) {
                        streetView = `Street view active: Roadside monitoring enabled`;
                    }
                    
                    // Get approximate address
                    try {
                        const response = await fetch(
                            `https://nominatim.openstreetmap.org/reverse?format=json&lat=${coords.latitude}&lon=${coords.longitude}&zoom=18&addressdetails=1`
                        );
                        if (response.ok) {
                            const data = await response.json();
                            if (data.display_name) {
                                const address = data.display_name.split(',').slice(0, 3).join(',');
                                location += `\nüìç ${address}`;
                            }
                        }
                    } catch (e) {
                        // Ignore reverse geocoding errors
                    }
                }
                
                return {
                    time: now.toLocaleString(),
                    location: location,
                    satelliteLink: satelliteLink,
                    routeScan: routeScan,
                    streetView: streetView,
                    battery: this.state.batteryLevel,
                    network: this.state.networkStatus ? 'Online' : 'Offline',
                    timestamp: now.toISOString()
                };
            },

            // Log Alert
            logAlert(type, message, contacts) {
                try {
                    const logs = JSON.parse(localStorage.getItem('secureos_logs') || '[]');
                    
                    logs.unshift({
                        id: Date.now(),
                        type: type,
                        timestamp: new Date().toISOString(),
                        contacts: contacts.length,
                        message: message.substring(0, 100) + '...',
                        testMode: this.config.testMode
                    });
                    
                    // Keep last 50 logs
                    if (logs.length > 50) {
                        logs.pop();
                    }
                    
                    localStorage.setItem('secureos_logs', JSON.stringify(logs));
                    
                } catch (e) {
                    console.error('Error logging alert:', e);
                }
            },

            // Show Logs
            showLogs() {
                document.getElementById('configPanel').style.display = 'none';
                document.getElementById('logsPanel').style.display = 'block';
                
                try {
                    const logs = JSON.parse(localStorage.getItem('secureos_logs') || '[]');
                    const logsContent = document.getElementById('logsContent');
                    
                    if (logs.length === 0) {
                        logsContent.innerHTML = '<p style="color: #666; text-align: center;">No security logs found.</p>';
                        return;
                    }
                    
                    let html = '<div style="display: flex; flex-direction: column; gap: 10px;">';
                    
                    logs.forEach(log => {
                        const date = new Date(log.timestamp);
                        const timeStr = date.toLocaleString();
                        
                        html += `
                            <div style="background: #222; padding: 15px; border-radius: 8px; border-left: 4px solid ${log.type === 'EMERGENCY' ? '#FF3B30' : '#FFA500'}">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <strong style="color: ${log.type === 'EMERGENCY' ? '#FF3B30' : '#FFA500'}">
                                        ${log.type}
                                    </strong>
                                    <small style="color: #666;">${timeStr}</small>
                                </div>
                                <div style="color: #AAA; font-size: 12px; margin-bottom: 5px;">
                                    Contacts: ${log.contacts} | 
                                    ${log.testMode ? 'TEST MODE' : 'REAL ALERT'}
                                </div>
                                <div style="color: #CCC; font-size: 13px;">
                                    ${log.message}
                                </div>
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                    logsContent.innerHTML = html;
                    
                } catch (e) {
                    document.getElementById('logsContent').innerHTML = 
                        '<p style="color: #FF3B30;">Error loading logs.</p>';
                }
            },

            // Close Logs
            closeLogs() {
                document.getElementById('logsPanel').style.display = 'none';
            },

            // Clear Logs
            clearLogs() {
                if (confirm('Are you sure you want to clear all security logs?')) {
                    localStorage.removeItem('secureos_logs');
                    document.getElementById('logsContent').innerHTML = 
                        '<p style="color: #666; text-align: center;">No security logs found.</p>';
                    this.showToast('Security logs cleared', 'info');
                }
            },

            // Test Alert System
            testAlert() {
                const oldTestMode = this.config.testMode;
                this.config.testMode = true;
                
                this.showToast('Testing advanced alert system...', 'info');
                setTimeout(() => {
                    this.triggerSOS();
                    this.config.testMode = oldTestMode;
                }, 1000);
            },

            // Show Toast Notification
            showToast(message, type = 'info') {
                const toast = document.getElementById('toast');
                toast.textContent = message;
                
                switch (type) {
                    case 'error':
                        toast.style.borderColor = '#FF3B30';
                        toast.style.background = 'rgba(255, 59, 48, 0.1)';
                        break;
                    case 'success':
                        toast.style.borderColor = '#4CD964';
                        toast.style.background = 'rgba(76, 217, 100, 0.1)';
                        break;
                    case 'warning':
                        toast.style.borderColor = '#FF9500';
                        toast.style.background = 'rgba(255, 149, 0, 0.1)';
                        break;
                    default:
                        toast.style.borderColor = '#007AFF';
                        toast.style.background = 'rgba(0, 122, 255, 0.1)';
                }
                
                toast.style.display = 'block';
                
                setTimeout(() => {
                    toast.style.display = 'none';
                }, 3000);
            }
        };

        // Global Helper Functions
        function showToast(message) {
            SecureOS.showToast(message);
        }

        function saveConfig() {
            SecureOS.saveConfig();
        }

        function closeConfig() {
            SecureOS.closeConfig();
        }

        function testAlert() {
            SecureOS.testAlert();
        }

        function showLogs() {
            SecureOS.showLogs();
        }

        function closeLogs() {
            SecureOS.closeLogs();
        }

        function clearLogs() {
            SecureOS.clearLogs();
        }

        function openSatelliteView() {
            SecureOS.openSatelliteView();
        }

        function closeSatellite() {
            SecureOS.closeSatellite();
        }

        function openRouteScanner() {
            SecureOS.openRouteScanner();
        }

        function closeRouteScanner() {
            SecureOS.closeRouteScanner();
        }

        function scanArea() {
            SecureOS.scanArea();
        }

        function startRouteScan() {
            SecureOS.startRouteScan();
        }

        function toggleStreetView() {
            SecureOS.toggleStreetView();
        }

        function streetViewLeft() {
            SecureOS.streetViewLeft();
        }

        function streetViewForward() {
            SecureOS.streetViewForward();
        }

        function streetViewRight() {
            SecureOS.streetViewRight();
        }

        // Initialize Application
        document.addEventListener('DOMContentLoaded', () => {
            SecureOS.init();
        });

        // Handle Beforeunload
        window.addEventListener('beforeunload', (e) => {
            if (SecureOS.state.sosCountdown) {
                e.preventDefault();
                e.returnValue = 'Emergency alert is being sent. Are you sure you want to leave?';
            }
        });

        // Prevent Context Menu
        document.addEventListener('contextmenu', (e) => {
            e.preventDefault();
        });

        // Prevent Text Selection
        document.addEventListener('selectstart', (e) => {
            e.preventDefault();
        });
    </script>
</body>
</html>

