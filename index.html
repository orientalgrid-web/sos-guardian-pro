<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculator</title>
    <!-- Mapbox GL JS -->
    <script src='https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.css' rel='stylesheet' />
    <!-- Mapbox Directions -->
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.1/mapbox-gl-directions.js"></script>
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.1/mapbox-gl-directions.css" type="text/css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ========== CALCULATOR DISGUISE ========== */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .calculator {
            background: #2c3e50;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 400px;
            overflow: hidden;
        }
        
        .calculator-display {
            background: #1a252f;
            color: white;
            padding: 30px 20px;
            text-align: right;
            font-size: 2.5em;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .calculator-display .result {
            font-size: 2em;
            font-weight: 300;
        }
        
        .calculator-display .equation {
            font-size: 0.8em;
            opacity: 0.7;
            margin-bottom: 5px;
        }
        
        .calculator-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1px;
            background: #34495e;
        }
        
        .calculator-btn {
            background: #2c3e50;
            border: none;
            color: white;
            font-size: 1.2em;
            padding: 25px 0;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .calculator-btn:hover {
            background: #1a252f;
        }
        
        .calculator-btn:active {
            background: #16a085;
        }
        
        .calculator-btn.operator {
            background: #3498db;
        }
        
        .calculator-btn.operator:hover {
            background: #2980b9;
        }
        
        .calculator-btn.equals {
            background: #e74c3c;
            grid-column: span 2;
        }
        
        .calculator-btn.equals:hover {
            background: #c0392b;
        }
        
        .calculator-btn.clear {
            background: #e67e22;
        }
        
        .calculator-btn.clear:hover {
            background: #d35400;
        }
        
        /* ========== SOS INTERFACE (Hidden) ========== */
        .sos-interface {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0c0e2a;
            z-index: 1000;
            overflow-y: auto;
            color: white;
        }
        
        .sos-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .sos-header {
            background: linear-gradient(90deg, #008751 0%, #00A859 100%);
            padding: 25px 30px;
            border-radius: 20px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 15px 35px rgba(0, 135, 81, 0.3);
        }
        
        .emergency-section {
            text-align: center;
            margin: 30px 0;
            padding: 30px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 25px;
        }
        
        .emergency-btn {
            background: linear-gradient(45deg, #ff3b30, #ff2d55);
            color: white;
            border: none;
            width: 250px;
            height: 250px;
            border-radius: 50%;
            margin: 0 auto 20px;
            cursor: pointer;
            font-size: 24px;
            font-weight: bold;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 20px 40px rgba(255, 59, 48, 0.4);
            animation: heartbeat 2s infinite;
        }
        
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* ========== SATELLITE SURVEILLANCE SECTION ========== */
        .surveillance-section {
            background: rgba(0, 135, 81, 0.1);
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            border: 2px solid #008751;
        }
        
        .surveillance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .surveillance-card {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(0, 255, 136, 0.2);
            text-align: center;
        }
        
        .surveillance-icon {
            width: 60px;
            height: 60px;
            background: rgba(0, 255, 136, 0.2);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 24px;
            color: #00ff88;
        }
        
        /* ========== MAPBOX SATELLITE MAP ========== */
        .map-container {
            height: 500px;
            border-radius: 20px;
            overflow: hidden;
            margin: 30px 0;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
            position: relative;
        }
        
        #map {
            width: 100%;
            height: 100%;
            border-radius: 20px;
        }
        
        .map-overlay {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 15px;
            z-index: 1;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .satellite-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
        }
        
        .satellite-btn {
            background: #008751;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 140px;
        }
        
        .satellite-btn:hover {
            background: #00A859;
        }
        
        .satellite-btn.view {
            background: #3498db;
        }
        
        .satellite-btn.view:hover {
            background: #2980b9;
        }
        
        .satellite-btn.zoom {
            background: #9b59b6;
        }
        
        .satellite-btn.zoom:hover {
            background: #8e44ad;
        }
        
        .satellite-btn.sos {
            background: #ff3b30;
        }
        
        .satellite-btn.sos:hover {
            background: #ff2d55;
        }
        
        /* ========== SURVEILLANCE ZONE DISPLAY ========== */
        .zone-display {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.9);
            padding: 15px;
            border-radius: 15px;
            z-index: 1;
            max-width: 300px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .zone-metrics {
            display: flex;
            gap: 15px;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        
        .zone-metric {
            text-align: center;
            flex: 1;
            min-width: 100px;
        }
        
        .metric-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #00ff88;
        }
        
        .metric-label {
            font-size: 0.8rem;
            color: #ccc;
        }
        
        /* ========== HIDDEN SATELLITE MODE ========== */
        .hidden-satellite-mode {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0c0e2a;
            z-index: 10000;
        }
        
        .hidden-satellite-header {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            padding: 15px;
            border-radius: 15px;
            z-index: 10001;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }
        
        .hidden-satellite-controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 10001;
        }
        
        .hidden-satellite-btn {
            background: #008751;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        #hiddenMap {
            width: 100%;
            height: 100%;
        }
        
        /* ========== SETTINGS PANEL ========== */
        .settings-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            padding: 15px;
            border-radius: 15px;
            z-index: 999;
            min-width: 200px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .settings-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            margin: 5px 0;
            width: 100%;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* ========== FORMS ========== */
        .form-group {
            margin: 15px 0;
            text-align: left;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #00ff88;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: 1px solid #008751;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 15px 0;
        }
        
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }
        
        /* ========== NOTIFICATION ========== */
        .notification {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px 25px;
            border-radius: 15px;
            z-index: 1002;
            max-width: 350px;
            animation: slideIn 0.5s ease-out;
            border-left: 5px solid #008751;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        @keyframes slideIn {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .hidden { display: none; }
        
        /* ========== RESPONSIVE ========== */
        @media (max-width: 768px) {
            .emergency-btn { width: 200px; height: 200px; font-size: 20px; }
            .map-container { height: 400px; }
            .settings-panel { bottom: 10px; right: 10px; left: 10px; width: auto; }
            .satellite-controls { flex-direction: column; align-items: stretch; }
            .satellite-btn { width: 100%; justify-content: center; }
        }
        
        /* Mapbox custom styles */
        .mapboxgl-ctrl-attrib { 
            background: rgba(0,0,0,0.7) !important;
            color: white !important;
        }
        
        .mapboxgl-ctrl-attrib a {
            color: #00ff88 !important;
        }
        
        .mapboxgl-popup {
            max-width: 300px !important;
        }
        
        .mapboxgl-popup-content {
            background: rgba(0, 0, 0, 0.9) !important;
            color: white !important;
            border: 1px solid #00ff88 !important;
            border-radius: 10px !important;
            padding: 15px !important;
        }
        
        .mapbox-directions-component {
            background: rgba(0, 0, 0, 0.9) !important;
            color: white !important;
        }
    </style>
</head>
<body>
    <!-- ========== CALCULATOR DISGUISE ========== -->
    <div class="calculator" id="calculator">
        <div class="calculator-display">
            <div class="equation" id="equation">0</div>
            <div class="result" id="result">0</div>
        </div>
        <div class="calculator-buttons">
            <button class="calculator-btn clear" onclick="clearDisplay()">C</button>
            <button class="calculator-btn operator" onclick="appendOperator('+')">+</button>
            <button class="calculator-btn operator" onclick="appendOperator('-')">-</button>
            <button class="calculator-btn operator" onclick="appendOperator('*')">√ó</button>
            <button class="calculator-btn" onclick="appendNumber('7')">7</button>
            <button class="calculator-btn" onclick="appendNumber('8')">8</button>
            <button class="calculator-btn" onclick="appendNumber('9')">9</button>
            <button class="calculator-btn operator" onclick="appendOperator('/')">√∑</button>
            <button class="calculator-btn" onclick="appendNumber('4')">4</button>
            <button class="calculator-btn" onclick="appendNumber('5')">5</button>
            <button class="calculator-btn" onclick="appendNumber('6')">6</button>
            <button class="calculator-btn" onclick="appendOperator('.')">.</button>
            <button class="calculator-btn" onclick="appendNumber('1')">1</button>
            <button class="calculator-btn" onclick="appendNumber('2')">2</button>
            <button class="calculator-btn" onclick="appendNumber('3')">3</button>
            <button class="calculator-btn equals" onclick="calculate()" onmousedown="holdForEmergency()" onmouseup="releaseHold()" ontouchstart="holdForEmergency()" ontouchend="releaseHold()">=</button>
            <button class="calculator-btn" onclick="appendNumber('0')">0</button>
            <button class="calculator-btn" onclick="toggleSign()">¬±</button>
        </div>
    </div>
    
    <!-- ========== SOS INTERFACE (Hidden) ========== -->
    <div class="sos-interface" id="sosInterface">
        <div class="sos-container">
            <!-- HEADER -->
            <div class="sos-header">
                <h1><i class="fas fa-shield-alt"></i> SOS GUARDIAN PRO</h1>
                <p>LIVE SATELLITE SURVEILLANCE SYSTEM</p>
            </div>
            
            <!-- SHAKE DETECTION -->
            <div style="background:rgba(0,0,0,0.3);padding:15px;border-radius:15px;margin:20px auto;max-width:500px;display:flex;align-items:center;justify-content:center;gap:15px;">
                <div id="shakeCount" style="background:#007aff;color:white;width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;">
                    0/6
                </div>
                <div>
                    <span style="color:#ff9500;font-weight:600;">SHAKE TO ACTIVATE:</span> Shake phone 6 times
                </div>
            </div>
            
            <!-- EMERGENCY SECTION -->
            <div class="emergency-section">
                <h2>LIVE SATELLITE SURVEILLANCE SOS</h2>
                <p>Press and hold for 3 seconds or shake phone 6 times</p>
                
                <button class="emergency-btn" id="sosButton" onmousedown="startHoldTimer()" onmouseup="cancelHoldTimer()" ontouchstart="startHoldTimer()" ontouchend="cancelHoldTimer()">
                    <i class="fas fa-satellite"></i>
                    <span id="buttonText">ACTIVATE<br>SURVEILLANCE</span>
                    <div id="countdown" class="hidden" style="font-size:50px;font-weight:800;"></div>
                </button>
                
                <p style="color:#ffcc00;">2000m ahead + 50m left/right satellite monitoring</p>
            </div>
            
            <!-- SURVEILLANCE SETUP -->
            <div class="surveillance-section">
                <h2 style="color:#00ff88;margin-bottom:20px;"><i class="fas fa-bullseye"></i> Surveillance Setup</h2>
                
                <div class="surveillance-grid">
                    <div class="surveillance-card">
                        <div class="surveillance-icon">
                            <i class="fas fa-map-pin"></i>
                        </div>
                        <h4 style="color:#00ff88;">START LOCATION</h4>
                        <div class="form-group">
                            <input type="text" id="startLocation" placeholder="Use GPS or enter address">
                            <button onclick="setStartLocation()" style="background:#3498db;color:white;border:none;padding:10px;border-radius:8px;margin-top:10px;width:100%;cursor:pointer;">
                                <i class="fas fa-location-dot"></i> Set Start Point
                            </button>
                        </div>
                    </div>
                    
                    <div class="surveillance-card">
                        <div class="surveillance-icon">
                            <i class="fas fa-flag-checkered"></i>
                        </div>
                        <h4 style="color:#00ff88;">DESTINATION</h4>
                        <div class="form-group">
                            <input type="text" id="destination" placeholder="Where are you going?">
                            <button onclick="setDestination()" style="background:#9b59b6;color:white;border:none;padding:10px;border-radius:8px;margin-top:10px;width:100%;cursor:pointer;">
                                <i class="fas fa-search"></i> Set Destination
                            </button>
                        </div>
                    </div>
                    
                    <div class="surveillance-card">
                        <div class="surveillance-icon">
                            <i class="fas fa-user-shield"></i>
                        </div>
                        <h4 style="color:#00ff88;">SURVEILLANCE ZONE</h4>
                        <div style="text-align:left;margin-top:10px;">
                            <p><i class="fas fa-arrow-up" style="color:#3498db;"></i> 2000m forward</p>
                            <p><i class="fas fa-arrows-alt-h" style="color:#9b59b6;"></i> 50m left/right</p>
                            <p><i class="fas fa-eye" style="color:#00ff88;"></i> High-res satellite</p>
                        </div>
                    </div>
                </div>
                
                <!-- EMERGENCY CONTACTS -->
                <div style="margin-top:30px;padding-top:20px;border-top:1px solid rgba(255,255,255,0.1);">
                    <h3 style="color:#00ff88;margin-bottom:15px;"><i class="fas fa-user-friends"></i> Emergency Contacts</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label><i class="fas fa-phone"></i> Contact 1</label>
                            <input type="tel" id="contact1" placeholder="+2348012345678" value="+2348103365359">
                        </div>
                        
                        <div class="form-group">
                            <label><i class="fas fa-phone"></i> Contact 2</label>
                            <input type="tel" id="contact2" placeholder="+2348023456789">
                        </div>
                    </div>
                    
                    <button onclick="saveSettings()" style="background:#008751;color:white;border:none;padding:15px 30px;border-radius:10px;width:100%;font-size:1.1rem;cursor:pointer;margin-top:10px;display:flex;align-items:center;justify-content:center;gap:10px;">
                        <i class="fas fa-save"></i> Save Surveillance Settings
                    </button>
                </div>
            </div>
            
            <!-- LIVE SATELLITE MAP -->
            <div class="map-container">
                <div class="map-overlay">
                    <div class="satellite-controls">
                        <div style="color:#00ff88;display:flex;align-items:center;gap:10px;">
                            <i class="fas fa-satellite"></i>
                            <div>
                                <strong>LIVE SATELLITE SURVEILLANCE</strong>
                                <div style="font-size:0.8rem;color:#ccc;">High-density imagery active</div>
                            </div>
                        </div>
                        <div style="display:flex;gap:10px;flex-wrap:wrap;">
                            <button class="satellite-btn view" onclick="toggleSatelliteView()">
                                <i class="fas fa-satellite-dish"></i> Satellite View
                            </button>
                            <button class="satellite-btn zoom" onclick="zoomToSurveillanceZone()">
                                <i class="fas fa-search-plus"></i> Zoom Zone
                            </button>
                            <button class="satellite-btn" onclick="enterHiddenMode()">
                                <i class="fas fa-eye-slash"></i> Hide App
                            </button>
                            <button class="satellite-btn sos" onclick="testEmergency()">
                                <i class="fas fa-bell"></i> Test SOS
                            </button>
                        </div>
                    </div>
                </div>
                
                <div id="map"></div>
                
                <div class="zone-display">
                    <h4 style="color:#00ff88;margin:0 0 10px 0;"><i class="fas fa-radar"></i> SURVEILLANCE ZONE</h4>
                    <div class="zone-metrics">
                        <div class="zone-metric">
                            <div class="metric-value" id="frontDistance">2000m</div>
                            <div class="metric-label">Forward Range</div>
                        </div>
                        <div class="zone-metric">
                            <div class="metric-value" id="sideDistance">50m</div>
                            <div class="metric-label">Side Coverage</div>
                        </div>
                        <div class="zone-metric">
                            <div class="metric-value" id="threatLevel">LOW</div>
                            <div class="metric-label">Threat Level</div>
                        </div>
                    </div>
                    <div style="margin-top:10px;font-size:0.8rem;color:#ccc;">
                        <i class="fas fa-circle" style="color:#00ff88;font-size:0.6rem;"></i> 
                        <span id="detectionStatus">Monitoring for threats...</span>
                    </div>
                </div>
            </div>
            
            <!-- FOOTER -->
            <div style="text-align:center;padding:30px;margin-top:50px;background:rgba(0,0,0,0.3);border-radius:15px;">
                <p><strong>SOS GUARDIAN PRO v2.0 - SATELLITE SURVEILLANCE</strong></p>
                <p><i class="fas fa-phone"></i> Emergency: 112, 767 | Support: +234 8103365359</p>
                <p>¬© 2024 SOS Guardian Technologies is a product of Proto Douglas Ltd.</p>
            </div>
        </div>
    </div>
    
    <!-- ========== HIDDEN SATELLITE MODE ========== -->
    <div class="hidden-satellite-mode" id="hiddenSatelliteMode">
        <div class="hidden-satellite-header">
            <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px;">
                <div style="color:#00ff88;">
                    <i class="fas fa-satellite"></i> <strong>HIDDEN SURVEILLANCE</strong>
                </div>
                <div style="font-size:0.9rem;color:#ccc;">
                    <span id="hiddenFront">2000m Front</span> | 
                    <span id="hiddenSide">50m Sides</span>
                </div>
            </div>
        </div>
        <div id="hiddenMap"></div>
        <div class="hidden-satellite-controls">
            <button class="hidden-satellite-btn" onclick="showFullApp()">
                <i class="fas fa-eye"></i> Show App
            </button>
            <button class="hidden-satellite-btn" onclick="activateEmergencyFromHidden()" style="background:#ff3b30;">
                <i class="fas fa-bell"></i> EMERGENCY SOS
            </button>
            <button class="hidden-satellite-btn" onclick="exitHiddenMode()" style="background:#666;">
                <i class="fas fa-times"></i> Exit
            </button>
        </div>
    </div>
    
    <!-- ========== SETTINGS PANEL ========== -->
    <div class="settings-panel" id="settingsPanel">
        <button class="settings-btn" onclick="toggleSOSInterface()">
            <i class="fas fa-eye"></i> Show/Hide SOS
        </button>
        <button class="settings-btn" onclick="resetCalculator()">
            <i class="fas fa-calculator"></i> Reset to Calculator
        </button>
        <button class="settings-btn" onclick="testSurveillance()">
            <i class="fas fa-satellite"></i> Test Surveillance
        </button>
    </div>

    <script>
        // ========== MAPBOX CONFIGURATION ==========
        // Using your Mapbox token for live satellite imagery
        mapboxgl.accessToken = 'pk.eyJ1IjoiZWtlaWRpbWF1Y2hlY2h1a3d1IiwiYSI6ImNtbDYxZ3NvazA2cDYza3NjOXlwNmx0aXcifQ.agDhj-euUG6sEyMTiDsQAA';
        
        // ========== CALCULATOR FUNCTIONS ==========
        let currentInput = '0';
        let previousInput = '';
        let operation = null;
        let resetScreen = false;
        
        function appendNumber(number) {
            if (currentInput === '0' || resetScreen) {
                currentInput = number;
                resetScreen = false;
            } else {
                currentInput += number;
            }
            updateDisplay();
        }
        
        function appendOperator(op) {
            if (op === '=') {
                calculate();
                return;
            }
            
            if (previousInput !== '' && operation !== null) {
                calculate();
            }
            
            operation = op;
            previousInput = currentInput;
            currentInput = '0';
            updateDisplay();
        }
        
        function calculate() {
            let computation;
            const prev = parseFloat(previousInput);
            const current = parseFloat(currentInput);
            
            if (isNaN(prev) || isNaN(current)) return;
            
            switch (operation) {
                case '+': computation = prev + current; break;
                case '-': computation = prev - current; break;
                case '*': computation = prev * current; break;
                case '/': computation = prev / current; break;
                default: return;
            }
            
            currentInput = computation.toString();
            operation = null;
            previousInput = '';
            resetScreen = true;
            updateDisplay();
        }
        
        function clearDisplay() {
            currentInput = '0';
            previousInput = '';
            operation = null;
            updateDisplay();
        }
        
        function toggleSign() {
            currentInput = (parseFloat(currentInput) * -1).toString();
            updateDisplay();
        }
        
        function updateDisplay() {
            document.getElementById('result').textContent = currentInput;
            document.getElementById('equation').textContent = 
                previousInput + (operation ? ' ' + operation : '');
        }
        
        // ========== SATELLITE SURVEILLANCE SYSTEM ==========
        let map = null;
        let hiddenMap = null;
        let directions = null;
        let startLocation = { lat: 6.5244, lng: 3.3792, address: 'Lagos, Nigeria' };
        let destination = { lat: 6.6018, lng: 3.3515, address: 'Ikeja, Lagos' };
        let userLocation = { lat: 6.5244, lng: 3.3792 };
        let surveillanceZone = null;
        let isSatelliteView = true;
        let isMonitoring = false;
        let monitoringInterval = null;
        let emergencyActive = false;
        let shakeCount = 0;
        let holdTimer = null;
        let countdownValue = 3;
        let calculatorHoldTimer = null;
        
        // Surveillance parameters
        const SURVEILLANCE_RANGE = {
            FRONT: 2000, // meters ahead
            SIDES: 50,   // meters left/right
            HEIGHT: 500  // meters for 3D view
        };
        
        // ========== DISGUISE FUNCTIONS ==========
        function toggleSOSInterface() {
            const sosInterface = document.getElementById('sosInterface');
            const calculator = document.getElementById('calculator');
            const settingsPanel = document.getElementById('settingsPanel');
            
            if (sosInterface.style.display === 'block') {
                sosInterface.style.display = 'none';
                calculator.style.display = 'block';
                settingsPanel.style.display = 'block';
            } else {
                sosInterface.style.display = 'block';
                calculator.style.display = 'none';
                settingsPanel.style.display = 'none';
                initializeSOS();
            }
        }
        
        function resetCalculator() {
            document.getElementById('sosInterface').style.display = 'none';
            document.getElementById('calculator').style.display = 'block';
            document.getElementById('settingsPanel').style.display = 'block';
        }
        
        function holdForEmergency() {
            calculatorHoldTimer = setTimeout(() => {
                toggleSOSInterface();
                showNotification('üõ°Ô∏è SOS Guardian Pro - Satellite Surveillance Activated', 'success');
            }, 3000);
        }
        
        function releaseHold() {
            clearTimeout(calculatorHoldTimer);
        }
        
        // ========== INITIALIZE MAPBOX SATELLITE ==========
        function initializeSOS() {
            if (!map) {
                initializeMap();
                getCurrentLocation();
            }
            
            loadSavedData();
            
            if (window.DeviceMotionEvent) {
                window.addEventListener('devicemotion', handleShake);
            }
        }
        
        function initializeMap() {
            try {
                // Initialize main map with SATELLITE view
                map = new mapboxgl.Map({
                    container: 'map',
                    style: 'mapbox://styles/mapbox/satellite-streets-v12',
                    center: [userLocation.lng, userLocation.lat],
                    zoom: 16,
                    pitch: 60, // Tilted view
                    bearing: 0,
                    antialias: true,
                    attributionControl: false
                });
                
                // Add navigation controls
                map.addControl(new mapboxgl.NavigationControl(), 'top-right');
                map.addControl(new mapboxgl.FullscreenControl());
                
                // Add geolocate control for user tracking
                const geolocate = new mapboxgl.GeolocateControl({
                    positionOptions: {
                        enableHighAccuracy: true
                    },
                    trackUserLocation: true,
                    showUserHeading: true,
                    showAccuracyCircle: true
                });
                map.addControl(geolocate, 'top-right');
                
                // Add attribution
                map.addControl(new mapboxgl.AttributionControl({
                    compact: true
                }));
                
                // Add 3D terrain for realistic satellite view
                map.on('style.load', () => {
                    // Add terrain source
                    map.addSource('mapbox-dem', {
                        'type': 'raster-dem',
                        'url': 'mapbox://mapbox.mapbox-terrain-dem-v1',
                        'tileSize': 512,
                        'maxzoom': 14
                    });
                    
                    // Set terrain with exaggeration for better visibility
                    map.setTerrain({
                        'source': 'mapbox-dem',
                        'exaggeration': 1.5
                    });
                    
                    // Add sky layer for realistic atmosphere
                    map.addLayer({
                        'id': 'sky',
                        'type': 'sky',
                        'paint': {
                            'sky-type': 'atmosphere',
                            'sky-atmosphere-sun': [0.0, 0.0],
                            'sky-atmosphere-sun-intensity': 15
                        }
                    });
                    
                    // Start surveillance
                    startSurveillance();
                });
                
                // Initialize hidden map
                hiddenMap = new mapboxgl.Map({
                    container: 'hiddenMap',
                    style: 'mapbox://styles/mapbox/satellite-streets-v12',
                    center: [userLocation.lng, userLocation.lat],
                    zoom: 16,
                    pitch: 60
                });
                
                hiddenMap.addControl(new mapboxgl.NavigationControl());
                hiddenMap.addControl(new mapboxgl.FullscreenControl());
                
                showNotification('üõ∞Ô∏è LIVE SATELLITE SURVEILLANCE ACTIVATED', 'success');
                
            } catch (error) {
                console.error('Mapbox initialization error:', error);
                showNotification('‚ö†Ô∏è Satellite system loading failed', 'error');
            }
        }
        
        // ========== LOCATION FUNCTIONS ==========
        function getCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        
                        // Set as start location
                        startLocation = { ...userLocation, address: 'Current Location' };
                        document.getElementById('startLocation').value = 'Current GPS Location';
                        
                        if (map) {
                            map.flyTo({
                                center: [userLocation.lng, userLocation.lat],
                                zoom: 18, // High zoom for satellite detail
                                pitch: 70, // High tilt for 3D view
                                bearing: 0,
                                duration: 3000
                            });
                            
                            // Add user marker
                            new mapboxgl.Marker({
                                color: '#ff3b30',
                                scale: 1.5
                            })
                            .setLngLat([userLocation.lng, userLocation.lat])
                            .setPopup(new mapboxgl.Popup().setHTML(`
                                <div style="color: white;">
                                    <h3 style="color:#00ff88;">YOU ARE HERE</h3>
                                    <p>üìç ${userLocation.lat.toFixed(6)}, ${userLocation.lng.toFixed(6)}</p>
                                    <p>üõ∞Ô∏è Satellite surveillance active</p>
                                </div>
                            `))
                            .addTo(map);
                        }
                        
                        showNotification('üìç GPS location acquired - Satellite tracking active', 'success');
                        
                        // Start continuous tracking
                        startContinuousTracking();
                        
                    },
                    (error) => {
                        console.error('Geolocation error:', error);
                        showNotification('üìç Using default Lagos location', 'info');
                        document.getElementById('startLocation').value = 'Lagos, Nigeria';
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            }
        }
        
        function setStartLocation() {
            getCurrentLocation();
        }
        
        function setDestination() {
            const destInput = document.getElementById('destination').value;
            if (!destInput) {
                showNotification('Please enter a destination address', 'error');
                return;
            }
            
            showNotification('üîç Searching destination on satellite...', 'info');
            
            geocodeAddress(destInput, 'destination');
        }
        
        function geocodeAddress(address, type) {
            const geocodingUrl = `https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(address)}.json?access_token=${mapboxgl.accessToken}&limit=1&country=NG`;
            
            fetch(geocodingUrl)
                .then(response => response.json())
                .then(data => {
                    if (data.features && data.features.length > 0) {
                        const feature = data.features[0];
                        const coords = feature.center;
                        const placeName = feature.place_name;
                        
                        if (type === 'destination') {
                            destination = {
                                lat: coords[1],
                                lng: coords[0],
                                address: placeName
                            };
                            
                            // Add destination marker
                            new mapboxgl.Marker({
                                color: '#e74c3c',
                                scale: 1.5
                            })
                            .setLngLat([coords[0], coords[1]])
                            .setPopup(new mapboxgl.Popup().setHTML(`
                                <div style="color: white;">
                                    <h3 style="color:#ff9500;">DESTINATION</h3>
                                    <p>üìç ${placeName}</p>
                                    <p>üéØ Surveillance route endpoint</p>
                                </div>
                            `))
                            .addTo(map);
                            
                            showNotification(`üìç Destination set: ${placeName}`, 'success');
                            
                            // Fly to destination
                            map.flyTo({
                                center: coords,
                                zoom: 16,
                                pitch: 60,
                                duration: 3000
                            });
                        }
                    } else {
                        showNotification('Location not found. Try a different address.', 'error');
                    }
                })
                .catch(error => {
                    console.error('Geocoding error:', error);
                    showNotification('Search failed. Check internet connection.', 'error');
                });
        }
        
        // ========== SURVEILLANCE FUNCTIONS ==========
        function startSurveillance() {
            if (isMonitoring) return;
            
            isMonitoring = true;
            
            // Create surveillance zone
            createSurveillanceZone();
            
            // Start monitoring interval
            monitoringInterval = setInterval(() => {
                updateSurveillance();
            }, 3000); // Update every 3 seconds
            
            showNotification('üî≠ Surveillance zone monitoring activated', 'success');
        }
        
        function createSurveillanceZone() {
            if (!map || !userLocation) return;
            
            // Convert meters to degrees
            const metersToDegrees = (meters) => meters / 111320;
            
            const frontDist = metersToDegrees(SURVEILLANCE_RANGE.FRONT);
            const sideDist = metersToDegrees(SURVEILLANCE_RANGE.SIDES);
            
            // Create surveillance zone polygon (2000m front, 50m sides)
            const zoneCoordinates = [
                [
                    [userLocation.lng - sideDist, userLocation.lat],
                    [userLocation.lng + sideDist, userLocation.lat],
                    [userLocation.lng + sideDist, userLocation.lat + frontDist],
                    [userLocation.lng - sideDist, userLocation.lat + frontDist],
                    [userLocation.lng - sideDist, userLocation.lat]
                ]
            ];
            
            // Remove existing zone if any
            if (map.getSource('surveillance-zone')) {
                map.removeLayer('surveillance-zone-fill');
                map.removeLayer('surveillance-zone-line');
                map.removeSource('surveillance-zone');
            }
            
            // Add surveillance zone source
            map.addSource('surveillance-zone', {
                'type': 'geojson',
                'data': {
                    'type': 'Feature',
                    'geometry': {
                        'type': 'Polygon',
                        'coordinates': zoneCoordinates
                    }
                }
            });
            
            // Add filled zone
            map.addLayer({
                'id': 'surveillance-zone-fill',
                'type': 'fill',
                'source': 'surveillance-zone',
                'paint': {
                    'fill-color': '#008751',
                    'fill-opacity': 0.2,
                    'fill-outline-color': '#00ff88'
                }
            });
            
            // Add zone outline
            map.addLayer({
                'id': 'surveillance-zone-line',
                'type': 'line',
                'source': 'surveillance-zone',
                'paint': {
                    'line-color': '#00ff88',
                    'line-width': 3,
                    'line-dasharray': [2, 2]
                }
            });
            
            // Add zone to hidden map
            if (hiddenMap) {
                if (hiddenMap.getSource('surveillance-zone')) {
                    hiddenMap.removeLayer('surveillance-zone-fill');
                    hiddenMap.removeLayer('surveillance-zone-line');
                    hiddenMap.removeSource('surveillance-zone');
                }
                
                hiddenMap.addSource('surveillance-zone', {
                    'type': 'geojson',
                    'data': {
                        'type': 'Feature',
                        'geometry': {
                            'type': 'Polygon',
                            'coordinates': zoneCoordinates
                        }
                    }
                });
                
                hiddenMap.addLayer({
                    'id': 'surveillance-zone-fill',
                    'type': 'fill',
                    'source': 'surveillance-zone',
                    'paint': {
                        'fill-color': '#008751',
                        'fill-opacity': 0.2
                    }
                });
            }
        }
        
        function updateSurveillance() {
            if (!map || !userLocation) return;
            
            // Simulate threat detection
            simulateThreatDetection();
            
            // Update surveillance zone position based on user location
            createSurveillanceZone();
            
            // Update zone display info
            updateZoneDisplay();
        }
        
        function simulateThreatDetection() {
            const threats = [
                { type: 'SUSPICIOUS VEHICLE', level: 'MEDIUM', color: '#ff9500' },
                { type: 'UNUSUAL GATHERING', level: 'LOW', color: '#FFD700' },
                { type: 'FAST MOVING OBJECT', level: 'HIGH', color: '#ff3b30' },
                { type: 'STATIONARY THREAT', level: 'MEDIUM', color: '#ff9500' }
            ];
            
            // 20% chance of detecting a threat
            if (Math.random() < 0.2) {
                const randomThreat = threats[Math.floor(Math.random() * threats.length)];
                
                document.getElementById('threatLevel').textContent = randomThreat.level;
                document.getElementById('threatLevel').style.color = randomThreat.color;
                document.getElementById('detectionStatus').textContent = `Detected: ${randomThreat.type}`;
                document.getElementById('detectionStatus').style.color = randomThreat.color;
                
                // Show threat on map
                addThreatMarker(randomThreat);
                
                showNotification(`‚ö†Ô∏è ${randomThreat.level} THREAT: ${randomThreat.type}`, 'warning');
            } else {
                document.getElementById('detectionStatus').textContent = 'Monitoring for threats...';
                document.getElementById('detectionStatus').style.color = '#ccc';
            }
        }
        
        function addThreatMarker(threat) {
            // Add random position within surveillance zone
            const threatLng = userLocation.lng + (Math.random() - 0.5) * 0.01;
            const threatLat = userLocation.lat + Math.random() * 0.02;
            
            const threatMarker = new mapboxgl.Marker({
                color: threat.color,
                scale: 1.2
            })
            .setLngLat([threatLng, threatLat])
            .setPopup(new mapboxgl.Popup().setHTML(`
                <div style="color: white;">
                    <h3 style="color:${threat.color};">${threat.level} THREAT</h3>
                    <p>${threat.type}</p>
                    <p>üìç ${threatLat.toFixed(6)}, ${threatLng.toFixed(6)}</p>
                    <p>üïí ${new Date().toLocaleTimeString()}</p>
                </div>
            `))
            .addTo(map);
            
            // Remove marker after 10 seconds
            setTimeout(() => {
                threatMarker.remove();
            }, 10000);
        }
        
        function updateZoneDisplay() {
            document.getElementById('frontDistance').textContent = `${SURVEILLANCE_RANGE.FRONT}m`;
            document.getElementById('sideDistance').textContent = `${SURVEILLANCE_RANGE.SIDES}m`;
            
            document.getElementById('hiddenFront').textContent = `${SURVEILLANCE_RANGE.FRONT}m Front`;
            document.getElementById('hiddenSide').textContent = `${SURVEILLANCE_RANGE.SIDES}m Sides`;
        }
        
        function startContinuousTracking() {
            if (navigator.geolocation) {
                navigator.geolocation.watchPosition(
                    (position) => {
                        userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        
                        // Update map view
                        map.flyTo({
                            center: [userLocation.lng, userLocation.lat],
                            zoom: 18,
                            pitch: 70,
                            bearing: position.coords.heading || 0,
                            duration: 1000,
                            essential: true
                        });
                        
                        // Update user marker
                        updateUserMarker();
                        
                        // Update hidden map
                        if (hiddenMap) {
                            hiddenMap.flyTo({
                                center: [userLocation.lng, userLocation.lat],
                                zoom: 18,
                                duration: 1000
                            });
                        }
                    },
                    (error) => {
                        console.error('Continuous tracking error:', error);
                    },
                    {
                        enableHighAccuracy: true,
                        maximumAge: 3000,
                        timeout: 10000
                    }
                );
            }
        }
        
        function updateUserMarker() {
            // Remove existing user marker
            const markers = document.getElementsByClassName('mapboxgl-marker');
            for (let marker of markers) {
                if (marker.style.zIndex === '1000') {
                    marker.remove();
                }
            }
            
            // Add new user marker
            new mapboxgl.Marker({
                color: '#ff3b30',
                scale: 1.5
            })
            .setLngLat([userLocation.lng, userLocation.lat])
            .addTo(map);
        }
        
        // ========== MAP CONTROLS ==========
        function toggleSatelliteView() {
            if (!map) return;
            
            isSatelliteView = !isSatelliteView;
            
            if (isSatelliteView) {
                map.setStyle('mapbox://styles/mapbox/satellite-streets-v12');
                if (hiddenMap) {
                    hiddenMap.setStyle('mapbox://styles/mapbox/satellite-streets-v12');
                }
                showNotification('üõ∞Ô∏è Switched to high-res satellite view', 'success');
            } else {
                map.setStyle('mapbox://styles/mapbox/streets-v12');
                if (hiddenMap) {
                    hiddenMap.setStyle('mapbox://styles/mapbox/streets-v12');
                }
                showNotification('üó∫Ô∏è Switched to street view', 'success');
            }
        }
        
        function zoomToSurveillanceZone() {
            if (!map || !userLocation) return;
            
            // Calculate bounds for surveillance zone
            const metersToDegrees = (meters) => meters / 111320;
            const frontDist = metersToDegrees(SURVEILLANCE_RANGE.FRONT);
            const sideDist = metersToDegrees(SURVEILLANCE_RANGE.SIDES);
            
            const bounds = new mapboxgl.LngLatBounds();
            bounds.extend([userLocation.lng - sideDist, userLocation.lat]);
            bounds.extend([userLocation.lng + sideDist, userLocation.lat + frontDist]);
            
            map.fitBounds(bounds, {
                padding: { top: 50, bottom: 50, left: 50, right: 50 },
                duration: 2000,
                pitch: 60
            });
            
            showNotification('üî≠ Zoomed to surveillance zone', 'success');
        }
        
        // ========== HIDDEN MODE ==========
        function enterHiddenMode() {
            if (!isMonitoring) {
                showNotification('Please activate surveillance first', 'error');
                return;
            }
            
            document.getElementById('sosInterface').style.display = 'none';
            document.getElementById('calculator').style.display = 'none';
            document.getElementById('settingsPanel').style.display = 'none';
            document.getElementById('hiddenSatelliteMode').style.display = 'block';
            
            // Update hidden map with current view
            if (hiddenMap) {
                hiddenMap.flyTo({
                    center: [userLocation.lng, userLocation.lat],
                    zoom: 18,
                    pitch: 60,
                    duration: 1000
                });
                
                createSurveillanceZone();
            }
            
            showNotification('üïµÔ∏è App hidden - Satellite surveillance active', 'success');
        }
        
        function showFullApp() {
            document.getElementById('hiddenSatelliteMode').style.display = 'none';
            document.getElementById('sosInterface').style.display = 'block';
        }
        
        function exitHiddenMode() {
            document.getElementById('hiddenSatelliteMode').style.display = 'none';
            document.getElementById('calculator').style.display = 'block';
            document.getElementById('settingsPanel').style.display = 'block';
        }
        
        function activateEmergencyFromHidden() {
            showFullApp();
            triggerEmergency('hidden_mode');
        }
        
        // ========== SHAKE DETECTION ==========
        let lastAcceleration = { x: null, y: null, z: null };
        let lastShakeTime = 0;
        
        function handleShake(event) {
            const acceleration = event.accelerationIncludingGravity;
            
            if (!lastAcceleration.x) {
                lastAcceleration = { x: acceleration.x, y: acceleration.y, z: acceleration.z };
                return;
            }
            
            const delta = Math.abs(acceleration.x - lastAcceleration.x) + 
                         Math.abs(acceleration.y - lastAcceleration.y) + 
                         Math.abs(acceleration.z - lastAcceleration.z);
            
            if (delta > 15) {
                const now = Date.now();
                if (now - lastShakeTime > 1000) {
                    shakeCount = 0;
                }
                
                shakeCount++;
                lastShakeTime = now;
                
                updateShakeDisplay();
                
                if (shakeCount >= 6) {
                    triggerEmergency('shake');
                }
            }
            
            lastAcceleration = { x: acceleration.x, y: acceleration.y, z: acceleration.z };
        }
        
        function updateShakeDisplay() {
            const shakeElement = document.getElementById('shakeCount');
            if (shakeElement) {
                shakeElement.textContent = `${shakeCount}/6`;
                if (shakeCount >= 6) {
                    shakeElement.style.background = '#ff3b30';
                } else if (shakeCount >= 4) {
                    shakeElement.style.background = '#ff9500';
                }
            }
        }
        
        // ========== EMERGENCY FUNCTIONS ==========
        function startHoldTimer() {
            if (emergencyActive) return;
            
            countdownValue = 3;
            document.getElementById('buttonText').classList.add('hidden');
            document.getElementById('countdown').classList.remove('hidden');
            document.getElementById('countdown').textContent = countdownValue;
            
            holdTimer = setInterval(() => {
                countdownValue--;
                document.getElementById('countdown').textContent = countdownValue;
                
                if (countdownValue <= 0) {
                    clearInterval(holdTimer);
                    triggerEmergency('button');
                }
            }, 1000);
        }
        
        function cancelHoldTimer() {
            if (holdTimer && !emergencyActive) {
                clearInterval(holdTimer);
                document.getElementById('buttonText').classList.remove('hidden');
                document.getElementById('countdown').classList.add('hidden');
            }
        }
        
        function triggerEmergency(source) {
            if (emergencyActive) return;
            
            emergencyActive = true;
            
            const emergencyModal = document.createElement('div');
            emergencyModal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.97); z-index: 10003;
                display: flex; flex-direction: column; align-items: center;
                justify-content: center; color: white; text-align: center;
                backdrop-filter: blur(20px);
            `;
            
            let surveillanceInfo = '';
            if (isMonitoring) {
                surveillanceInfo = `
                    <div style="background: rgba(0,135,81,0.3); padding: 15px; border-radius: 10px; margin: 10px 0; border: 1px solid #00ff88;">
                        <p><i class="fas fa-satellite"></i> <strong>ACTIVE SURVEILLANCE:</strong></p>
                        <p>üì° 2000m forward monitoring</p>
                        <p>üëÅÔ∏è 50m left/right coverage</p>
                        <p>üìç Current threat level: <span style="color:#${document.getElementById('threatLevel').style.color}">${document.getElementById('threatLevel').textContent}</span></p>
                    </div>
                `;
            }
            
            emergencyModal.innerHTML = `
                <div style="font-size: 100px; color: #ff3b30; margin-bottom: 20px; animation: pulse 1s infinite;">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <h1 style="color: #ffcc00; font-size: 2.5rem; margin-bottom: 20px;">
                    üö® SATELLITE SURVEILLANCE SOS
                </h1>
                <p style="font-size: 1.2rem; margin-bottom: 15px; max-width: 500px;">
                    Sending live satellite data to emergency contacts...
                </p>
                <div style="background: rgba(255,59,48,0.3); padding: 20px; border-radius: 15px; margin: 20px; width: 90%; max-width: 400px; border: 1px solid #ff3b30;">
                    <p style="color: #00ff88; margin: 10px 0;">
                        <i class="fas fa-location-dot"></i> <strong>LIVE SATELLITE POSITION:</strong><br>
                        ${userLocation.lat.toFixed(6)}, ${userLocation.lng.toFixed(6)}
                    </p>
                    <p style="color: #00ff88; margin: 10px 0;">
                        <i class="fas fa-clock"></i> <strong>TIME:</strong> ${new Date().toLocaleString()}
                    </p>
                    <p style="color: #00ff88; margin: 10px 0;">
                        <i class="fas fa-map"></i> <strong>GOOGLE MAPS:</strong><br>
                        https://maps.google.com/?q=${userLocation.lat},${userLocation.lng}
                    </p>
                    ${surveillanceInfo}
                </div>
                <div style="display: flex; gap: 15px; margin-top: 30px; flex-wrap: wrap; justify-content: center;">
                    <button onclick="sendEmergencyAlerts()" style="background: #25D366; color: white; border: none; padding: 15px 30px; border-radius: 10px; font-size: 1.1rem; cursor: pointer; display: flex; align-items: center; gap: 10px;">
                        <i class="fab fa-whatsapp"></i> Send WhatsApp Alert
                    </button>
                    <button onclick="cancelEmergency()" style="background: #666; color: white; border: none; padding: 15px 30px; border-radius: 10px; font-size: 1.1rem; cursor: pointer;">
                        Cancel (False Alarm)
                    </button>
                </div>
                <style>
                    @keyframes pulse {
                        0%, 100% { transform: scale(1); }
                        50% { transform: scale(1.1); }
                    }
                </style>
            `;
            
            document.body.appendChild(emergencyModal);
            window.currentEmergencyModal = emergencyModal;
            
            document.getElementById('buttonText').classList.add('hidden');
            document.getElementById('countdown').classList.add('hidden');
            
            showNotification('üö® SATELLITE EMERGENCY ACTIVATED - Sending live data', 'emergency');
        }
        
        function sendEmergencyAlerts() {
            const contact1 = document.getElementById('contact1').value;
            const contact2 = document.getElementById('contact2').value;
            
            if (!contact1) {
                showNotification('Please set emergency contacts first', 'error');
                return;
            }
            
            let message = `üö®üö®üö® SATELLITE SURVEILLANCE SOS üö®üö®üö®\n\n`;
            message += `üõ°Ô∏è FROM: SOS Guardian Pro - Live Satellite System\n\n`;
            message += `üõ∞Ô∏è LIVE SATELLITE POSITION:\n`;
            message += `Latitude: ${userLocation.lat.toFixed(6)}\n`;
            message += `Longitude: ${userLocation.lng.toFixed(6)}\n`;
            message += `üó∫Ô∏è Google Maps: https://maps.google.com/?q=${userLocation.lat},${userLocation.lng}\n\n`;
            
            message += `üî≠ ACTIVE SURVEILLANCE:\n`;
            message += `‚Ä¢ 2000m forward satellite monitoring\n`;
            message += `‚Ä¢ 50m left/right threat detection\n`;
            message += `‚Ä¢ High-resolution imagery: ACTIVE\n`;
            message += `‚Ä¢ Threat level: ${document.getElementById('threatLevel').textContent}\n\n`;
            
            if (startLocation.address && destination.address) {
                message += `üó∫Ô∏è NAVIGATION ROUTE:\n`;
                message += `‚Ä¢ START: ${startLocation.address}\n`;
                message += `‚Ä¢ DESTINATION: ${destination.address}\n\n`;
            }
            
            message += `üïí TIME: ${new Date().toLocaleString()}\n\n`;
            message += `üö® USER NEEDS IMMEDIATE EMERGENCY ASSISTANCE!\n`;
            message += `‚ö†Ô∏è LIVE SATELLITE TRACKING ACTIVE - MONITORING 2000m AHEAD\n\n`;
            message += `üìû EMERGENCY CONTACTS NOTIFIED\n`;
            message += `üì± Forward this satellite data to authorities`;
            
            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
            
            showNotification('üì° Satellite emergency data sent via WhatsApp', 'success');
            
            setTimeout(() => {
                cancelEmergency();
            }, 5000);
        }
        
        function cancelEmergency() {
            if (window.currentEmergencyModal) {
                window.currentEmergencyModal.remove();
            }
            
            emergencyActive = false;
            shakeCount = 0;
            updateShakeDisplay();
            document.getElementById('buttonText').classList.remove('hidden');
            showNotification('Emergency cancelled', 'info');
        }
        
        function testEmergency() {
            triggerEmergency('test');
        }
        
        function testSurveillance() {
            getCurrentLocation();
            showNotification('üß™ Testing satellite surveillance system...', 'info');
            setTimeout(() => {
                showNotification('‚úÖ Satellite system working - High-res imagery active', 'success');
            }, 2000);
        }
        
        // ========== DATA SAVING ==========
        function saveSettings() {
            const contact1 = document.getElementById('contact1').value;
            const contact2 = document.getElementById('contact2').value;
            const startAddr = document.getElementById('startLocation').value;
            const dest = document.getElementById('destination').value;
            
            localStorage.setItem('sos_contact1', contact1);
            localStorage.setItem('sos_contact2', contact2);
            localStorage.setItem('sos_start', startAddr);
            localStorage.setItem('sos_destination', dest);
            
            showNotification('‚úÖ Surveillance settings saved', 'success');
        }
        
        function loadSavedData() {
            const contact1 = localStorage.getItem('sos_contact1');
            const contact2 = localStorage.getItem('sos_contact2');
            const startAddr = localStorage.getItem('sos_start');
            const dest = localStorage.getItem('sos_destination');
            
            if (contact1) document.getElementById('contact1').value = contact1;
            if (contact2) document.getElementById('contact2').value = contact2;
            if (startAddr) document.getElementById('startLocation').value = startAddr;
            if (dest) document.getElementById('destination').value = dest;
        }
        
        // ========== NOTIFICATION ==========
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = 'notification';
            
            let icon = '‚ÑπÔ∏è';
            if (type === 'success') icon = '‚úÖ';
            if (type === 'warning') icon = '‚ö†Ô∏è';
            if (type === 'emergency') icon = 'üö®';
            if (type === 'error') icon = '‚ùå';
            
            notification.innerHTML = `${icon} ${message}`;
            
            if (type === 'error') notification.style.borderLeftColor = '#ff3b30';
            if (type === 'success') notification.style.borderLeftColor = '#4CAF50';
            if (type === 'emergency') notification.style.borderLeftColor = '#ff9500';
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideIn 0.5s ease-out reverse';
                setTimeout(() => notification.remove(), 500);
            }, 4000);
        }
        
        // ========== INITIALIZATION ==========
        window.addEventListener('load', () => {
            updateDisplay();
            
            setTimeout(() => {
                document.getElementById('settingsPanel').style.display = 'none';
            }, 10000);
        });
    </script>
</body>
</html>
